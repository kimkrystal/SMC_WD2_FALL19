!function(e){function i(t){var e;return g?e=999*Math.random():(d||(d=n()),e=d),Math.floor(e%t)}function n(){var t=r(m);return t||(t=999*Math.random(),o(m,t,30)),t}function o(t,e,i){if(i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var o="; expires="+n.toGMTString()}else o="";document.cookie=t+"="+e+o+"; path=/"}function r(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return null}function s(t){if(p.alternative){var e=p.alternative;"string"==typeof e?t.text(e):"function"==typeof e&&e(t)}}function a(t,e,i,n){var o=n.scope||3;window._gaq.push(["_setCustomVar",t,e,i,o])}function l(t,e,i){var n=i["event-label"]||undefined,o=i["event-value"]||undefined,r=["event-noninteraction"];window._gaq.push(["_trackEvent",t,e,n,o,r])}function u(t){if("undefined"!=typeof window.console&&"string"==typeof t)return window.console.log(t)}function c(t){if("undefined"!=typeof window._gaq){var e="",i=t.slot;e=0!==f?p.value||"alternative"+f:t["default-value"]||"default",g?u(i?h+" : "+e+" (custom var "+i+")":h+" : "+e+" (event)"):i?a(i,h,e,t):l(h,e,t)}}var d,h,p,f,g,_=/#!dev/,m="_easyab_seed";e.fn.easyab=function(t){return t&&"object"==typeof t&&navigator.cookieEnabled?((h=t.name)&&t.alternatives&&(g=_.test(window.location),0!==(f=i(t.alternatives.length+1))&&(p=t.alternatives[f-1]),c(t)),this.each(function(){var t=e(this);0!==f&&s(t)})):this}}(window.jQuery||window.Zepto),function(){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this||{},e=t._,n=Array.prototype,s=Object.prototype,d="undefined"!=typeof Symbol?Symbol.prototype:null,o=n.push,l=n.slice,h=s.toString,r=s.hasOwnProperty,i=Array.isArray,a=Object.keys,u=Object.create,c=function(){},p=function(t){return t instanceof p?t:this instanceof p?void(this._wrapped=t):new p(t)};"undefined"==typeof exports||exports.nodeType?t._=p:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=p),exports._=p),p.VERSION="1.9.1";var f,g=function(o,r,t){if(void 0===r)return o;switch(null==t?3:t){case 1:return function(t){return o.call(r,t)};case 3:return function(t,e,i){return o.call(r,t,e,i)};case 4:return function(t,e,i,n){return o.call(r,t,e,i,n)}}return function(){return o.apply(r,arguments)}},_=function(t,e,i){return p.iteratee!==f?p.iteratee(t,e):null==t?p.identity:p.isFunction(t)?g(t,e,i):p.isObject(t)&&!p.isArray(t)?p.matcher(t):p.property(t)};p.iteratee=f=function(t,e){return _(t,e,Infinity)};var m=function(s,a){return a=null==a?s.length-1:+a,function(t,e){for(var i=Math.max(arguments.length-a,0),n=Array(i),o=0;o<i;o++)n[o]=arguments[o+a];switch(a){case 0:return s.call(this,n);case 1:return s.call(this,t,n);case 2:return s.call(this,t,e,n)}var r=Array(a+1);for(o=0;o<a;o++)r[o]=arguments[o];return r[a]=n,s.apply(this,r)}},v=function(t){if(!p.isObject(t))return{};if(u)return u(t);c.prototype=t;var e=new c;return c.prototype=null,e},y=function(e){return function(t){return null==t?void 0:t[e]}},w=function(t,e){return null!=t&&r.call(t,e)},b=function(t,e){for(var i=e.length,n=0;n<i;n++){if(null==t)return;t=t[e[n]]}return i?t:void 0},x=Math.pow(2,53)-1,k=y("length"),C=function(t){var e=k(t);return"number"==typeof e&&0<=e&&e<=x};p.each=p.forEach=function(t,e,i){var n,o;if(e=g(e,i),C(t))for(n=0,o=t.length;n<o;n++)e(t[n],n,t);else{var r=p.keys(t);for(n=0,o=r.length;n<o;n++)e(t[r[n]],r[n],t)}return t},p.map=p.collect=function(t,e,i){e=_(e,i);for(var n=!C(t)&&p.keys(t),o=(n||t).length,r=Array(o),s=0;s<o;s++){var a=n?n[s]:s;r[s]=e(t[a],a,t)}return r};var S=function(l){var r=function(t,e,i,n){var o=!C(t)&&p.keys(t),r=(o||t).length,s=0<l?0:r-1;for(n||(i=t[o?o[s]:s],s+=l);0<=s&&s<r;s+=l){var a=o?o[s]:s;i=e(i,t[a],a,t)}return i};return function(t,e,i,n){var o=3<=arguments.length;return r(t,g(e,n,4),i,o)}};p.reduce=p.foldl=p.inject=S(1),p.reduceRight=p.foldr=S(-1),p.find=p.detect=function(t,e,i){var n=(C(t)?p.findIndex:p.findKey)(t,e,i);if(void 0!==n&&-1!==n)return t[n]},p.filter=p.select=function(t,n,e){var o=[];return n=_(n,e),p.each(t,function(t,e,i){n(t,e,i)&&o.push(t)}),o},p.reject=function(t,e,i){return p.filter(t,p.negate(_(e)),i)},p.every=p.all=function(t,e,i){e=_(e,i);for(var n=!C(t)&&p.keys(t),o=(n||t).length,r=0;r<o;r++){var s=n?n[r]:r;if(!e(t[s],s,t))return!1}return!0},p.some=p.any=function(t,e,i){e=_(e,i);for(var n=!C(t)&&p.keys(t),o=(n||t).length,r=0;r<o;r++){var s=n?n[r]:r;if(e(t[s],s,t))return!0}return!1},p.contains=p.includes=p.include=function(t,e,i,n){return C(t)||(t=p.values(t)),("number"!=typeof i||n)&&(i=0),0<=p.indexOf(t,e,i)},p.invoke=m(function(t,i,n){var o,r;return p.isFunction(i)?r=i:p.isArray(i)&&(o=i.slice(0,-1),i=i[i.length-1]),p.map(t,function(t){var e=r;if(!e){if(o&&o.length&&(t=b(t,o)),null==t)return;e=t[i]}return null==e?e:e.apply(t,n)})}),p.pluck=function(t,e){return p.map(t,p.property(e))},p.where=function(t,e){return p.filter(t,p.matcher(e))},p.findWhere=function(t,e){return p.find(t,p.matcher(e))},p.max=function(t,n,e){var i,o,r=-Infinity,s=-Infinity;if(null==n||"number"==typeof n&&"object"!=typeof t[0]&&null!=t)for(var a=0,l=(t=C(t)?t:p.values(t)).length;a<l;a++)null!=(i=t[a])&&r<i&&(r=i);else n=_(n,e),p.each(t,function(t,e,i){o=n(t,e,i),(s<o||o===-Infinity&&r===-Infinity)&&(r=t,s=o)});return r},p.min=function(t,n,e){var i,o,r=Infinity,s=Infinity;if(null==n||"number"==typeof n&&"object"!=typeof t[0]&&null!=t)for(var a=0,l=(t=C(t)?t:p.values(t)).length;a<l;a++)null!=(i=t[a])&&i<r&&(r=i);else n=_(n,e),p.each(t,function(t,e,i){((o=n(t,e,i))<s||o===Infinity&&r===Infinity)&&(r=t,s=o)});return r},p.shuffle=function(t){return p.sample(t,Infinity)},p.sample=function(t,e,i){if(null==e||i)return C(t)||(t=p.values(t)),t[p.random(t.length-1)];var n=C(t)?p.clone(t):p.values(t),o=k(n);e=Math.max(Math.min(e,o),0);for(var r=o-1,s=0;s<e;s++){var a=p.random(s,r),l=n[s];n[s]=n[a],n[a]=l}return n.slice(0,e)},p.sortBy=function(t,n,e){var o=0;return n=_(n,e),p.pluck(p.map(t,function(t,e,i){return{value:t,index:o++,criteria:n(t,e,i)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(n<i||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")};var M=function(s,e){return function(n,o,t){var r=e?[[],[]]:{};return o=_(o,t),p.each(n,function(t,e){var i=o(t,e,n);s(r,t,i)}),r}};p.groupBy=M(function(t,e,i){w(t,i)?t[i].push(e):t[i]=[e]}),p.indexBy=M(function(t,e,i){t[i]=e}),p.countBy=M(function(t,e,i){w(t,i)?t[i]++:t[i]=1});var O=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;p.toArray=function(t){return t?p.isArray(t)?l.call(t):p.isString(t)?t.match(O):C(t)?p.map(t,p.identity):p.values(t):[]},p.size=function(t){return null==t?0:C(t)?t.length:p.keys(t).length},p.partition=M(function(t,e,i){t[i?0:1].push(e)},!0),p.first=p.head=p.take=function(t,e,i){return null==t||t.length<1?null==e?void 0:[]:null==e||i?t[0]:p.initial(t,t.length-e)},p.initial=function(t,e,i){return l.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},p.last=function(t,e,i){return null==t||t.length<1?null==e?void 0:[]:null==e||i?t[t.length-1]:p.rest(t,Math.max(0,t.length-e))},p.rest=p.tail=p.drop=function(t,e,i){return l.call(t,null==e||i?1:e)},p.compact=function(t){return p.filter(t,Boolean)};var T=function(t,e,i,n){for(var o=(n=n||[]).length,r=0,s=k(t);r<s;r++){var a=t[r];if(C(a)&&(p.isArray(a)||p.isArguments(a)))if(e)for(var l=0,u=a.length;l<u;)n[o++]=a[l++];else T(a,e,i,n),o=n.length;else i||(n[o++]=a)}return n};p.flatten=function(t,e){return T(t,e,!1)},p.without=m(function(t,e){return p.difference(t,e)}),p.uniq=p.unique=function(t,e,i,n){p.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=_(i,n));for(var o=[],r=[],s=0,a=k(t);s<a;s++){var l=t[s],u=i?i(l,s,t):l;e&&!i?(s&&r===u||o.push(l),r=u):i?p.contains(r,u)||(r.push(u),o.push(l)):p.contains(o,l)||o.push(l)}return o},p.union=m(function(t){return p.uniq(T(t,!0,!0))}),p.intersection=function(t){for(var e=[],i=arguments.length,n=0,o=k(t);n<o;n++){var r=t[n];if(!p.contains(e,r)){var s;for(s=1;s<i&&p.contains(arguments[s],r);s++);s===i&&e.push(r)}}return e},p.difference=m(function(t,e){return e=T(e,!0,!0),p.filter(t,function(t){return!p.contains(e,t)})}),p.unzip=function(t){for(var e=t&&p.max(t,k).length||0,i=Array(e),n=0;n<e;n++)i[n]=p.pluck(t,n);return i},p.zip=m(p.unzip),p.object=function(t,e){for(var i={},n=0,o=k(t);n<o;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i};var P=function(r){return function(t,e,i){e=_(e,i);for(var n=k(t),o=0<r?0:n-1;0<=o&&o<n;o+=r)if(e(t[o],o,t))return o;return-1}};p.findIndex=P(1),p.findLastIndex=P(-1),p.sortedIndex=function(t,e,i,n){for(var o=(i=_(i,n,1))(e),r=0,s=k(t);r<s;){var a=Math.floor((r+s)/2);i(t[a])<o?r=a+1:s=a}return r};var I=function(r,s,a){return function(t,e,i){var n=0,o=k(t);if("number"==typeof i)0<r?n=0<=i?i:Math.max(i+o,n):o=0<=i?Math.min(i+1,o):i+o+1;else if(a&&i&&o)return t[i=a(t,e)]===e?i:-1;if(e!=e)return 0<=(i=s(l.call(t,n,o),p.isNaN))?i+n:-1;for(i=0<r?n:o-1;0<=i&&i<o;i+=r)if(t[i]===e)return i;return-1}};p.indexOf=I(1,p.findIndex,p.sortedIndex),p.lastIndexOf=I(-1,p.findLastIndex),p.range=function(t,e,i){null==e&&(e=t||0,t=0),i||(i=e<t?-1:1);for(var n=Math.max(Math.ceil((e-t)/i),0),o=Array(n),r=0;r<n;r++,t+=i)o[r]=t;return o},p.chunk=function(t,e){if(null==e||e<1)return[];for(var i=[],n=0,o=t.length;n<o;)i.push(l.call(t,n,n+=e));return i};var A=function(t,e,i,n,o){if(!(n instanceof e))return t.apply(i,o);var r=v(t.prototype),s=t.apply(r,o);return p.isObject(s)?s:r};p.bind=m(function(e,i,n){if(!p.isFunction(e))throw new TypeError("Bind must be called on a function");var o=m(function(t){return A(e,o,i,this,n.concat(t))});return o}),p.partial=m(function(o,r){var s=p.partial.placeholder,a=function(){for(var t=0,e=r.length,i=Array(e),n=0;n<e;n++)i[n]=r[n]===s?arguments[t++]:r[n];for(;t<arguments.length;)i.push(arguments[t++]);return A(o,a,this,this,i)};return a}),(p.partial.placeholder=p).bindAll=m(function(t,e){var i=(e=T(e,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=e[i];t[n]=p.bind(t[n],t)}}),p.memoize=function(n,o){var r=function(t){var e=r.cache,i=""+(o?o.apply(this,arguments):t);return w(e,i)||(e[i]=n.apply(this,arguments)),e[i]};return r.cache={},r},p.delay=m(function(t,e,i){return setTimeout(function(){return t.apply(null,i)},e)}),p.defer=p.partial(p.delay,p,1),p.throttle=function(i,n,o){var r,s,a,l,u=0;o||(o={});var c=function(){u=!1===o.leading?0:p.now(),r=null,l=i.apply(s,a),r||(s=a=null)},t=function(){var t=p.now();u||!1!==o.leading||(u=t);var e=n-(t-u);return s=this,a=arguments,e<=0||n<e?(r&&(clearTimeout(r),r=null),u=t,l=i.apply(s,a),r||(s=a=null)):r||!1===o.trailing||(r=setTimeout(c,e)),l};return t.cancel=function(){clearTimeout(r),u=0,r=s=a=null},t},p.debounce=function(i,n,o){var r,s,a=function(t,e){r=null,e&&(s=i.apply(t,e))},t=m(function(t){if(r&&clearTimeout(r),o){var e=!r;r=setTimeout(a,n),e&&(s=i.apply(this,t))}else r=p.delay(a,n,this,t);return s});return t.cancel=function(){clearTimeout(r),r=null},t},p.wrap=function(t,e){return p.partial(e,t)},p.negate=function(t){return function(){return!t.apply(this,arguments)}},p.compose=function(){var i=arguments,n=i.length-1;return function(){for(var t=n,e=i[n].apply(this,arguments);t--;)e=i[t].call(this,e);return e}},p.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},p.before=function(t,e){var i;return function(){return 0<--t&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}},p.once=p.partial(p.before,2),p.restArguments=m;var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],R=function(t,e){var i=F.length,n=t.constructor,o=p.isFunction(n)&&n.prototype||s,r="constructor";for(w(t,r)&&!p.contains(e,r)&&e.push(r);i--;)(r=F[i])in t&&t[r]!==o[r]&&!p.contains(e,r)&&e.push(r)};p.keys=function(t){if(!p.isObject(t))return[];if(a)return a(t);var e=[];for(var i in t)w(t,i)&&e.push(i);return E&&R(t,e),e},p.allKeys=function(t){if(!p.isObject(t))return[];var e=[];for(var i in t)e.push(i);return E&&R(t,e),e},p.values=function(t){for(var e=p.keys(t),i=e.length,n=Array(i),o=0;o<i;o++)n[o]=t[e[o]];return n},p.mapObject=function(t,e,i){e=_(e,i);for(var n=p.keys(t),o=n.length,r={},s=0;s<o;s++){var a=n[s];r[a]=e(t[a],a,t)}return r},p.pairs=function(t){for(var e=p.keys(t),i=e.length,n=Array(i),o=0;o<i;o++)n[o]=[e[o],t[e[o]]];return n},p.invert=function(t){for(var e={},i=p.keys(t),n=0,o=i.length;n<o;n++)e[t[i[n]]]=i[n];return e},p.functions=p.methods=function(t){var e=[];for(var i in t)p.isFunction(t[i])&&e.push(i);return e.sort()};var L=function(l,u){return function(t){var e=arguments.length;if(u&&(t=Object(t)),e<2||null==t)return t;for(var i=1;i<e;i++)for(var n=arguments[i],o=l(n),r=o.length,s=0;s<r;s++){var a=o[s];u&&void 0!==t[a]||(t[a]=n[a])}return t}};p.extend=L(p.allKeys),p.extendOwn=p.assign=L(p.keys),p.findKey=function(t,e,i){e=_(e,i);for(var n,o=p.keys(t),r=0,s=o.length;r<s;r++)if(e(t[n=o[r]],n,t))return n};var V,D,U=function(t,e,i){return e in i};p.pick=m(function(t,e){var i={},n=e[0];if(null==t)return i;p.isFunction(n)?(1<e.length&&(n=g(n,e[1])),e=p.allKeys(t)):(n=U,e=T(e,!1,!1),t=Object(t));for(var o=0,r=e.length;o<r;o++){var s=e[o],a=t[s];n(a,s,t)&&(i[s]=a)}return i}),p.omit=m(function(t,i){var e,n=i[0];return p.isFunction(n)?(n=p.negate(n),1<i.length&&(e=i[1])):(i=p.map(T(i,!1,!1),String),n=function(t,e){return!p.contains(i,e)}),p.pick(t,n,e)}),p.defaults=L(p.allKeys,!0),p.create=function(t,e){var i=v(t);return e&&p.extendOwn(i,e),i},p.clone=function(t){return p.isObject(t)?p.isArray(t)?t.slice():p.extend({},t):t},p.tap=function(t,e){return e(t),t},p.isMatch=function(t,e){var i=p.keys(e),n=i.length;if(null==t)return!n;for(var o=Object(t),r=0;r<n;r++){var s=i[r];if(e[s]!==o[s]||!(s in o))return!1}return!0},V=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var o=typeof t;return("function"===o||"object"===o||"object"==typeof e)&&D(t,e,i,n)},D=function(t,e,i,n){t instanceof p&&(t=t._wrapped),e instanceof p&&(e=e._wrapped);var o=h.call(t);if(o!==h.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return d.valueOf.call(t)===d.valueOf.call(e)}var r="[object Array]"===o;if(!r){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(p.isFunction(s)&&s instanceof s&&p.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}n=n||[];for(var l=(i=i||[]).length;l--;)if(i[l]===t)return n[l]===e;if(i.push(t),n.push(e),r){if((l=t.length)!==e.length)return!1;for(;l--;)if(!V(t[l],e[l],i,n))return!1}else{var u,c=p.keys(t);if(l=c.length,p.keys(e).length!==l)return!1;for(;l--;)if(u=c[l],!w(e,u)||!V(t[u],e[u],i,n))return!1}return i.pop(),n.pop(),!0},p.isEqual=function(t,e){return V(t,e)},p.isEmpty=function(t){return null==t||(C(t)&&(p.isArray(t)||p.isString(t)||p.isArguments(t))?0===t.length:0===p.keys(t).length)},p.isElement=function(t){return!(!t||1!==t.nodeType)},p.isArray=i||function(t){return"[object Array]"===h.call(t)},p.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},p.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(e){p["is"+e]=function(t){return h.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(t){return w(t,"callee")});var q=t.document&&t.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof q&&(p.isFunction=function(t){return"function"==typeof t||!1}),p.isFinite=function(t){return!p.isSymbol(t)&&isFinite(t)&&!isNaN(parseFloat(t))},p.isNaN=function(t){return p.isNumber(t)&&isNaN(t)},p.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===h.call(t)},p.isNull=function(t){return null===t},p.isUndefined=function(t){return void 0===t},p.has=function(t,e){if(!p.isArray(e))return w(t,e);for(var i=e.length,n=0;n<i;n++){var o=e[n];if(null==t||!r.call(t,o))return!1;t=t[o]}return!!i},p.noConflict=function(){return t._=e,this},p.identity=function(t){return t},p.constant=function(t){return function(){return t}},p.noop=function(){},p.property=function(e){return p.isArray(e)?function(t){return b(t,e)}:y(e)},p.propertyOf=function(e){return null==e?function(){}:function(t){return p.isArray(t)?b(e,t):e[t]}},p.matcher=p.matches=function(e){return e=p.extendOwn({},e),function(t){return p.isMatch(t,e)}},p.times=function(t,e,i){var n=Array(Math.max(0,t));e=g(e,i,1);for(var o=0;o<t;o++)n[o]=e(o);return n},p.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},p.now=Date.now||function(){return(new Date).getTime()};var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},B=p.invert(j),z=function(e){var i=function(t){return e[t]},t="(?:"+p.keys(e).join("|")+")",n=RegExp(t),o=RegExp(t,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(o,i):t}};p.escape=z(j),p.unescape=z(B),p.result=function(t,e,i){p.isArray(e)||(e=[e]);var n=e.length;if(!n)return p.isFunction(i)?i.call(t):i;for(var o=0;o<n;o++){var r=null==t?void 0:t[e[o]];void 0===r&&(r=i,o=n),t=p.isFunction(r)?r.call(t):r}return t};var N=0;p.uniqueId=function(t){var e=++N+"";return t?t+e:e},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,Y={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},W=/\\|'|\r|\n|\u2028|\u2029/g,J=function(t){return"\\"+Y[t]};p.template=function(r,t,e){!t&&e&&(t=e),t=p.defaults({},t,p.templateSettings);var i,n=RegExp([(t.escape||H).source,(t.interpolate||H).source,(t.evaluate||H).source].join("|")+"|$","g"),s=0,a="__p+='";r.replace(n,function(t,e,i,n,o){return a+=r.slice(s,o).replace(W,J),s=o+t.length,e?a+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":i?a+="'+\n((__t=("+i+"))==null?'':__t)+\n'":n&&(a+="';\n"+n+"\n__p+='"),t}),a+="';\n",t.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{i=new Function(t.variable||"obj","_",a)}catch(u){throw u.source=a,u}var o=function(t){return i.call(this,t,p)},l=t.variable||"obj";return o.source="function("+l+"){\n"+a+"}",o},p.chain=function(t){var e=p(t);return e._chain=!0,e};var $=function(t,e){return t._chain?p(e).chain():e};p.mixin=function(i){return p.each(p.functions(i),function(t){var e=p[t]=i[t];p.prototype[t]=function(){var t=[this._wrapped];return o.apply(t,arguments),$(this,e.apply(p,t))}}),p},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var i=n[e];p.prototype[e]=function(){var t=this._wrapped;return i.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0],$(this,t)}}),p.each(["concat","join","slice"],function(t){var e=n[t];p.prototype[t]=function(){return $(this,e.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},p.prototype.valueOf=p.prototype.toJSON=p.prototype.value,p.prototype.toString=function(){return String(this._wrapped)},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}(),_.templateSettings={interpolate:/\[\%\=(.+?)\%\]/gim,evaluate:/\[\%(.+?)\%\]/gim,escape:/\[\%\-(.+?)\%\]/gim},_.mixin({isFalsy:function(t){return 0==t||""==t||null==t||"undefined"==t||t==undefined||t==NaN||"null"==t||"false"==t||0==t||"0"==t},isTruthy:function(t){return!this.isFalsy(t)}}),function(n){var o="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(t,e,i){o.Backbone=n(o,i,t,e)});else if("undefined"!=typeof exports){var t,e=require("underscore");try{t=require("jquery")}catch(i){}n(o,exports,e,t)}else o.Backbone=n(o,{},o._,o.jQuery||o.Zepto||o.ender||o.$)}(function(t,l,b,e){var i=t.Backbone,r=Array.prototype.slice;l.VERSION="1.3.3",l.$=e,l.noConflict=function(){return t.Backbone=i,this},l.emulateHTTP=!1,l.emulateJSON=!1;var o=function(t,n,o){switch(t){case 1:return function(){return b[n](this[o])};case 2:return function(t){return b[n](this[o],t)};case 3:return function(t,e){return b[n](this[o],s(t,this),e)};case 4:return function(t,e,i){return b[n](this[o],s(t,this),e,i)};default:return function(){var t=r.call(arguments);return t.unshift(this[o]),b[n].apply(b,t)}}},n=function(i,t,n){b.each(t,function(t,e){b[e]&&(i.prototype[e]=o(t,e,n))})},s=function(e,t){return b.isFunction(e)?e:b.isObject(e)&&!t._isModel(e)?a(e):b.isString(e)?function(t){return t.get(e)}:e},a=function(t){var e=b.matches(t);return function(t){return e(t.attributes)}},u=l.Events={},c=/\s+/,d=function(t,e,i,n,o){var r,s=0;if(i&&"object"==typeof i){void 0!==n&&"context"in o&&void 0===o.context&&(o.context=n);for(r=b.keys(i);s<r.length;s++)e=d(t,e,r[s],i[r[s]],o)}else if(i&&c.test(i))for(r=i.split(c);s<r.length;s++)e=t(e,r[s],n,o);else e=t(e,i,n,o);return e};u.on=function(t,e,i){return h(this,t,e,i)};var h=function(t,e,i,n,o){(t._events=d(p,t._events||{},e,i,{context:n,ctx:t,listening:o}),o)&&((t._listeners||(t._listeners={}))[o.id]=o);return t};u.listenTo=function(t,e,i){if(!t)return this;var n=t._listenId||(t._listenId=b.uniqueId("l")),o=this._listeningTo||(this._listeningTo={}),r=o[n];if(!r){var s=this._listenId||(this._listenId=b.uniqueId("l"));r=o[n]={obj:t,objId:n,id:s,listeningTo:o,count:0}}return h(t,e,i,this,r),this};var p=function(t,e,i,n){if(i){var o=t[e]||(t[e]=[]),r=n.context,s=n.ctx,a=n.listening;a&&a.count++,o.push({callback:i,context:r,ctx:r||s,listening:a})}return t};u.off=function(t,e,i){return this._events&&(this._events=d(f,this._events,t,e,{context:i,listeners:this._listeners})),this},u.stopListening=function(t,e,i){var n=this._listeningTo;if(!n)return this;for(var o=t?[t._listenId]:b.keys(n),r=0;r<o.length;r++){var s=n[o[r]];if(!s)break;s.obj.off(e,i,this)}return this};var f=function(t,e,i,n){if(t){var o,r=0,s=n.context,a=n.listeners;if(e||i||s){for(var l=e?[e]:b.keys(t);r<l.length;r++){var u=t[e=l[r]];if(!u)break;for(var c=[],d=0;d<u.length;d++){var h=u[d];i&&i!==h.callback&&i!==h.callback._callback||s&&s!==h.context?c.push(h):(o=h.listening)&&0==--o.count&&(delete a[o.id],delete o.listeningTo[o.objId])}c.length?t[e]=c:delete t[e]}return t}for(var p=b.keys(a);r<p.length;r++)delete a[(o=a[p[r]]).id],delete o.listeningTo[o.objId]}};u.once=function(t,e,i){var n=d(g,{},t,e,b.bind(this.off,this));return"string"==typeof t&&null==i&&(e=void 0),this.on(n,e,i)},u.listenToOnce=function(t,e,i){var n=d(g,{},e,i,b.bind(this.stopListening,this,t));return this.listenTo(t,n)};var g=function(t,e,i,n){if(i){var o=t[e]=b.once(function(){n(e,o),i.apply(this,arguments)});o._callback=i}return t};u.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return d(_,this._events,t,void 0,i),this};var _=function(t,e,i,n){if(t){var o=t[e],r=t.all;o&&r&&(r=r.slice()),o&&m(o,n),r&&m(r,[e].concat(n))}return t},m=function(t,e){var i,n=-1,o=t.length,r=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++n<o;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=t[n]).callback.call(i.ctx,r);return;case 2:for(;++n<o;)(i=t[n]).callback.call(i.ctx,r,s);return;case 3:for(;++n<o;)(i=t[n]).callback.call(i.ctx,r,s,a);return;default:for(;++n<o;)(i=t[n]).callback.apply(i.ctx,e);return}};u.bind=u.on,u.unbind=u.off,b.extend(l,u);var v=l.Model=function(t,e){var i=t||{};e||(e={}),this.cid=b.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var n=b.result(this,"defaults");i=b.defaults(b.extend({},n,i),n),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};b.extend(v.prototype,u,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(){return b.clone(this.attributes)},sync:function(){return l.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return b.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!b.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var n;if("object"==typeof t?(n=t,i=e):(n={})[t]=e,i||(i={}),!this._validate(n,i))return!1;var o=i.unset,r=i.silent,s=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=b.clone(this.attributes),this.changed={});var l=this.attributes,u=this.changed,c=this._previousAttributes;for(var d in n)e=n[d],b.isEqual(l[d],e)||s.push(d),b.isEqual(c[d],e)?delete u[d]:u[d]=e,o?delete l[d]:l[d]=e;if(this.idAttribute in n&&(this.id=this.get(this.idAttribute)),!r){s.length&&(this._pending=i);for(var h=0;h<s.length;h++)this.trigger("change:"+s[h],this,l[s[h]],i)}if(a)return this;if(!r)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,b.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,b.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!b.isEmpty(this.changed):b.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&b.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,i={};for(var n in t){var o=t[n];b.isEqual(e[n],o)||(i[n]=o)}return!!b.size(i)&&i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return b.clone(this._previousAttributes)},fetch:function(i){i=b.extend({parse:!0},i);var n=this,o=i.success;return i.success=function(t){var e=i.parse?n.parse(t,i):t;if(!n.set(e,i))return!1;o&&o.call(i.context,n,t,i),n.trigger("sync",n,t,i)},q(this,i),this.sync("read",this,i)},save:function(t,e,i){var n;null==t||"object"==typeof t?(n=t,i=e):(n={})[t]=e;var o=(i=b.extend({validate:!0,parse:!0},i)).wait;if(n&&!o){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;var r=this,s=i.success,a=this.attributes;i.success=function(t){r.attributes=a;var e=i.parse?r.parse(t,i):t;if(o&&(e=b.extend({},n,e)),e&&!r.set(e,i))return!1;s&&s.call(i.context,r,t,i),r.trigger("sync",r,t,i)},q(this,i),n&&o&&(this.attributes=b.extend({},a,n));var l=this.isNew()?"create":i.patch?"patch":"update";"patch"!==l||i.attrs||(i.attrs=n);var u=this.sync(l,this,i);return this.attributes=a,u},destroy:function(e){e=e?b.clone(e):{};var i=this,n=e.success,o=e.wait,r=function(){i.stopListening(),i.trigger("destroy",i,i.collection,e)},t=!(e.success=function(t){o&&r(),n&&n.call(e.context,i,t,e),i.isNew()||i.trigger("sync",i,t,e)});return this.isNew()?b.defer(e.success):(q(this,e),t=this.sync("delete",this,e)),o||r(),t},url:function(){var t=b.result(this,"urlRoot")||b.result(this.collection,"url")||U();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},b.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=b.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,b.extend(e,{validationError:i})),!1)}}),n(v,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var y=l.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,b.extend({silent:!0},e))},x={add:!0,remove:!0,merge:!0},w={add:!0,remove:!1},k=function(t,e,i){i=Math.min(Math.max(i,0),t.length);var n,o=Array(t.length-i),r=e.length;for(n=0;n<o.length;n++)o[n]=t[n+i];for(n=0;n<r;n++)t[n+i]=e[n];for(n=0;n<o.length;n++)t[n+r+i]=o[n]};b.extend(y.prototype,u,{model:v,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return l.sync.apply(this,arguments)},add:function(t,e){return this.set(t,b.extend({merge:!1},e,w))},remove:function(t,e){e=b.extend({},e);var i=!b.isArray(t);t=i?[t]:t.slice();var n=this._removeModels(t,e);return!e.silent&&n.length&&(e.changes={added:[],merged:[],removed:n},this.trigger("update",this,e)),i?n[0]:n},set:function(t,e){if(null!=t){(e=b.extend({},x,e)).parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var i=!b.isArray(t);t=i?[t]:t.slice();var n=e.at;null!=n&&(n=+n),n>this.length&&(n=this.length),n<0&&(n+=this.length+1);var o,r,s=[],a=[],l=[],u=[],c={},d=e.add,h=e.merge,p=e.remove,f=!1,g=this.comparator&&null==n&&!1!==e.sort,_=b.isString(this.comparator)?this.comparator:null;for(r=0;r<t.length;r++){o=t[r];var m=this.get(o);if(m){if(h&&o!==m){var v=this._isModel(o)?o.attributes:o;e.parse&&(v=m.parse(v,e)),m.set(v,e),l.push(m),g&&!f&&(f=m.hasChanged(_))}c[m.cid]||(c[m.cid]=!0,s.push(m)),t[r]=m}else d&&(o=t[r]=this._prepareModel(o,e))&&(a.push(o),this._addReference(o,e),c[o.cid]=!0,s.push(o))}if(p){for(r=0;r<this.length;r++)c[(o=this.models[r]).cid]||u.push(o);u.length&&this._removeModels(u,e)}var y=!1,w=!g&&d&&p;if(s.length&&w?(y=this.length!==s.length||b.some(this.models,function(t,e){return t!==s[e]}),this.models.length=0,k(this.models,s,0),this.length=this.models.length):a.length&&(g&&(f=!0),k(this.models,a,null==n?this.length:n),this.length=this.models.length),f&&this.sort({silent:!0}),!e.silent){for(r=0;r<a.length;r++)null!=n&&(e.index=n+r),(o=a[r]).trigger("add",o,this,e);(f||y)&&this.trigger("sort",this,e),(a.length||u.length||l.length)&&(e.changes={added:a,removed:u,merged:l},this.trigger("update",this,e))}return i?t[0]:t}},reset:function(t,e){e=e?b.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,b.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,b.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,b.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return r.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(t.attributes||t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=e.length;return b.isFunction(e)&&(e=b.bind(e,this)),1===i||b.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(i){var n=(i=b.extend({parse:!0},i)).success,o=this;return i.success=function(t){var e=i.reset?"reset":"set";o[e](t,i),n&&n.call(i.context,o,t,i),o.trigger("sync",o,t,i)},q(this,i),this.sync("read",this,i)},create:function(t,e){var n=(e=e?b.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;n||this.add(t,e);var o=this,r=e.success;return e.success=function(t,e,i){n&&o.add(t,i),r&&r.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;var i=new(((e=e?b.clone(e):{}).collection=this).model)(t,e);return i.validationError?(this.trigger("invalid",this,i.validationError,e),!1):i},_removeModels:function(t,e){for(var i=[],n=0;n<t.length;n++){var o=this.get(t[n]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var s=this.modelId(o.attributes);null!=s&&delete this._byId[s],e.silent||(e.index=r,o.trigger("remove",o,this,e)),i.push(o),this._removeReference(o,e)}}return i},_isModel:function(t){return t instanceof v},_addReference:function(t){this._byId[t.cid]=t;var e=this.modelId(t.attributes);null!=e&&(this._byId[e]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t){delete this._byId[t.cid];var e=this.modelId(t.attributes)
;null!=e&&delete this._byId[e],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if(e){if(("add"===t||"remove"===t)&&i!==this)return;if("destroy"===t&&this.remove(e,n),"change"===t){var o=this.modelId(e.previousAttributes()),r=this.modelId(e.attributes);o!==r&&(null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=e))}}this.trigger.apply(this,arguments)}}),n(y,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models");var C=l.View=function(t){this.cid=b.uniqueId("view"),b.extend(this,b.pick(t,M)),this._ensureElement(),this.initialize.apply(this,arguments)},S=/^(\S+)\s*(.*)$/,M=["model","collection","el","id","attributes","className","tagName","events"];b.extend(C.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof l.$?t:l.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=b.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var i=t[e];if(b.isFunction(i)||(i=this[i]),i){var n=e.match(S);this.delegate(n[1],n[2],b.bind(i,this))}}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(b.result(this,"el"));else{var t=b.extend({},b.result(this,"attributes"));this.id&&(t.id=b.result(this,"id")),this.className&&(t["class"]=b.result(this,"className")),this.setElement(this._createElement(b.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),l.sync=function(t,e,n){var i=O[t];b.defaults(n||(n={}),{emulateHTTP:l.emulateHTTP,emulateJSON:l.emulateJSON});var o={type:i,dataType:"json"};if(n.url||(o.url=b.result(e,"url")||U()),null!=n.data||!e||"create"!==t&&"update"!==t&&"patch"!==t||(o.contentType="application/json",o.data=JSON.stringify(n.attrs||e.toJSON(n))),n.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),n.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){o.type="POST",n.emulateJSON&&(o.data._method=i);var r=n.beforeSend;n.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",i),r)return r.apply(this,arguments)}}"GET"===o.type||n.emulateJSON||(o.processData=!1);var s=n.error;n.error=function(t,e,i){n.textStatus=e,n.errorThrown=i,s&&s.call(n.context,t,e,i)};var a=n.xhr=l.ajax(b.extend(o,n));return e.trigger("request",e,a,n),a};var O={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};l.ajax=function(){return l.$.ajax.apply(l.$,arguments)};var T=l.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},P=/\((.*?)\)/g,I=/(\(\?)?:\w+/g,A=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;b.extend(T.prototype,u,{initialize:function(){},route:function(i,n,o){b.isRegExp(i)||(i=this._routeToRegExp(i)),b.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var r=this;return l.history.route(i,function(t){var e=r._extractParameters(i,t);!1!==r.execute(o,e,n)&&(r.trigger.apply(r,["route:"+n].concat(e)),r.trigger("route",n,e),l.history.trigger("route",r,n,e))}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,e){return l.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=b.result(this,"routes");for(var t,e=b.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(E,"\\$&").replace(P,"(?:$1)?").replace(I,function(t,e){return e?t:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return b.map(i,function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null})}});var F=l.History=function(){this.handlers=[],this.checkUrl=b.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},R=/^[#\/]|\s+$/g,L=/^\/+|\/+$/g,V=/#.*$/;F.started=!1,b.extend(F.prototype,u,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(R,"")},start:function(t){if(F.started)throw new Error("Backbone.history has already been started");if(F.started=!0,this.options=b.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(L,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,n=i.insertBefore(this.iframe,i.firstChild).contentWindow;n.document.open(),n.document.close(),n.location.hash="#"+this.fragment}var o=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?o("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?o("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),F.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),b.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(t,e){if(!F.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+t;if(t=this.decodeFragment(t.replace(V,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var o=this.iframe.contentWindow;e.replace||(o.document.open(),o.document.close()),this._updateHash(o.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),l.history=new F;var D=function(t,e){var i,n=this;return i=t&&b.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},b.extend(i,n,e),i.prototype=b.create(n.prototype,t),(i.prototype.constructor=i).__super__=n.prototype,i};v.extend=y.extend=T.extend=C.extend=F.extend=D;var U=function(){throw new Error('A "url" property or function must be specified')},q=function(e,i){var n=i.error;i.error=function(t){n&&n.call(i.context,e,t,i),e.trigger("error",e,t,i)}};return l}),function(){var d,h,o,t,p,i,r=[].slice;o=function(t){var e,n;return!_.isObject(t)||_.isFunction(t)?t:t instanceof Backbone.Collection||t instanceof Backbone.Model?t:_.isDate(t)?new Date(t.getTime()):_.isRegExp(t)?new RegExp(t.source,t.toString().replace(/.*\//,"")):(n=_.isArray(t||_.isArguments(t)),e=function(t,e,i){return n?t.push(o(e)):t[i]=o(e),t},_.reduce(t,e,n?[]:{}))},i=function(t){return null!=t&&((t.prototype==={}.prototype||t.prototype===Object.prototype)&&_.isObject(t)&&!_.isArray(t)&&!_.isFunction(t)&&!_.isDate(t)&&!_.isRegExp(t)&&!_.isArguments(t))},h=function(e){return _.filter(_.keys(e),function(t){return i(e[t])})},d=function(e){return _.filter(_.keys(e),function(t){return _.isArray(e[t])})},p=function(e,i,n){var t,o,r,s,a,l,u,c;if(null==n&&(n=20),n<=0)return console.warn("_.deepExtend(): Maximum depth of recursion hit."),_.extend(e,i);for(o=function(t){return i[t]=p(e[t],i[t],n-1)},a=0,u=(s=_.intersection(h(e),h(i))).length;a<u;a++)o(s[a]);for(t=function(t){return i[t]=_.union(e[t],i[t])},l=0,c=(r=_.intersection(d(e),d(i))).length;l<c;l++)t(r[l]);return _.extend(e,i)},t=function(){var t,e,i,n;if(i=2<=arguments.length?r.call(arguments,0,n=arguments.length-1):(n=0,[]),e=arguments[n++],_.isNumber(e)||(i.push(e),e=20),i.length<=1)return i[0];if(e<=0)return _.extend.apply(this,i);for(t=i.shift();0<i.length;)t=p(t,o(i.shift()),e);return t},_.mixin({deepClone:o,isBasicObject:i,basicObjects:h,arrays:d,deepExtend:t})}.call(this),function(t){"function"==typeof define&&define.amd?define(["underscore","backbone"],t):t(_,Backbone)}(function(v,t){function y(t){var e={},i=k.keyPathSeparator;for(var n in t){var o=t[n];if(o&&o.constructor===Object&&!v.isEmpty(o)){var r=y(o);for(var s in r){var a=r[s];e[n+i+s]=a}}else e[n]=o}return e}function w(t,e,i){for(var n=k.keyPathSeparator,o=e.split(n),r=t,s=0,a=o.length;s<a;s++){if(i&&!v.has(r,o[s]))return!1;if(null==(r=r[o[s]])&&s<a-1&&(r={}),void 0===r)return!!i||r}return!!i||r}function b(t,e,i,n){n=n||{};for(var o=k.keyPathSeparator,r=e.split(o),s=t,a=0,l=r.length;a<l&&s!==undefined;a++){var u=r[a];a===l-1?n.unset?delete s[u]:s[u]=i:("undefined"!=typeof s[u]&&v.isObject(s[u])||(s[u]={}),s=s[u])}}function x(t,e){b(t,e,null,{unset:!0})}var k=t.Model.extend({constructor:function(t,e){var i,n=t||{};this.cid=v.uniqueId("c"),this.attributes={},e&&e.collection&&(this.collection=e.collection),e&&e.parse&&(n=this.parse(n,e)||{}),(i=v.result(this,"defaults"))&&(n=v.deepExtend({},i,n)),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)},toJSON:function(){return v.deepClone(this.attributes)},get:function(t){return w(this.attributes,t)},set:function(t,e,i){var n,o,r,s,a,l,u,c;if(null==t)return this;if("object"==typeof t?(o=t,i=e||{}):(o={})[t]=e,i||(i={}),!this._validate(o,i))return!1;for(n in r=i.unset,a=i.silent,s=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=v.deepClone(this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]),o=y(o))e=o[n],v.isEqual(w(c,n),e)||s.push(n),v.isEqual(w(u,n),e)?x(this.changed,n):b(this.changed,n,e),r?x(c,n):b(c,n,e);if(!a){s.length&&(this._pending=!0);for(var d=k.keyPathSeparator,h=0,p=s.length;h<p;h++){t=s[h];this.trigger("change:"+t,this,w(c,t),i);for(var f=t.split(d),g=f.length-1;0<g;g--){var _=v.first(f,g).join(d),m=_+d+"*";this.trigger("change:"+m,this,w(c,_),i)}}}if(l)return this;if(!a)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},clear:function(t){var e={},i=y(this.attributes);for(var n in i)e[n]=void 0;return this.set(e,v.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!v.isEmpty(this.changed):w(this.changed,t)!==undefined},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&y(this.changed);var e=this._changing?this._previousAttributes:this.attributes;t=y(t),e=y(e);var i,n=!1;for(var o in t)v.isEqual(e[o],i=t[o])||((n||(n={}))[o]=i);return n},previous:function(t){return null!=t&&this._previousAttributes?w(this._previousAttributes,t):null},previousAttributes:function(){return v.deepClone(this._previousAttributes)}});return k.keyPathSeparator=".",t.DeepModel=k,"undefined"!=typeof module&&(module.exports=k),t}),function(t){var e;if("function"==typeof define&&define.amd)define(["jquery"],t);else if("object"==typeof exports){try{e=require("jquery")}catch(i){}module.exports=t(e)}else window.Cookies=t(window.jQuery)}(function(t){function h(t){return v.raw?t:encodeURIComponent(t)}function p(t){return v.raw?t:decodeURIComponent(t)}function f(t){return h(v.json?JSON.stringify(t):String(t))}function n(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(i," ")),v.json?JSON.parse(t):t}catch(e){}}function g(t,e){var i=v.raw?t:n(t);return m(e)?e(i):i}function _(){for(var t,e,i=0,n={};i<arguments.length;i++)for(t in e=arguments[i])n[t]=e[t];return n}function m(t){return"[object Function]"===Object.prototype.toString.call(t)}var i=/\+/g,v=function(t,e,i){if(1<arguments.length&&!m(e)){if("number"==typeof(i=_(v.defaults,i)).expires){var n=i.expires,o=i.expires=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*n)}return document.cookie=[h(t),"=",f(e),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var r=t?undefined:{},s=document.cookie?document.cookie.split("; "):[],a=0,l=s.length;a<l;a++){var u=s[a].split("="),c=p(u.shift()),d=u.join("=");if(t===c){r=g(d,e);break}t||(d=g(d))===undefined||(r[c]=d)}return r};return v.get=v.set=v,v.defaults={},v.remove=function(t,e){return v(t,"",_(e,{expires:-1})),!v(t)},t&&(t.cookie=v,t.removeCookie=v.remove),v}),Backbone.Paginator=function(d,h,c){"use strict";var p=h.map(d.VERSION.split("."),function(t){return parseInt(t,10)}),t={version:"0.8.1"};t.clientPager=d.Collection.extend({useDiacriticsPlugin:!0,useLevenshteinPlugin:!0,sortColumn:"",sortDirection:"desc",lastSortColumn:"",fieldFilterRules:[],lastFieldFilterRules:[],filterFields:"",filterExpression:"",lastFilterExpression:"",defaults_ui:{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4},initialize:function(){this.on("add",this.addModel,this),this.on("remove",this.removeModel,this),this.setDefaults()},setDefaults:function(){var t=h.defaults(this.paginator_ui,this.defaults_ui);h.defaults(this,t)},addModel:function(t){this.origModels.push(t)},removeModel:function(t){var e=h.indexOf(this.origModels,t);this.origModels.splice(e,1)},sync:function(t,n,e){var i=this;this.setDefaults();var o={};h.each(h.result(i,"server_api"),function(t,e){h.isFunction(t)&&(t=(t=h.bind(t,i))()),o[e]=t});var r=h.clone(i.paginator_core);h.each(r,function(t,e){h.isFunction(t)&&(t=(t=h.bind(t,i))()),r[e]=t}),r=h.defaults(r,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),r=h.extend(r,{data:decodeURIComponent(c.param(o)),processData:!1,url:h.result(r,"url")},e);var s=!(0===p[0]&&9===p[1]&&10===p[2]),a=r.success;r.success=function(t,e,i){a&&(s?a(t,e,i):a(n,t,r)),n&&n.trigger&&n.trigger("sync",n,t,r)};var l=r.error;r.error=function(t){l&&l(n,t,r),n&&n.trigger&&n.trigger("error",n,t,r)};var u=r.xhr=d.ajax(r);return n&&n.trigger&&n.trigger("request",n,u,r),u},nextPage:function(t){this.currentPage<this.information.totalPages&&(this.currentPage=++this.currentPage,this.pager(t))},previousPage:function(t){1<this.currentPage&&(this.currentPage=--this.currentPage,this.pager(t))},goTo:function(t,e){t!==undefined&&(this.currentPage=parseInt(t,10),this.pager(e))},howManyPer:function(t){if(t!==undefined){var e=this.perPage;this.perPage=parseInt(t,10),this.currentPage=Math.ceil((e*(this.currentPage-1)+1)/t),this.pager()}},setSort:function(t,e){t!==undefined&&e!==undefined&&(this.lastSortColumn=this.sortColumn,this.sortColumn=t,this.sortDirection=e,this.pager(),this.info())},setFieldFilter:function(t){h.isEmpty(t)?(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules=""):(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules=t),this.pager(),this.info()},doFakeFieldFilter:function(t){if(!h.isEmpty(t)){var e=this.origModels;return e===undefined&&(e=this.models),e=this._fieldFilter(e,t),""!==this.filterExpression&&(e=this._filter(e,this.filterFields,this.filterExpression)),e.length}},setFilter:function(t,e){t!==undefined&&e!==undefined&&(this.filterFields=t,this.lastFilterExpression=this.filterExpression,this.filterExpression=e,this.pager(),this.info())},doFakeFilter:function(t,e){if(t!==undefined&&e!==undefined){var i=this.origModels;return i===undefined&&(i=this.models),h.isEmpty(this.fieldFilterRules)||(i=this._fieldFilter(i,this.fieldFilterRules)),(i=this._filter(i,t,e)).length}},pager:function(t){var e=this,i=this.perPage,n=(e.currentPage-1)*i,o=n+i;e.origModels===undefined&&(e.origModels=e.models),e.models=e.origModels.slice(),""!==this.sortColumn&&(e.models=e._sort(e.models,this.sortColumn,this.sortDirection)),h.isEmpty(this.fieldFilterRules)||(e.models=e._fieldFilter(e.models,this.fieldFilterRules)),""!==this.filterExpression&&(e.models=e._filter(e.models,this.filterFields,this.filterExpression)),this.lastSortColumn===this.sortColumn&&this.lastFilterExpression===this.filterExpression&&h.isEqual(this.fieldFilterRules,this.lastFieldFilterRules)||(o=(n=0)+i,e.currentPage=1,this.lastSortColumn=this.sortColumn,this.lastFieldFilterRules=this.fieldFilterRules,this.lastFilterExpression=this.filterExpression),e.sortedAndFilteredModels=e.models.slice(),e.info(),e.reset(e.models.slice(n,o)),h.result(t,"success")},_sort:function(t,s,a){return t=t.sort(function(t,e){var i=t.get(s),n=e.get(s);if(h.isUndefined(i)||h.isUndefined(n)||null===i||null===n)return 0;if(i=i.toString().toLowerCase(),n=n.toString().toLowerCase(),"desc"===a)if(!i.match(/[^\-\d\.]/)&&i.match(/-?[\d\.]+/)&&!n.match(/[^\-\d\.]/)&&n.match(/-?[\d\.]+/)){if(i-0<n-0)return 1;if(n-0<i-0)return-1}else{if(i<n)return 1;if(n<i)return-1}else if(!i.match(/[^\-\d\.]/)&&i.match(/-?[\d\.]+/)&&!n.match(/[^\-\d\.]/)&&n.match(/-?[\d\.]+/)){if(i-0<n-0)return-1;if(n-0<i-0)return 1}else{if(i<n)return-1;if(n<i)return 1}if(t.cid&&e.cid){var o=t.cid,r=e.cid;if(o<r)return-1;if(r<o)return 1}return 0})},_fieldFilter:function(t,e){if(h.isEmpty(e))return t;var n=[];return h.each(t,function(i){var t=!0;h.each(e,function(e){if(!t)return!1;(t=!1,"function"===e.type)?h.wrap(e.value,function(t){return t(i.get(e.field))})()&&(t=!0):"required"===e.type?h.isEmpty(i.get(e.field).toString())||(t=!0):"min"===e.type?!h.isNaN(Number(i.get(e.field)))&&!h.isNaN(Number(e.value))&&Number(i.get(e.field))>=Number(e.value)&&(t=!0):"max"===e.type?!h.isNaN(Number(i.get(e.field)))&&!h.isNaN(Number(e.value))&&Number(i.get(e.field))<=Number(e.value)&&(t=!0):"range"===e.type?!h.isNaN(Number(i.get(e.field)))&&h.isObject(e.value)&&!h.isNaN(Number(e.value.min))&&!h.isNaN(Number(e.value.max))&&Number(i.get(e.field))>=Number(e.value.min)&&Number(i.get(e.field))<=Number(e.value.max)&&(t=!0):"minLength"===e.type?i.get(e.field).toString().length>=e.value&&(t=!0):"maxLength"===e.type?i.get(e.field).toString().length<=e.value&&(t=!0):"rangeLength"===e.type?h.isObject(e.value)&&!h.isNaN(Number(e.value.min))&&!h.isNaN(Number(e.value.max))&&i.get(e.field).toString().length>=e.value.min&&i.get(e.field).toString().length<=e.value.max&&(t=!0):"oneOf"===e.type?h.isArray(e.value)&&h.include(e.value,i.get(e.field))&&(t=!0):"equalTo"===e.type?e.value===i.get(e.field)&&(t=!0):"containsAllOf"===e.type?h.isArray(e.value)&&h.isArray(i.get(e.field))&&h.intersection(e.value,i.get(e.field)).length===e.value.length&&(t=!0):"pattern"===e.type?i.get(e.field).toString().match(e.value)&&(t=!0):t=!1}),t&&n.push(i)}),n},_filter:function(t,e,a){var l=this,i={};if(h.isString(e)?i[e]={cmp_method:"regexp"}:h.isArray(e)?h.each(e,function(t){i[t]={cmp_method:"regexp"}}):h.each(e,function(t,e){i[e]=h.defaults(t,{cmp_method:"regexp"})}),e=i,h.has(d.Paginator,"removeDiacritics")&&l.useDiacriticsPlugin&&(a=d.Paginator.removeDiacritics(a)),""===a||!h.isString(a))return t;var u=h.map(a.match(/\w+/gi),function(t){return t.toLowerCase()}),n="("+h.uniq(u).join("|")+")",c=new RegExp(n,"igm"),o=[];return h.each(t,function(r){var s=[];h.each(e,function(t,e){var i=r.get(e);if(i){var n=[];if(i=h.has(d.Paginator,"removeDiacritics")&&l.useDiacriticsPlugin?d.Paginator.removeDiacritics(i.toString()):i.toString(),"levenshtein"===t.cmp_method&&h.has(d.Paginator,"levenshtein")&&l.useLevenshteinPlugin){var o=d.Paginator.levenshtein(i,a);h.defaults(t,{max_distance:0}),o<=t.max_distance&&(n=h.uniq(u))}else n=i.match(c);n=h.map(n,function(t){return t.toString().toLowerCase()}),h.each(n,function(t){s.push(t)})}}),s=h.uniq(h.without(s,"")),h.isEmpty(h.difference(u,s))&&o.push(r)}),o},info:function(){var t=this,e={},i=t.sortedAndFilteredModels?t.sortedAndFilteredModels.length:t.length,n=Math.ceil(i/t.perPage);return e={totalUnfilteredRecords:t.origModels.length,totalRecords:i,currentPage:t.currentPage,perPage:this.perPage,totalPages:n,lastPage:n,previous:!1,next:!1,startRecord:0===i?0:(t.currentPage-1)*this.perPage+1,endRecord:Math.min(i,t.currentPage*this.perPage)},1<t.currentPage&&(e.previous=t.currentPage-1),t.currentPage<e.totalPages&&(e.next=t.currentPage+1),e.pageSet=t.setPagination(e),t.information=e},setPagination:function(t){var e=[],i=0,n=0,o=2*this.pagesInRange,r=Math.ceil(t.totalRecords/t.perPage);if(1<r)if(r<=1+o)for(i=1,n=r;i<=n;i++)e.push(i);else if(t.currentPage<=this.pagesInRange+1)for(i=1,n=2+o;i<n;i++)e.push(i);else if(r-this.pagesInRange>t.currentPage&&t.currentPage>this.pagesInRange)for(i=t.currentPage-this.pagesInRange;i<=t.currentPage+this.pagesInRange;i++)e.push(i);else for(i=r-o;i<=r;i++)e.push(i);return e},bootstrap:function(t){return h.extend(this,t),this.goTo(1),this.info(),this}}),t.clientPager.prototype.prevPage=t.clientPager.prototype.previousPage;var i=function(){var t=new c.Deferred;return t.reject(),t.promise()};return t.requestPager=d.Collection.extend({sync:function(t,n,e){var i=this;i.setDefaults();var o={};h.each(h.result(i,"server_api"),function(t,e){h.isFunction(t)&&(t=(t=h.bind(t,i))()),o[e]=t});var r=h.clone(i.paginator_core);h.each(r,function(t,e){h.isFunction(t)&&(t=(t=h.bind(t,i))()),r[e]=t}),r=h.defaults(r,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),e.data?e.data=decodeURIComponent(c.param(h.extend(o,e.data))):e.data=decodeURIComponent(c.param(o)),r=h.extend(r,{data:decodeURIComponent(c.param(o)),processData:!1,url:h.result(r,"url")},e);var s=!(0===p[0]&&9===p[1]&&10===p[2]),a=r.success;r.success=function(t,e,i){a&&(s?a(t,e,i):a(n,t,r)),p[0]<1&&n&&n.trigger&&n.trigger("sync",n,t,r)};var l=r.error;r.error=function(t){l&&l(t),n&&n.trigger&&n.trigger("error",n,t,r)};var u=r.xhr=d.ajax(r);return n&&n.trigger&&n.trigger("request",n,u,r),u},setDefaults:function(){var i=this;h.defaults(i.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4}),h.each(i.paginator_ui,function(t,e){h.isUndefined(i[e])&&(i[e]=i.paginator_ui[e])})},requestNextPage:function(t){return t=t||{},this.currentPage!==undefined?(t.remove=t.remove||!1,this.currentPage+=1,this.pager(t)):i()},requestPreviousPage:function(t){return this.currentPage!==undefined?(this.currentPage-=1,this.pager(t)):i()},updateOrder:function(t,e){return t!==undefined?(this.sortField=t,this.pager(e)):i()},goTo:function(t,e){return t!==undefined?(this.currentPage=parseInt(t,10),this.pager(e)):i()},howManyPer:function(t,e){return t!==undefined?(this.currentPage=this.firstPage,this.perPage=t,this.pager(e)):i()},info:function(){var t={totalRecords:this.totalRecords||0,currentPage:this.currentPage,firstPage:this.firstPage,totalPages:Math.ceil(this.totalRecords/this.perPage),lastPage:this.totalPages,perPage:this.perPage,previous:!1,next:!1};return 1<this.currentPage&&(t.previous=this.currentPage-1),this.currentPage<t.totalPages&&(t.next=this.currentPage+1),t.hasNext=t.next,t.hasPrevious=t.next,t.pageSet=this.setPagination(t),this.information=t},setPagination:function(t){var e=[],i=0,n=0,o=2*this.pagesInRange,r=Math.ceil(t.totalRecords/t.perPage);if(1<r)if(r<=1+o)for(i=1,n=r;i<=n;i++)e.push(i);else if(t.currentPage<=this.pagesInRange+1)for(i=1,n=2+o;i<n;i++)e.push(i);else if(r-this.pagesInRange>t.currentPage&&t.currentPage>this.pagesInRange)for(i=t.currentPage-this.pagesInRange;i<=t.currentPage+this.pagesInRange;i++)e.push(i);else for(i=r-o;i<=r;i++)e.push(i);return e},pager:function(t){return h.isObject(t)||(t={}),this.fetch(t)},url:function(){return this.paginator_core!==undefined&&this.paginator_core.url!==undefined?this.paginator_core.url:null},bootstrap:function(t){return h.extend(this,t),this.setDefaults(),this.info(),this}}),t.requestPager.prototype.nextPage=t.requestPager.prototype.requestNextPage,t.requestPager.prototype.prevPage=t.requestPager.prototype.requestPreviousPage,t}(Backbone,_,jQuery),function(i,n){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(t,e){return i.Marionette=i.Mn=n(i,t,e)});else if("undefined"!=typeof exports){var t=require("backbone"),e=require("underscore");module.exports=n(i,t,e)}else i.Marionette=i.Mn=n(i,i.Backbone,i._)}(this,function(t,s,h){"use strict";var e,i,n,o,r,a,l,u,c,d,p,f,g,_,m,v,y,w;i=h,n=(e=s).ChildViewContainer,e.ChildViewContainer=function(t,n){var i=function(t){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),n.each(t,this.add,this)};n.extend(i.prototype,{add:function(t,e){var i=t.cid;return(this._views[i]=t).model&&(this._indexByModel[t.model.cid]=i),e&&(this._indexByCustom[e]=i),this._updateLength(),this},findByModel:function(t){return this.findByModelCid(t.cid)},findByModelCid:function(t){var e=this._indexByModel[t];return this.findByCid(e)},findByCustom:function(t){var e=this._indexByCustom[t];return this.findByCid(e)},findByIndex:function(t){return n.values(this._views)[t]},findByCid:function(t){return this._views[t]},remove:function(t){var i=t.cid;return t.model&&delete this._indexByModel[t.model.cid],n.any(this._indexByCustom,function(t,e){if(t===i)return delete this._indexByCustom[e],!0},this),delete this._views[i],this._updateLength(),this},call:function(t){this.apply(t,n.tail(arguments))},apply:function(e,i){n.each(this._views,function(t){n.isFunction(t[e])&&t[e].apply(t,i||[])})},_updateLength:function(){this.length=n.size(this._views)}});var e=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return n.each(e,function(e){i.prototype[e]=function(){var t=[n.values(this._views)].concat(n.toArray(arguments));return n[e].apply(n,t)}}),i}(0,i),e.ChildViewContainer.VERSION="0.1.11",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=n,this},e.ChildViewContainer,r=h,y=(o=s).Wreqr,w=o.Wreqr={},o.Wreqr.VERSION="1.3.6",o.Wreqr.noConflict=function(){return o.Wreqr=y,this},w.Handlers=(a=o,l=r,(u=function(t){this.options=t,this._wreqrHandlers={},l.isFunction(this.initialize)&&this.initialize(t)}).extend=a.Model.extend,l.extend(u.prototype,a.Events,{setHandlers:function(t){l.each(t,function(t,e){var i=null;l.isObject(t)&&!l.isFunction(t)&&(i=t.context,t=t.callback),this.setHandler(e,t,i)},this)},setHandler:function(t,e,i){var n={callback:e,context:i};this._wreqrHandlers[t]=n,this.trigger("handler:add",t,e,i)},hasHandler:function(t){return!!this._wreqrHandlers[t]},getHandler:function(t){var e=this._wreqrHandlers[t];if(e)return function(){return e.callback.apply(e.context,arguments)}},removeHandler:function(t){delete this._wreqrHandlers[t]},removeAllHandlers:function(){this._wreqrHandlers={}}}),u),w.CommandStorage=(c=function(t){this.options=t,this._commands={},r.isFunction(this.initialize)&&this.initialize(t)},r.extend(c.prototype,o.Events,{getCommands:function(t){var e=this._commands[t];return e||(e={command:t,instances:[]},this._commands[t]=e),e},addCommand:function(t,e){this.getCommands(t).instances.push(e)},clearCommands:function(t){this.getCommands(t).instances=[]}}),c),w.Commands=(p=r,(d=w).Handlers.extend({storageType:d.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),d.Handlers.prototype.constructor.apply(this,arguments)},execute:function(t){t=arguments[0];var e=p.rest(arguments);this.hasHandler(t)?this.getHandler(t).apply(this,e):this.storage.addCommand(t,e)},_executeCommands:function(t,e,i){var n=this.storage.getCommands(t);p.each(n.instances,function(t){e.apply(i,t)}),this.storage.clearCommands(t)},_initializeStorage:function(t){var e,i=t.storageType||this.storageType;e=p.isFunction(i)?new i:i,this.storage=e}})),w.RequestResponse=(f=r,w.Handlers.extend({request:function(t){if(this.hasHandler(t))return this.getHandler(t).apply(this,f.rest(arguments))}})),w.EventAggregator=(g=o,_=r,(m=function(){}).extend=g.Model.extend,_.extend(m.prototype,g.Events),m),w.Channel=(v=function(t){this.vent=new o.Wreqr.EventAggregator,this.reqres=new o.Wreqr.RequestResponse,this.commands=new o.Wreqr.Commands,this.channelName=t},r.extend(v.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(t,e){return this._connect("vent",t,e),this},connectCommands:function(t,e){return this._connect("commands",t,e),this},connectRequests:function(t,e){return this._connect("reqres",t,e),this},_connect:function(i,t,n){if(t){n=n||this;var o="vent"===i?"on":"setHandler";r.each(t,function(t,e){this[i][o](e,r.bind(t,n))},this)}}}),v),w.radio=function(i,r){var t=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};r.extend(t.prototype,{channel:function(t){if(!t)throw new Error("Channel must receive a name");return this._getChannel(t)},_getChannel:function(t){var e=this._channels[t];return e||(e=new i.Channel(t),this._channels[t]=e),e},_proxyMethods:function(){r.each(["vent","commands","reqres"],function(e){r.each(n[e],function(t){this[e][t]=o(this,e,t)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},o=function(i,n,o){return function(t){var e=i._getChannel(t)[n];return e[o].apply(e,r.rest(arguments))}};return new t}(w,r),o.Wreqr;var b=t.Marionette,x=t.Mn,k=s.Marionette={};k.VERSION="2.4.7",k.noConflict=function(){return t.Marionette=b,t.Mn=x,this},(s.Marionette=k).Deferred=s.$.Deferred,k.extend=s.Model.extend,k.isNodeAttached=function(t){return s.$.contains(document.documentElement,t)},k.mergeOptions=function(t,e){t&&h.extend(this,h.pick(t,e))},k.getOption=function(t,e){if(t&&e)return t.options&&t.options[e]!==undefined?t.options[e]:t[e]},k.proxyGetOption=function(t){return k.getOption(this,t)},k._getValue=function(t,e,i){return h.isFunction(t)&&(t=i?t.apply(e,i):t.call(e)),t},k.normalizeMethods=function(t){return h.reduce(t,function(t,e,i){return h.isFunction(e)||(e=this[e]),e&&(t[i]=e),t},{},this)},k.normalizeUIString=function(t,e){return t.replace(/@ui\.[a-zA-Z-_$0-9]*/g,function(t){return e[t.slice(4)]})},k.normalizeUIKeys=function(t,n){return h.reduce(t,function(t,e,i){return t[k.normalizeUIString(i,n)]=e,t},{})},
k.normalizeUIValues=function(e,n,o){return h.each(e,function(i,t){h.isString(i)?e[t]=k.normalizeUIString(i,n):h.isObject(i)&&h.isArray(o)&&(h.extend(i,k.normalizeUIValues(h.pick(i,o),n)),h.each(o,function(t){var e=i[t];h.isString(e)&&(i[t]=k.normalizeUIString(e,n))}))}),e},k.actAsCollection=function(t,i){var e=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];h.each(e,function(e){t[e]=function(){var t=[h.values(h.result(this,i))].concat(h.toArray(arguments));return h[e].apply(h,t)}})};var C=k.deprecate=function(t,e){h.isObject(t)&&(t=t.prev+" is going to be removed in the future. Please use "+t.next+" instead."+(t.url?" See: "+t.url:"")),e!==undefined&&e||C._cache[t]||(C._warn("Deprecation warning: "+t),C._cache[t]=!0)};C._console="undefined"!=typeof console?console:{},C._warn=function(){return(C._console.warn||C._console.log||function(){}).apply(C._console,arguments)},C._cache={},k._triggerMethod=function(){function s(t,e,i){return i.toUpperCase()}var a=/(^|:)(\w)/gi;return function(t,e,i){var n=arguments.length<3;n&&(e=(i=e)[0]);var o,r=t["on"+e.replace(a,s)];return h.isFunction(r)&&(o=r.apply(t,n?h.rest(i):i)),h.isFunction(t.trigger)&&(1<n+i.length?t.trigger.apply(t,n?i:[e].concat(h.drop(i,0))):t.trigger(e)),o}}(),k.triggerMethod=function(){return k._triggerMethod(this,arguments)},k.triggerMethodOn=function(t){return(h.isFunction(t.triggerMethod)?t.triggerMethod:k.triggerMethod).apply(t,h.rest(arguments))},k.MonitorDOMRefresh=function(t){function e(){t._isShown=!0,n()}function i(){t._isRendered=!0,n()}function n(){t._isShown&&t._isRendered&&k.isNodeAttached(t.el)&&k.triggerMethodOn(t,"dom:refresh",t)}t._isDomRefreshMonitored||(t._isDomRefreshMonitored=!0,t.on({show:e,render:i}))},function(s){function n(i,n,o,t){var e=t.split(/\s+/);h.each(e,function(t){var e=i[t];if(!e)throw new s.Error('Method "'+t+'" was configured as an event handler, but does not exist.');i.listenTo(n,o,e)})}function o(t,e,i,n){t.listenTo(e,i,n)}function r(i,n,o,t){var e=t.split(/\s+/);h.each(e,function(t){var e=i[t];i.stopListening(n,o,e)})}function a(t,e,i,n){t.stopListening(e,i,n)}function l(i,n,t,o,r){if(n&&t){if(!h.isObject(t))throw new s.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});t=s._getValue(t,i),h.each(t,function(t,e){h.isFunction(t)?o(i,n,e,t):r(i,n,e,t)})}}s.bindEntityEvents=function(t,e,i){l(t,e,i,o,n)},s.unbindEntityEvents=function(t,e,i){l(t,e,i,a,r)},s.proxyBindEntityEvents=function(t,e){return s.bindEntityEvents(this,t,e)},s.proxyUnbindEntityEvents=function(t,e){return s.unbindEntityEvents(this,t,e)}}(k);var S=["description","fileName","lineNumber","name","message","number"];return k.Error=k.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+k.VERSION+"/",constructor:function(t,e){h.isObject(t)?t=(e=t).message:e||(e={});var i=Error.call(this,t);h.extend(this,h.pick(i,S),h.pick(e,S)),this.captureStackTrace(),e.url&&(this.url=this.urlRoot+e.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,k.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),k.Error.extend=k.extend,k.Callbacks=function(){this._deferred=k.Deferred(),this._callbacks=[]},h.extend(k.Callbacks.prototype,{add:function(e,i){var t=h.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:i}),t.then(function(t){i&&(t.context=i),e.call(t.context,t.options)})},run:function(t,e){this._deferred.resolve({options:t,context:e})},reset:function(){var t=this._callbacks;this._deferred=k.Deferred(),this._callbacks=[],h.each(t,function(t){this.add(t.cb,t.ctx)},this)}}),k.Controller=function(t){this.options=t||{},h.isFunction(this.initialize)&&this.initialize(this.options)},k.Controller.extend=k.extend,h.extend(k.Controller.prototype,s.Events,{destroy:function(){return k._triggerMethod(this,"before:destroy",arguments),k._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:k.triggerMethod,mergeOptions:k.mergeOptions,getOption:k.proxyGetOption}),k.Object=function(t){this.options=h.extend({},h.result(this,"options"),t),this.initialize.apply(this,arguments)},k.Object.extend=k.extend,h.extend(k.Object.prototype,s.Events,{initialize:function(){},destroy:function(t){return t=t||{},this.triggerMethod("before:destroy",t),this.triggerMethod("destroy",t),this.stopListening(),this},triggerMethod:k.triggerMethod,mergeOptions:k.mergeOptions,getOption:k.proxyGetOption,bindEntityEvents:k.proxyBindEntityEvents,unbindEntityEvents:k.proxyUnbindEntityEvents}),k.Region=k.Object.extend({constructor:function(t){if(this.options=t||{},this.el=this.getOption("el"),this.el=this.el instanceof s.$?this.el[0]:this.el,!this.el)throw new k.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),k.Object.call(this,t)},show:function(t,e){if(this._ensureElement()){this._ensureViewIsIntact(t),k.MonitorDOMRefresh(t);var i=e||{},n=t!==this.currentView,o=!!i.preventDestroy,r=!!i.forceShow,s=!!this.currentView,a=n&&!o,l=n||r;if(s&&this.triggerMethod("before:swapOut",this.currentView,this,e),this.currentView&&n&&delete this.currentView._parent,a?this.empty():s&&l&&this.currentView.off("destroy",this.empty,this),l){t.once("destroy",this.empty,this),(t._parent=this)._renderView(t),s&&this.triggerMethod("before:swap",t,this,e),this.triggerMethod("before:show",t,this,e),k.triggerMethodOn(t,"before:show",t,this,e),s&&this.triggerMethod("swapOut",this.currentView,this,e);var u=k.isNodeAttached(this.el),c=[],d=h.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},i);return u&&d.triggerBeforeAttach&&(c=this._displayedViews(t),this._triggerAttach(c,"before:")),this.attachHtml(t),this.currentView=t,u&&d.triggerAttach&&(c=this._displayedViews(t),this._triggerAttach(c)),s&&this.triggerMethod("swap",t,this,e),this.triggerMethod("show",t,this,e),k.triggerMethodOn(t,"show",t,this,e),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(t,e){var i=(e||"")+"attach";h.each(t,function(t){k.triggerMethodOn(t,i,t,this)},this)},_displayedViews:function(t){return h.union([t],h.result(t,"_getNestedViews")||[])},_renderView:function(t){t.supportsRenderLifecycle||k.triggerMethodOn(t,"before:render",t),t.render(),t.supportsRenderLifecycle||k.triggerMethodOn(t,"render",t)},_ensureElement:function(){if(h.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),this.$el&&0!==this.$el.length)return!0;if(this.getOption("allowMissingEl"))return!1;throw new k.Error('An "el" '+this.$el.selector+" must exist in DOM")},_ensureViewIsIntact:function(t){if(!t)throw new k.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(t.isDestroyed)throw new k.Error({name:"ViewDestroyedError",message:'View (cid: "'+t.cid+'") has already been destroyed and cannot be used.'})},getEl:function(t){return s.$(t,k._getValue(this.options.parentEl,this))},attachHtml:function(t){this.$el.contents().detach(),this.el.appendChild(t.el)},empty:function(t){var e=this.currentView,i=!!(t||{}).preventDestroy;return e&&(e.off("destroy",this.empty,this),this.triggerMethod("before:empty",e),i||this._destroyView(),this.triggerMethod("empty",e),delete this.currentView,i&&this.$el.contents().detach()),this},_destroyView:function(){var t=this.currentView;t.isDestroyed||(t.supportsDestroyLifecycle||k.triggerMethodOn(t,"before:destroy",t),t.destroy?t.destroy():(t.remove(),t.isDestroyed=!0),t.supportsDestroyLifecycle||k.triggerMethodOn(t,"destroy",t))},attachView:function(t){return this.currentView&&delete this.currentView._parent,(t._parent=this).currentView=t,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(t,e){if(h.isString(t))return this._buildRegionFromSelector(t,e);if(t.selector||t.el||t.regionClass)return this._buildRegionFromObject(t,e);if(h.isFunction(t))return this._buildRegionFromRegionClass(t);throw new k.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(t,e){return new e({el:t})},_buildRegionFromObject:function(t,e){var i=t.regionClass||e,n=h.omit(t,"selector","regionClass");return t.selector&&!n.el&&(n.el=t.selector),new i(n)},_buildRegionFromRegionClass:function(t){return new t}}),k.RegionManager=k.Controller.extend({constructor:function(t){this._regions={},this.length=0,k.Controller.call(this,t),this.addRegions(this.getOption("regions"))},addRegions:function(t,n){return t=k._getValue(t,this,arguments),h.reduce(t,function(t,e,i){return h.isString(e)&&(e={selector:e}),e.selector&&(e=h.defaults({},e,n)),t[i]=this.addRegion(i,e),t},{},this)},addRegion:function(t,e){var i;return i=e instanceof k.Region?e:k.Region.buildRegion(e,k.Region),this.triggerMethod("before:add:region",t,i),(i._parent=this)._store(t,i),this.triggerMethod("add:region",t,i),i},get:function(t){return this._regions[t]},getRegions:function(){return h.clone(this._regions)},removeRegion:function(t){var e=this._regions[t];return this._remove(t,e),e},removeRegions:function(){var t=this.getRegions();return h.each(this._regions,function(t,e){this._remove(e,t)},this),t},emptyRegions:function(){var t=this.getRegions();return h.invoke(t,"empty"),t},destroy:function(){return this.removeRegions(),k.Controller.prototype.destroy.apply(this,arguments)},_store:function(t,e){this._regions[t]||this.length++,this._regions[t]=e},_remove:function(t,e){this.triggerMethod("before:remove:region",t,e),e.empty(),e.stopListening(),delete e._parent,delete this._regions[t],this.length--,this.triggerMethod("remove:region",t,e)}}),k.actAsCollection(k.RegionManager.prototype,"_regions"),k.TemplateCache=function(t){this.templateId=t},h.extend(k.TemplateCache,{templateCaches:{},get:function(t,e){var i=this.templateCaches[t];return i||(i=new k.TemplateCache(t),this.templateCaches[t]=i),i.load(e)},clear:function(){var t,e=h.toArray(arguments),i=e.length;if(0<i)for(t=0;t<i;t++)delete this.templateCaches[e[t]];else this.templateCaches={}}}),h.extend(k.TemplateCache.prototype,{load:function(t){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId,t);return this.compiledTemplate=this.compileTemplate(e,t),this.compiledTemplate},loadTemplate:function(t){var e=s.$(t);if(!e.length)throw new k.Error({name:"NoTemplateError",message:'Could not find template: "'+t+'"'});return e.html()},compileTemplate:function(t,e){return h.template(t,e)}}),k.Renderer={render:function(t,e){if(!t)throw new k.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});return(h.isFunction(t)?t:k.TemplateCache.get(t))(e)}},k.View=s.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(t){this.render=h.bind(this.render,this),t=k._getValue(t,this),this.options=h.extend({},h.result(this,"options"),t),this._behaviors=k.Behaviors(this),s.View.call(this,this.options),k.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(t){return t.toJSON.apply(t,h.rest(arguments))},mixinTemplateHelpers:function(t){t=t||{};var e=this.getOption("templateHelpers");return e=k._getValue(e,this),h.extend(t,e)},normalizeUIKeys:function(t){var e=h.result(this,"_uiBindings");return k.normalizeUIKeys(t,e||h.result(this,"ui"))},normalizeUIValues:function(t,e){var i=h.result(this,"ui"),n=h.result(this,"_uiBindings");return k.normalizeUIValues(t,n||i,e)},configureTriggers:function(){if(this.triggers){var t=this.normalizeUIKeys(h.result(this,"triggers"));return h.reduce(t,function(t,e,i){return t[i]=this._buildViewTrigger(e),t},{},this)}},delegateEvents:function(t){return this._delegateDOMEvents(t),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),h.each(this._behaviors,function(t){t.bindEntityEvents(this.model,t.getOption("modelEvents")),t.bindEntityEvents(this.collection,t.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(t){var e=k._getValue(t||this.events,this);e=this.normalizeUIKeys(e),h.isUndefined(t)&&(this.events=e);var i={},n=h.result(this,"behaviorEvents")||{},o=this.configureTriggers(),r=h.result(this,"behaviorTriggers")||{};h.extend(i,n,e,o,r),s.View.prototype.delegateEvents.call(this,i)},undelegateEvents:function(){return s.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),h.each(this._behaviors,function(t){t.unbindEntityEvents(this.model,t.getOption("modelEvents")),t.unbindEntityEvents(this.collection,t.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new k.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var t=h.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(t)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(t)),this.unbindUIElements(),this.isRendered=!1,this.remove(),h.invoke(this._behaviors,"destroy",t),this},bindUIElements:function(){this._bindUIElements(),h.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var t=h.result(this,"_uiBindings");this.ui={},h.each(t,function(t,e){this.ui[e]=this.$(t)},this)}},unbindUIElements:function(){this._unbindUIElements(),h.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(h.each(this.ui,function(t,e){delete this.ui[e]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(t){var i=h.defaults({},t,{preventDefault:!0,stopPropagation:!0}),n=h.isObject(t)?i.event:t;return function(t){t&&(t.preventDefault&&i.preventDefault&&t.preventDefault(),t.stopPropagation&&i.stopPropagation&&t.stopPropagation());var e={view:this,model:this.model,collection:this.collection};this.triggerMethod(n,e)}},setElement:function(){var t=s.View.prototype.setElement.apply(this,arguments);return h.invoke(this._behaviors,"proxyViewProperties",this),t},triggerMethod:function(t){var e=k._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(t,h.rest(arguments)),e},_triggerEventOnBehaviors:function(t){for(var e=k._triggerMethod,i=this._behaviors,n=0,o=i&&i.length;n<o;n++)e(i[n],t)},_triggerEventOnParentLayout:function(t,e){var i=this._parentLayoutView();if(i){var n=k.getOption(i,"childViewEventPrefix")+":"+t,o=[this].concat(e);k._triggerMethod(i,n,o);var r=k.getOption(i,"childEvents");r=k._getValue(r,i);var s=i.normalizeMethods(r);s&&h.isFunction(s[t])&&s[t].apply(i,o)}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var t=this._getImmediateChildren();return t.length?h.reduce(t,function(t,e){return e._getNestedViews?t.concat(e._getNestedViews()):t},t):t},_parentLayoutView:function(){for(var t=this._parent;t;){if(t instanceof k.LayoutView)return t;t=t._parent}},normalizeMethods:k.normalizeMethods,mergeOptions:k.mergeOptions,getOption:k.proxyGetOption,bindEntityEvents:k.proxyBindEntityEvents,unbindEntityEvents:k.proxyUnbindEntityEvents}),k.ItemView=k.View.extend({constructor:function(){k.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var t=[this.model||this.collection];return arguments.length&&t.push.apply(t,arguments),this.model?this.serializeModel.apply(this,t):{items:this.serializeCollection.apply(this,t)}},serializeCollection:function(t){return t.toJSON.apply(t,h.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var t=this.getTemplate();if(!1!==t){if(!t)throw new k.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var e=this.mixinTemplateHelpers(this.serializeData()),i=k.Renderer.render(t,e,this);return this.attachElContent(i),this}},attachElContent:function(t){return this.$el.html(t),this}}),k.CollectionView=k.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(){this.once("render",this._initialEvents),this._initChildViewStorage(),k.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var t,e=this._isShown&&k.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),e&&this._triggerBeforeAttach&&(t=this._getNestedViews(),this._triggerMethodMany(t,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),e&&this._triggerAttach&&(t=this._getNestedViews(),this._triggerMethodMany(t,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(t,e,i){var n=h.drop(arguments,3);h.each(t,function(t){k.triggerMethodOn.apply(t,[t,i,t,e].concat(n))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(t,e,i){var n=i.at!==undefined&&(i.index||e.indexOf(t));if((this.getOption("filter")||!1===n)&&(n=h.indexOf(this._filteredSortedModels(n),t)),this._shouldAddChild(t,n)){this.destroyEmptyView();var o=this.getChildView(t);this.addChild(t,o,n)}},_onCollectionRemove:function(t){var e=this.children.findByModel(t);this.removeChildView(e),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(t){k.triggerMethodOn(t,"before:show",t)})},_onShowCalled:function(){this.children.each(function(t){k.triggerMethodOn(t,"show",t)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var n=this.children,t=this._filteredSortedModels();if(!t.length&&this._showingEmptyView)return this;if(h.some(t,function(t){return!n.findByModel(t)}))this.render();else{var e=h.map(t,function(t,e){var i=n.findByModel(t);return i._index=e,i.el}),i=n.filter(function(t){return!h.contains(e,t.el)});this.triggerMethod("before:reorder"),this._appendReorderedChildren(e),h.each(i,this.removeChildView,this),this.checkEmpty(),this.triggerMethod("reorder")}},resortView:function(){k.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var t=this._filteredSortedModels();h.find(t,function(t,e){var i=this.children.findByModel(t);return!i||i._index!==e},this)&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(t){this.$el.append(t)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var i,t=this._filteredSortedModels();h.each(t,function(t,e){i=this.getChildView(t),this.addChild(t,i,e)},this)},_filteredSortedModels:function(t){var e,i=this.getViewComparator(),n=this.collection.models;(t=Math.min(Math.max(t,0),n.length-1),i)&&(t&&(e=n[t],n=n.slice(0,t).concat(n.slice(t+1))),n=this._sortModelsBy(n,i),e&&n.splice(t,0,e));return this.getOption("filter")&&(n=h.filter(n,function(t,e){return this._shouldAddChild(t,e)},this)),n},_sortModelsBy:function(t,e){return"string"==typeof e?h.sortBy(t,function(t){return t.get(e)},this):1===e.length?h.sortBy(t,e,this):t.sort(h.bind(e,this))},showEmptyView:function(){var t=this.getEmptyView();if(t&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var e=new s.Model;this.addEmptyView(e,t),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(t,e){var i,n=this._isShown&&!this.isBuffering&&k.isNodeAttached(this.el),o=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");h.isFunction(o)&&(o=o.call(this,t,this._emptyViewIndex));var r=this.buildChildView(t,e,o);(r._parent=this).proxyChildEvents(r),r.once("render",function(){this._isShown&&k.triggerMethodOn(r,"before:show",r),n&&this._triggerBeforeAttach&&(i=this._getViewAndNested(r),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(r),this.renderChildView(r,this._emptyViewIndex),n&&this._triggerAttach&&(i=this._getViewAndNested(r),this._triggerMethodMany(i,this,"attach")),this._isShown&&k.triggerMethodOn(r,"show",r)},getChildView:function(){var t=this.getOption("childView");if(!t)throw new k.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(t,e,i){var n=this.getOption("childViewOptions");n=k._getValue(n,this,[t,i]);var o=this.buildChildView(t,e,n);return this._updateIndices(o,!0,i),this.triggerMethod("before:add:child",o),this._addChildView(o,i),this.triggerMethod("add:child",o),o._parent=this,o},_updateIndices:function(e,i,t){this.getOption("sort")&&(i&&(e._index=t),this.children.each(function(t){t._index>=e._index&&(t._index+=i?1:-1)}))},_addChildView:function(t,e){var i,n=this._isShown&&!this.isBuffering&&k.isNodeAttached(this.el);this.proxyChildEvents(t),t.once("render",function(){this._isShown&&!this.isBuffering&&k.triggerMethodOn(t,"before:show",t),n&&this._triggerBeforeAttach&&(i=this._getViewAndNested(t),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(t),this.renderChildView(t,e),n&&this._triggerAttach&&(i=this._getViewAndNested(t),this._triggerMethodMany(i,this,"attach")),this._isShown&&!this.isBuffering&&k.triggerMethodOn(t,"show",t)},renderChildView:function(t,e){return t.supportsRenderLifecycle||k.triggerMethodOn(t,"before:render",t),t.render(),t.supportsRenderLifecycle||k.triggerMethodOn(t,"render",t),this.attachHtml(this,t,e),t},buildChildView:function(t,e,i){var n=new e(h.extend({model:t},i));return k.MonitorDOMRefresh(n),n},removeChildView:function(t){return t&&(this.triggerMethod("before:remove:child",t),t.supportsDestroyLifecycle||k.triggerMethodOn(t,"before:destroy",t),t.destroy?t.destroy():t.remove(),t.supportsDestroyLifecycle||k.triggerMethodOn(t,"destroy",t),delete t._parent,this.stopListening(t),this.children.remove(t),this.triggerMethod("remove:child",t),this._updateIndices(t,!1)),t},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(t,e){t.$el.append(e)},_createBuffer:function(){var e=document.createDocumentFragment();return h.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(t,e,i){t.isBuffering?t._bufferedChildren.splice(i,0,e):t._insertBefore(e,i)||t._insertAfter(e)},_insertBefore:function(t,e){var i;return this.getOption("sort")&&e<this.children.length-1&&(i=this.children.find(function(t){return t._index===e+1})),!!i&&(i.$el.before(t.el),!0)},_insertAfter:function(t){this.$el.append(t.el)},_initChildViewStorage:function(){this.children=new s.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),k.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(t){var e=t||{},i=!0,n=this.children.map(h.identity);return h.isUndefined(e.checkEmpty)||(i=e.checkEmpty),this.children.each(this.removeChildView,this),i&&this.checkEmpty(),n},_shouldAddChild:function(t,e){var i=this.getOption("filter");return!h.isFunction(i)||i.call(this,t,e,this.collection)},proxyChildEvents:function(n){var o=this.getOption("childViewEventPrefix");this.listenTo(n,"all",function(){var t=h.toArray(arguments),e=t[0],i=this.normalizeMethods(h.result(this,"childEvents"));t[0]=o+":"+e,t.splice(1,0,n),void 0!==i&&h.isFunction(i[e])&&i[e].apply(this,t.slice(1)),this.triggerMethod.apply(this,t)})},_getImmediateChildren:function(){return h.values(this.children._views)},_getViewAndNested:function(t){return[t].concat(h.result(t,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),k.CompositeView=k.CollectionView.extend({constructor:function(){k.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(){return this.getOption("childView")||this.constructor},serializeData:function(){var t={};return this.model&&(t=h.partial(this.serializeModel,this.model).apply(this,arguments)),t},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&k.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var t={};t=this.serializeData(),t=this.mixinTemplateHelpers(t),this.triggerMethod("before:render:template");var e=this.getTemplate(),i=k.Renderer.render(e,t,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(t){return this.$el.html(t),this},attachBuffer:function(t,e){this.getChildViewContainer(t).append(e)},_insertAfter:function(t){this.getChildViewContainer(this,t).append(t.el)},_appendReorderedChildren:function(t){this.getChildViewContainer(this).append(t)},getChildViewContainer:function(t){if(t.$childViewContainer)return t.$childViewContainer;var e,i=k.getOption(t,"childViewContainer");if(i){var n=k._getValue(i,t);if((e="@"===n.charAt(0)&&t.ui?t.ui[n.substr(4)]:t.$(n)).length<=0)throw new k.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+t.childViewContainer})}else e=t.$el;return t.$childViewContainer=e},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=undefined)}}),k.LayoutView=k.ItemView.extend({regionClass:k.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(t){t=t||{},this._firstRender=!0,this._initializeRegions(t),k.ItemView.call(this,t)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),k.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(!0===this.getOption("destroyImmediate")&&this.$el.remove(),this.regionManager.destroy(),k.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(t){var e=this.getRegion(t);return e.show.apply(e,h.rest(arguments))},getChildView:function(t){return this.getRegion(t).currentView},addRegion:function(t,e){var i={};return i[t]=e,this._buildRegions(i)[t]},addRegions:function(t){return this.regions=h.extend({},this.regions,t),this._buildRegions(t)},removeRegion:function(t){return delete this.regions[t],this.regionManager.removeRegion(t)},getRegion:function(t){return this.regionManager.get(t)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(t){var e={regionClass:this.getOption("regionClass"),parentEl:h.partial(h.result,this,"el")};return this.regionManager.addRegions(t,e)},_initializeRegions:function(t){var e;this._initRegionManager(),e=k._getValue(this.regions,this,[t])||{};var i=this.getOption.call(t,"regions");i=k._getValue(i,this,[t]),h.extend(e,i),e=this.normalizeUIValues(e,["selector","el"]),this.addRegions(e)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new k.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),(this.regionManager._parent=this).listenTo(this.regionManager,"before:add:region",function(t){this.triggerMethod("before:add:region",t)}),this.listenTo(this.regionManager,"add:region",function(t,e){this[t]=e,this.triggerMethod("add:region",t,e)}),this.listenTo(this.regionManager,"before:remove:region",function(t){this.triggerMethod("before:remove:region",t)}),this.listenTo(this.regionManager,"remove:region",function(t,e){delete this[t],this.triggerMethod("remove:region",t,e)})},_getImmediateChildren:function(){return h.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),k.Behavior=k.Object.extend({constructor:function(t,e){this.view=e,this.defaults=h.result(this,"defaults")||{},this.options=h.extend({},this.defaults,t),this.ui=h.extend({},h.result(e,"ui"),h.result(this,"ui")),k.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(t){this.$el=t.$el,this.el=t.el}}),k.Behaviors=function(n,u){function r(t,e){return u.isObject(t.behaviors)?(e=r.parseBehaviors(t,e||u.result(t,"behaviors")),r.wrap(t,e,u.keys(s)),e):{}}function i(t,e){this._view=t,this._behaviors=e,this._triggers={}}function o(t){return t._uiBindings||t.ui}var c=/^(\S+)\s*(.*)$/,s={behaviorTriggers:function(t,e){return new i(this,e).buildBehaviorTriggers()},behaviorEvents:function(t,e){var i={};return u.each(e,function(r,s){var a={},t=u.clone(u.result(r,"events"))||{};t=n.normalizeUIKeys(t,o(r));var l=0;u.each(t,function(t,e){var i=e.match(c),n=i[1]+"."+[this.cid,s,l++," "].join("")+i[2],o=u.isFunction(t)?t:r[t];o&&(a[n]=u.bind(o,r))},this),i=u.extend(i,a)},this),i}};return u.extend(r,{behaviorsLookup:function(){throw new n.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,e){return t.behaviorClass?t.behaviorClass:n._getValue(r.behaviorsLookup,this,[t,e])[e]},parseBehaviors:function(o,t){return u.chain(t).map(function(t,e){var i=new(r.getBehaviorClass(t,e))(t,o),n=r.parseBehaviors(o,u.result(i,"behaviors"));return[i].concat(n)}).flatten().value()},wrap:function(e,i,t){u.each(t,function(t){e[t]=u.partial(s[t],e[t],i)})}}),u.extend(i.prototype,{buildBehaviorTriggers:function(){return u.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(t,e){var i=u.clone(u.result(t,"triggers"))||{};i=n.normalizeUIKeys(i,o(t)),u.each(i,u.bind(this._setHandlerForBehavior,this,t,e))},_setHandlerForBehavior:function(t,e,i,n){var o=n.replace(/^\S+/,function(t){return t+".behaviortriggers"+e});this._triggers[o]=this._view._buildViewTrigger(i)}}),r}(k,h),k.AppRouter=s.Router.extend({constructor:function(t){this.options=t||{},s.Router.apply(this,arguments);var e=this.getOption("appRoutes"),i=this._getController();this.processAppRoutes(i,e),this.on("route",this._processOnRoute,this)},appRoute:function(t,e){var i=this._getController();this._addAppRoute(i,t,e)},_processOnRoute:function(t,e){if(h.isFunction(this.onRoute)){var i=h.invert(this.getOption("appRoutes"))[t];this.onRoute(t,i,e)}},processAppRoutes:function(e,i){if(i){var t=h.keys(i).reverse();h.each(t,function(t){this._addAppRoute(e,t,i[t])},this)}},
_getController:function(){return this.getOption("controller")},_addAppRoute:function(t,e,i){var n=t[i];if(!n)throw new k.Error('Method "'+i+'" was not found on the controller');this.route(e,i,h.bind(n,t))},mergeOptions:k.mergeOptions,getOption:k.proxyGetOption,triggerMethod:k.triggerMethod,bindEntityEvents:k.proxyBindEntityEvents,unbindEntityEvents:k.proxyUnbindEntityEvents}),k.Application=k.Object.extend({constructor:function(t){this._initializeRegions(t),this._initCallbacks=new k.Callbacks,this.submodules={},h.extend(this,t),this._initChannel(),k.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(t){this._initCallbacks.add(t)},start:function(t){this.triggerMethod("before:start",t),this._initCallbacks.run(t,this),this.triggerMethod("start",t)},addRegions:function(t){return this._regionManager.addRegions(t)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(t){return this._regionManager.removeRegion(t)},getRegion:function(t){return this._regionManager.get(t)},getRegions:function(){return this._regionManager.getRegions()},module:function(t,e){var i=k.Module.getClass(e),n=h.toArray(arguments);return n.unshift(this),i.create.apply(i,n)},getRegionManager:function(){return new k.RegionManager},_initializeRegions:function(t){var e=h.isFunction(this.regions)?this.regions(t):this.regions||{};this._initRegionManager();var i=k.getOption(t,"regions");return h.isFunction(i)&&(i=i.call(this,t)),h.extend(e,i),this.addRegions(e),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),(this._regionManager._parent=this).listenTo(this._regionManager,"before:add:region",function(){k._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(t,e){this[t]=e,k._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){k._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(t){delete this[t],k._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=h.result(this,"channelName")||"global",this.channel=h.result(this,"channel")||s.Wreqr.radio.channel(this.channelName),this.vent=h.result(this,"vent")||this.channel.vent,this.commands=h.result(this,"commands")||this.channel.commands,this.reqres=h.result(this,"reqres")||this.channel.reqres}}),k.Module=function(t,e,i){this.moduleName=t,this.options=h.extend({},this.options,i),this.initialize=i.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=e,h.isFunction(this.initialize)&&this.initialize(t,e,this.options)},k.Module.extend=k.extend,h.extend(k.Module.prototype,s.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(t){this._initializerCallbacks.add(t)},addFinalizer:function(t){this._finalizerCallbacks.add(t)},start:function(e){this._isInitialized||(h.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),h.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(undefined,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(t,e){this._runModuleDefinition(t,e)},_runModuleDefinition:function(t,e){if(t){var i=h.flatten([this,this.app,s,k,s.$,h,e]);t.apply(this,i)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new k.Callbacks,this._finalizerCallbacks=new k.Callbacks},triggerMethod:k.triggerMethod}),h.extend(k.Module,{create:function(n,t,o){var r=n,s=h.drop(arguments,3),e=(t=t.split(".")).length,a=[];return a[e-1]=o,h.each(t,function(t,e){var i=r;r=this._getModule(i,t,n,o),this._addModuleDefinition(i,r,a[e],s)},this),r},_getModule:function(t,e,i,n){var o=h.extend({},n),r=this.getClass(n),s=t[e];return s||(s=new r(e,i,o),t[e]=s,t.submodules[e]=s),s},getClass:function(t){var e=k.Module;return t?t.prototype instanceof e?t:t.moduleClass||e:e},_addModuleDefinition:function(t,e,i,n){var o=this._getDefine(i),r=this._getStartWithParent(i,e);o&&e.addDefinition(o,n),this._addStartWithParent(t,e,r)},_getStartWithParent:function(t,e){var i;return h.isFunction(t)&&t.prototype instanceof k.Module?(i=e.constructor.prototype.startWithParent,!!h.isUndefined(i)||i):!h.isObject(t)||(i=t.startWithParent,!!h.isUndefined(i)||i)},_getDefine:function(t){return!h.isFunction(t)||t.prototype instanceof k.Module?h.isObject(t)?t.define:null:t},_addStartWithParent:function(t,e,i){e.startWithParent=e.startWithParent&&i,e.startWithParent&&!e.startWithParentIsConfigured&&(e.startWithParentIsConfigured=!0,t.addInitializer(function(t){e.startWithParent&&e.start(t)}))}}),k}),function(){"use strict";function n(t,e,i){"addEventListener"in window?t.addEventListener(e,i,!1):"attachEvent"in window&&t.attachEvent("on"+e,i)}function e(t){return Z+"["+tt+"] "+t}function f(t){Q&&"object"==typeof window.console&&console.log(e(t))}function a(t){"object"==typeof window.console&&console.warn(e(t))}function l(){f("Initialising iFrame"),t(),r(),o("background",D),o("padding",j),p(),d(),s(),g(),h(),P("init","Init message from host page")}function t(){function t(t){return"true"===t}var e=G.substr(X).split(":");tt=e[0],U=undefined!==e[1]?Number(e[1]):U,B=undefined!==e[2]?t(e[2]):B,Q=undefined!==e[3]?t(e[3]):Q,K=undefined!==e[4]?Number(e[4]):K,et=undefined!==e[5]?t(e[5]):et,L=undefined!==e[6]?t(e[6]):L,q=e[7],J=undefined!==e[8]?e[8]:J,D=e[9],j=e[10],rt=undefined!==e[11]?Number(e[11]):rt}function i(t,e){return-1!==e.indexOf("-")&&(a("Negative CSS value ignored for "+t),e=""),e}function o(t,e){undefined!==e&&""!==e&&"null"!==e&&f("Body "+t+' set to "'+(document.body.style[t]=e)+'"')}function r(){undefined===q&&(q=U+"px"),i("margin",q),o("margin",q)}function s(){document.documentElement.style.height="",document.body.style.height="",f('HTML & body height set to "auto"')}function u(){n(window,"resize",function(){P("resize","Window resized")})}function c(){n(window,"click",function(){P("click","Window clicked")})}function d(){W!==J&&(J in ut||(a(J+" is not a valid option for heightCalculationMethod."),J="bodyScroll"),f('Height calculation method set to "'+J+'"'))}function h(){!0===L?(u(),c(),v()):f("Auto Resize disabled")}function p(){var t=document.createElement("div");t.style.clear="both",t.style.display="block",document.body.appendChild(t)}function g(){et&&(f("Enable public methods"),window.parentIFrame={close:function t(){P("close","parentIFrame.close()",0,0)},getId:function e(){return tt},reset:function i(){E("parentIFrame.size")},scrollTo:function n(t,e){F(e,t,"scrollTo")},scrollToOffset:function n(t,e){F(e,t,"scrollToOffset")},sendMessage:function o(t,e){F(0,0,"message",JSON.stringify(t),e)},setHeightCalculationMethod:function r(t){J=t,d()},setTargetOrigin:function s(t){f("Set targetOrigin: "+t),nt=t},size:function a(t,e){var i=(t||"")+(e?","+e:"");I(),P("size","parentIFrame.size("+i+")",t,e)}})}function _(){0!==K&&(f("setInterval: "+K+"ms"),setInterval(function(){P("interval","setInterval: "+K)},Math.abs(K)))}function m(t){function i(t){t.height!==undefined&&t.width!==undefined&&0!==t.height&&0!==t.width||(f("Attach listerner to "+t.src),n(t,"load",function e(){P("imageLoad","Image loaded")}))}t.forEach(function(t){if("attributes"===t.type&&"src"===t.attributeName)i(t.target);else if("childList"===t.type){var e=t.target.querySelectorAll("img");Array.prototype.forEach.call(e,function(t){i(t)})}})}function v(){function t(){var t=document.querySelector("body"),e={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0},i=new n(function(t){P("mutationObserver","mutationObserver: "+t[0].target+" "+t[0].type),m(t)});f("Enable MutationObserver"),i.observe(t,e)}var n=window.MutationObserver||window.WebKitMutationObserver;n?K<0?_():t():(a("MutationObserver not supported in this browser!"),_())}function y(){function t(t){function e(t){if(/^\d+(px)?$/i.test(t))return parseInt(t,V);var e=n.style.left,i=n.runtimeStyle.left;return n.runtimeStyle.left=n.currentStyle.left,n.style.left=t||0,t=n.style.pixelLeft,n.style.left=e,n.runtimeStyle.left=i,t}var n=document.body,i=0;return i="defaultView"in document&&"getComputedStyle"in document.defaultView?null!==(i=document.defaultView.getComputedStyle(n,null))?i[t]:0:e(n.currentStyle[t]),parseInt(i,V)}return document.body.offsetHeight+t("marginTop")+t("marginBottom")}function w(){return document.body.scrollHeight}function b(){return document.documentElement.offsetHeight}function x(){return document.documentElement.scrollHeight}function k(){for(var t=document.querySelectorAll("body *"),e=t.length,i=0,n=(new Date).getTime(),o=0;o<e;o++)t[o].getBoundingClientRect().bottom>i&&(i=t[o].getBoundingClientRect().bottom);return n=(new Date).getTime()-n,f("Parsed "+e+" HTML elements"),f("LowestElement bottom position calculated in "+n+"ms"),i}function C(){return[y(),w(),b(),x()]}function S(){return Math.max.apply(null,C())}function M(){return Math.min.apply(null,C())}function O(){return Math.max(y(),k())}function T(){return Math.max(document.documentElement.scrollWidth,document.body.scrollWidth)}function P(t,e,i,n){function o(){t in{reset:1,resetPage:1,init:1}||f("Trigger event: "+e)}function r(){F(H=h,lt=p,t)}function s(){return st&&t in z}function a(){function t(t,e){return!(Math.abs(t-e)<=rt)}return h=undefined!==i?i:ut[J](),p=undefined!==n?n:T(),t(H,h)||B&&t(lt,p)}function l(){return!(t in{init:1,interval:1,size:1})}function u(){return J in it}function c(){f("No change in size detected")}function d(){l()&&u()?E(e):t in{interval:1}||(o(),c())}var h,p;s()?f("Trigger event cancelled: "+t):a()?(o(),I(),r()):d()}function I(){st||(st=!0,f("Trigger event lock on")),clearTimeout(at),at=setTimeout(function(){st=!1,f("Trigger event lock off"),f("--")},N)}function A(t){H=ut[J](),lt=T(),F(H,lt,t)}function E(t){var e=J;J=W,f("Reset trigger event: "+t),I(),A("reset"),J=e}function F(e,i,n,o,r){function t(){undefined===r?r=nt:f("Message targetOrigin: "+r)}function s(){var t=tt+":"+(e+":"+i)+":"+n+(undefined!==o?":"+o:"");f("Sending message to host page ("+t+")"),ot.postMessage(Z+t,r)}t(),s()}function R(t){function e(){return Z===(""+t.data).substr(0,X)}function i(){G=t.data,ot=t.source,l(),Y=!1,setTimeout(function(){$=!1},N)}function n(){$?f("Page reset ignored by init"):(f("Page size reset by host page"),A("resetPage"))}function o(){return t.data.split("]")[1]}function r(){return"iFrameResize"in window}function s(){return t.data.split(":")[2]in{"true":1,"false":1}}e()&&(Y&&s()?i():"reset"===o()?n():t.data===G||r()||a("Unexpected message ("+t.data+")"))}var L=!0,V=10,D="",U=0,q="",j="",B=!1,z={resize:1,click:1},N=128,H=1,Y=!0,W="offset",J=W,$=!0,G="",K=32,Q=!1,Z="[iFrameSizer]",X=Z.length,tt="",et=!1,it={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},nt="*",ot=window.parent,rt=0,st=!1,at=null,lt=1,ut={offset:y,bodyOffset:y,bodyScroll:w,documentElementOffset:b,scroll:x,documentElementScroll:x,max:S,min:M,grow:S,lowestElement:O};n(window,"message",R)}(),function(){var o,r={};"undefined"!=typeof exports?r=exports:"function"==typeof define?define(function(){return r}):this.Cocktail=r,r.mixins={},r.mixin=function s(t){var e=_.chain(arguments).toArray().rest().flatten().value(),i=t.prototype||t,n={};_(e).each(function(t){_.isString(t)&&(t=r.mixins[t]),_(t).each(function(t,e){if(_.isFunction(t)){if(i[e]===t)return;i[e]&&(n[e]=n[e]||[i[e]],n[e].push(t)),i[e]=t}else _.isArray(t)?i[e]=_.union(t,i[e]||[]):_.isObject(t)?i[e]=_.extend({},t,i[e]||{}):e in i||(i[e]=t)})}),_(n).each(function(t,e){i[e]=function(){var i,n=this,o=arguments;return _(t).each(function(t){var e=_.isFunction(t)?t.apply(n,o):t;i=void 0===e?i:e}),i}})},r.patch=function e(t){o=t.Model.extend;var i=function(t,e){var i=o.call(this,t,e),n=i.prototype.mixins;return n&&i.prototype.hasOwnProperty("mixins")&&r.mixin(i,n),i};_([t.Model,t.Collection,t.Router,t.View]).each(function(t){t.mixin=function e(){r.mixin(this,_.toArray(arguments))},t.extend=i})},r.unpatch=function i(t){_([t.Model,t.Collection,t.Router,t.View]).each(function(t){t.mixin=undefined,t.extend=o})}}(),jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(t,e,i,n,o){return jQuery.easing[jQuery.easing.def](t,e,i,n,o)},easeInQuad:function(t,e,i,n,o){return n*(e/=o)*e+i},easeOutQuad:function(t,e,i,n,o){return-n*(e/=o)*(e-2)+i},easeInOutQuad:function(t,e,i,n,o){return(e/=o/2)<1?n/2*e*e+i:-n/2*(--e*(e-2)-1)+i},easeInCubic:function(t,e,i,n,o){return n*(e/=o)*e*e+i},easeOutCubic:function(t,e,i,n,o){return n*((e=e/o-1)*e*e+1)+i},easeInOutCubic:function(t,e,i,n,o){return(e/=o/2)<1?n/2*e*e*e+i:n/2*((e-=2)*e*e+2)+i},easeInQuart:function(t,e,i,n,o){return n*(e/=o)*e*e*e+i},easeOutQuart:function(t,e,i,n,o){return-n*((e=e/o-1)*e*e*e-1)+i},easeInOutQuart:function(t,e,i,n,o){return(e/=o/2)<1?n/2*e*e*e*e+i:-n/2*((e-=2)*e*e*e-2)+i},easeInQuint:function(t,e,i,n,o){return n*(e/=o)*e*e*e*e+i},easeOutQuint:function(t,e,i,n,o){return n*((e=e/o-1)*e*e*e*e+1)+i},easeInOutQuint:function(t,e,i,n,o){return(e/=o/2)<1?n/2*e*e*e*e*e+i:n/2*((e-=2)*e*e*e*e+2)+i},easeInSine:function(t,e,i,n,o){return-n*Math.cos(e/o*(Math.PI/2))+n+i},easeOutSine:function(t,e,i,n,o){return n*Math.sin(e/o*(Math.PI/2))+i},easeInOutSine:function(t,e,i,n,o){return-n/2*(Math.cos(Math.PI*e/o)-1)+i},easeInExpo:function(t,e,i,n,o){return 0==e?i:n*Math.pow(2,10*(e/o-1))+i},easeOutExpo:function(t,e,i,n,o){return e==o?i+n:n*(1-Math.pow(2,-10*e/o))+i},easeInOutExpo:function(t,e,i,n,o){return 0==e?i:e==o?i+n:(e/=o/2)<1?n/2*Math.pow(2,10*(e-1))+i:n/2*(2-Math.pow(2,-10*--e))+i},easeInCirc:function(t,e,i,n,o){return-n*(Math.sqrt(1-(e/=o)*e)-1)+i},easeOutCirc:function(t,e,i,n,o){return n*Math.sqrt(1-(e=e/o-1)*e)+i},easeInOutCirc:function(t,e,i,n,o){return(e/=o/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+i:n/2*(Math.sqrt(1-(e-=2)*e)+1)+i},easeInElastic:function(t,e,i,n,o){var r=1.70158,s=0,a=n;if(0==e)return i;if(1==(e/=o))return i+n;if(s||(s=.3*o),a<Math.abs(n)){a=n;r=s/4}else r=s/(2*Math.PI)*Math.asin(n/a);return-a*Math.pow(2,10*(e-=1))*Math.sin((e*o-r)*(2*Math.PI)/s)+i},easeOutElastic:function(t,e,i,n,o){var r=1.70158,s=0,a=n;if(0==e)return i;if(1==(e/=o))return i+n;if(s||(s=.3*o),a<Math.abs(n)){a=n;r=s/4}else r=s/(2*Math.PI)*Math.asin(n/a);return a*Math.pow(2,-10*e)*Math.sin((e*o-r)*(2*Math.PI)/s)+n+i},easeInOutElastic:function(t,e,i,n,o){var r=1.70158,s=0,a=n;if(0==e)return i;if(2==(e/=o/2))return i+n;if(s||(s=o*(.3*1.5)),a<Math.abs(n)){a=n;r=s/4}else r=s/(2*Math.PI)*Math.asin(n/a);return e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*o-r)*(2*Math.PI)/s)*-.5+i:a*Math.pow(2,-10*(e-=1))*Math.sin((e*o-r)*(2*Math.PI)/s)*.5+n+i},easeInBack:function(t,e,i,n,o,r){return r==undefined&&(r=1.70158),n*(e/=o)*e*((r+1)*e-r)+i},easeOutBack:function(t,e,i,n,o,r){return r==undefined&&(r=1.70158),n*((e=e/o-1)*e*((r+1)*e+r)+1)+i},easeInOutBack:function(t,e,i,n,o,r){return r==undefined&&(r=1.70158),(e/=o/2)<1?n/2*(e*e*((1+(r*=1.525))*e-r))+i:n/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+i},easeInBounce:function(t,e,i,n,o){return n-jQuery.easing.easeOutBounce(t,o-e,0,n,o)+i},easeOutBounce:function(t,e,i,n,o){return(e/=o)<1/2.75?n*(7.5625*e*e)+i:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+i:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+i:n*(7.5625*(e-=2.625/2.75)*e+.984375)+i},easeInOutBounce:function(t,e,i,n,o){return e<o/2?.5*jQuery.easing.easeInBounce(t,2*e,0,n,o)+i:.5*jQuery.easing.easeOutBounce(t,2*e-o,0,n,o)+.5*n+i}}),function(u){function s(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function t(e,i){return function(t){return r(e.call(this,t),i)}}function e(e,i){return function(t){return this.lang().ordinal(e.call(this,t),i)}}function i(){}function n(t){x(t),l(this,t)}function a(t){var e=_(t),i=e.year||0,n=e.month||0,o=e.week||0,r=e.day||0,s=e.hour||0,a=e.minute||0,l=e.second||0,u=e.millisecond||0;this._milliseconds=+u+1e3*l+6e4*a+36e5*s,this._days=+r+7*o,this._months=+n+12*i,this._data={},this._bubble()}function l(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return e.hasOwnProperty("toString")&&(t.toString=e.toString),e.hasOwnProperty("valueOf")&&(t.valueOf=e.valueOf),t}function o(t){var e,i={};for(e in t)t.hasOwnProperty(e)&&_t.hasOwnProperty(e)&&(i[e]=t[e]);return i}function c(t){return t<0?Math.ceil(t):Math.floor(t)}function r(t,e,i){for(var n=""+Math.abs(t),o=0<=t;n.length<e;)n="0"+n;return(o?i?"+":"":"-")+n}function d(t,e,i,n){var o,r,s=e._milliseconds,a=e._days,l=e._months;s&&t._d.setTime(+t._d+s*i),(a||l)&&(o=t.minute(),r=t.hour()),a&&t.date(t.date()+a*i),l&&t.month(t.month()+l*i),s&&!n&&nt.updateOffset(t),(a||l)&&(t.minute(o),t.hour(r))}function h(t){return"[object Array]"===Object.prototype.toString.call(t)}function p(t){return"[object Date]"===Object.prototype.toString.call(t)||t instanceof Date}function f(t,e,i){var n,o=Math.min(t.length,e.length),r=Math.abs(t.length-e.length),s=0;for(n=0;n<o;n++)(i&&t[n]!==e[n]||!i&&v(t[n])!==v(e[n]))&&s++;return s+r}function g(t){if(t){var e=t.toLowerCase().replace(/(.)s$/,"$1");t=Yt[t]||Wt[e]||e}return t}function _(t){var e,i,n={};for(i in t)t.hasOwnProperty(i)&&(e=g(i))&&(n[e]=t[i]);return n}function m(s){var a,l;if(0===s.indexOf("week"))a=7,l="day";else{if(0!==s.indexOf("month"))return;a=12,l="month"}nt[s]=function(i,t){var e,n,o=nt.fn._lang[s],r=[];if("number"==typeof i&&(t=i,i=u),n=function(t){var e=nt().utc().set(l,t);return o.call(nt.fn._lang,e,i||"")},null!=t)return n(t);for(e=0;e<a;e++)r.push(n(e));return r}}function v(t){var e=+t,i=0;return 0!==e&&isFinite(e)&&(i=0<=e?Math.floor(e):Math.ceil(e)),i}function y(t,e){return new Date(Date.UTC(t,e+1,0)).getUTCDate()}function w(t){return b(t)?366:365}function b(t){return t%4==0&&t%100!=0||t%400==0}function x(t){var e;t._a&&-2===t._pf.overflow&&(e=t._a[ut]<0||11<t._a[ut]?ut:t._a[ct]<1||t._a[ct]>y(t._a[lt],t._a[ut])?ct:t._a[dt]<0||23<t._a[dt]?dt:t._a[ht]<0||59<t._a[ht]?ht:t._a[pt]<0||59<t._a[pt]?pt:t._a[ft]<0||999<t._a[ft]?ft:-1,t._pf._overflowDayOfYear&&(e<lt||ct<e)&&(e=ct),t._pf.overflow=e)}function k(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length)),t._isValid}function C(t){return t?t.toLowerCase().replace("_","-"):t}function S(t,e){return e._isUTC?nt(t).zone(e._offset||0):nt(t).local()}function M(t,e){return e.abbr=t,gt[t]||(gt[t]=new i),gt[t].set(e),gt[t]}function O(t){delete gt[t]}function T(t){var e,i,n,o,r=0,s=function(t){if(!gt[t]&&mt)try{require("./lang/"+t)}catch(e){}return gt[t]};if(!t)return nt.fn._lang;if(!h(t)){if(i=s(t))return i;t=[t]}for(;r<t.length;){for(e=(o=C(t[r]).split("-")).length,n=(n=C(t[r+1]))?n.split("-"):null;0<e;){if(i=s(o.slice(0,e).join("-")))return i;if(n&&n.length>=e&&f(o,n,!0)>=e-1)break;e--}r++}return nt.fn._lang}function P(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function I(i){var n,o,r=i.match(bt);for(n=0,o=r.length;n<o;n++)Kt[r[n]]?r[n]=Kt[r[n]]:r[n]=P(r[n]);return function(t){var e="";for(n=0;n<o;n++)e+=r[n]instanceof Function?r[n].call(t,i):r[n];return e}}function A(t,e){return t.isValid()?(e=E(e,t.lang()),Jt[e]||(Jt[e]=I(e)),Jt[e](t)):t.lang().invalidDate()}function E(t,e){function i(t){return e.longDateFormat(t)||t}var n=5;for(xt.lastIndex=0;0<=n&&xt.test(t);)t=t.replace(xt,i),xt.lastIndex=0,n-=1;return t}function F(t,e){var i=e._strict;switch(t){case"DDDD":return Rt;case"YYYY":case"GGGG":case"gggg":return i?Lt:St;case"Y":case"G":case"g":return Dt;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?Vt:Mt;case"S":if(i)return Et;case"SS":if(i)return Ft;case"SSS":if(i)return Rt;case"DDD":return Ct;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Tt;case"a":case"A":return T(e._l)._meridiemParse;case"X":return At;case"Z":case"ZZ":return Pt;case"T":return It;case"SSSS":return Ot;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?Ft:kt;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return kt;default:return new RegExp(B(j(t.replace("\\","")),"i"))}}function R(t){var e=(t=t||"").match(Pt)||[],i=((e[e.length-1]||[])+"").match(zt)||["-",0,0],n=60*i[1]+v(i[2]);return"+"===i[0]?-n:n}function L(t,e,i){var n,o=i._a;switch(t){case"M":case"MM":null!=e&&(o[ut]=v(e)-1);break;case"MMM":case"MMMM":null!=(n=T(i._l).monthsParse(e))?o[ut]=n:i._pf.invalidMonth=e;break;case"D":case"DD":null!=e&&(o[ct]=v(e));break;case"DDD":case"DDDD":null!=e&&(i._dayOfYear=v(e));break;case"YY":o[lt]=v(e)+(68<v(e)?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":o[lt]=v(e);break;case"a":case"A":i._isPm=T(i._l).isPM(e);break;case"H":case"HH":case"h":case"hh":o[dt]=v(e);break;case"m":case"mm":o[ht]=v(e);break;case"s":case"ss":o[pt]=v(e);break;case"S":case"SS":case"SSS":case"SSSS":o[ft]=v(1e3*("0."+e));break;case"X":i._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=R(e);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":t=t.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":t=t.substr(0,2),e&&(i._w=i._w||{},i._w[t]=e)}}function V(i){var t,e,n,o,r,s,a,l,u,c,d=[];if(!i._d){for(n=U(i),i._w&&null==i._a[ct]&&null==i._a[ut]&&(r=function(t){var e=parseInt(t,10);return t?t.length<3?68<e?1900+e:2e3+e:e:null==i._a[lt]?nt().weekYear():i._a[lt]},null!=(s=i._w).GG||null!=s.W||null!=s.E?a=Q(r(s.GG),s.W||1,s.E,4,1):(l=T(i._l),u=null!=s.d?J(s.d,l):null!=s.e?parseInt(s.e,10)+l._week.dow:0,c=parseInt(s.w,10)||1,null!=s.d&&u<l._week.dow&&c++,a=Q(r(s.gg),c,u,l._week.doy,l._week.dow)),i._a[lt]=a.year,i._dayOfYear=a.dayOfYear),i._dayOfYear&&(o=null==i._a[lt]?n[lt]:i._a[lt],i._dayOfYear>w(o)&&(i._pf._overflowDayOfYear=!0),e=W(o,0,i._dayOfYear),i._a[ut]=e.getUTCMonth(),i._a[ct]=e.getUTCDate()),t=0;t<3&&null==i._a[t];++t)i._a[t]=d[t]=n[t];for(;t<7;t++)i._a[t]=d[t]=null==i._a[t]?2===t?1:0:i._a[t];d[dt]+=v((i._tzm||0)/60),d[ht]+=v((i._tzm||0)%60),i._d=(i._useUTC?W:Y).apply(null,d)}}function D(t){var e;t._d||(e=_(t._i),t._a=[e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond],V(t))}function U(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function q(t){t._a=[],t._pf.empty=!0;var e,i,n,o,r,s=T(t._l),a=""+t._i,l=a.length,u=0;for(n=E(t._f,s).match(bt)||[],e=0;e<n.length;e++)o=n[e],(i=(a.match(F(o,t))||[])[0])&&(0<(r=a.substr(0,a.indexOf(i))).length&&t._pf.unusedInput.push(r),a=a.slice(a.indexOf(i)+i.length),u+=i.length),Kt[o]?(i?t._pf.empty=!1:t._pf.unusedTokens.push(o),L(o,i,t)):t._strict&&!i&&t._pf.unusedTokens.push(o);t._pf.charsLeftOver=l-u,0<a.length&&t._pf.unusedInput.push(a),t._isPm&&t._a[dt]<12&&(t._a[dt]+=12),!1===t._isPm&&12===t._a[dt]&&(t._a[dt]=0),V(t),x(t)}function j(t){return t.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,i,n,o){return e||i||n||o})}function B(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function z(t){var e,i,n,o,r;if(0===t._f.length)return t._pf.invalidFormat=!0,void(t._d=new Date(NaN));for(o=0;o<t._f.length;o++)r=0,(e=l({},t))._pf=s(),e._f=t._f[o],q(e),k(e)&&(r+=e._pf.charsLeftOver,r+=10*e._pf.unusedTokens.length,e._pf.score=r,(null==n||r<n)&&(n=r,i=e));l(t,i||e)}function N(t){var e,i,n=t._i,o=Ut.exec(n);if(o){for(t._pf.iso=!0,e=0,i=jt.length;e<i;e++)if(jt[e][1].exec(n)){t._f=jt[e][0]+(o[6]||" ");break}for(e=0,i=Bt.length;e<i;e++)if(Bt[e][1].exec(n)){t._f+=Bt[e][0];break}n.match(Pt)&&(t._f+="Z"),q(t)}else t._d=new Date(n)}function H(t){var e=t._i,i=vt.exec(e);e===u?t._d=new Date:i?t._d=new Date(+i[1]):"string"==typeof e?N(t):h(e)?(t._a=e.slice(0),V(t)):p(e)?t._d=new Date(+e):"object"==typeof e?D(t):t._d=new Date(e)}function Y(t,e,i,n,o,r,s){var a=new Date(t,e,i,n,o,r,s);return t<1970&&a.setFullYear(t),a}function W(t){var e=new Date(Date.UTC.apply(null,arguments));return t<1970&&e.setUTCFullYear(t),e}function J(t,e){if("string"==typeof t)if(isNaN(t)){if("number"!=typeof(t=e.weekdaysParse(t)))return null}else t=parseInt(t,10);return t}function $(t,e,i,n,o){return o.relativeTime(e||1,!!i,t,n)}function G(t,e,i){var n=at(Math.abs(t)/1e3),o=at(n/60),r=at(o/60),s=at(r/24),a=at(s/365),l=n<45&&["s",n]||1===o&&["m"]||o<45&&["mm",o]||1===r&&["h"]||r<22&&["hh",r]||1===s&&["d"]||s<=25&&["dd",s]||s<=45&&["M"]||s<345&&["MM",at(s/30)]||1===a&&["y"]||["yy",a];return l[2]=e,l[3]=0<t,l[4]=i,$.apply({},l)}function K(t,e,i){var n,o=i-e,r=i-t.day();return o<r&&(r-=7),r<o-7&&(r+=7),n=nt(t).add("d",r),{week:Math.ceil(n.dayOfYear()/7),year:n.year()}}function Q(t,e,i,n,o){var r,s=W(t,0,1).getUTCDay();return{year:0<(r=7*(e-1)+((i=null!=i?i:o)-o)+(o-s+(n<s?7:0)-(s<o?7:0))+1)?t:t-1,dayOfYear:0<r?r:w(t-1)+r}}function Z(t){var e=t._i,i=t._f;return null===e?nt.invalid({nullInput:!0}):("string"==typeof e&&(t._i=e=T().preparse(e)),nt.isMoment(e)?(t=o(e))._d=new Date(+e._d):i?h(i)?z(t):q(t):H(t),new n(t))}function X(t,i){nt.fn[t]=nt.fn[t+"s"]=function(t){var e=this._isUTC?"UTC":"";return null!=t?(this._d["set"+e+i](t),nt.updateOffset(this),this):this._d["get"+e+i]()}}function tt(t){nt.duration.fn[t]=function(){return this._data[t]}}function et(t,e){nt.duration.fn["as"+t]=function(){return+this/e}}function it(t){var e=!1,i=nt;"undefined"==typeof ender&&(t?(st.moment=function(){return!e&&console&&console.warn&&(e=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),i.apply(null,arguments)},l(st.moment,i)):st.moment=nt)}for(var nt,ot,rt="2.5.1",st=this,at=Math.round,lt=0,ut=1,ct=2,dt=3,ht=4,pt=5,ft=6,gt={},_t={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},mt="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,vt=/^\/?Date\((\-?\d+)/i,yt=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,wt=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,bt=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,xt=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,kt=/\d\d?/,Ct=/\d{1,3}/,St=/\d{1,4}/,Mt=/[+\-]?\d{1,6}/,Ot=/\d+/,Tt=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Pt=/Z|[\+\-]\d\d:?\d\d/gi,It=/T/i,At=/[\+\-]?\d+(\.\d{1,3})?/,Et=/\d/,Ft=/\d\d/,Rt=/\d{3}/,Lt=/\d{4}/,Vt=/[+-]?\d{6}/,Dt=/[+-]?\d+/,Ut=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,qt="YYYY-MM-DDTHH:mm:ssZ",jt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Bt=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],zt=/([\+\-]|\d\d)/gi,Nt="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),Ht={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Yt={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Wt={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Jt={},$t="DDD w W M D d".split(" "),Gt="M D H h m s w W".split(" "),Kt={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return r(this.year()%100,2)},YYYY:function(){return r(this.year(),4)},YYYYY:function(){return r(this.year(),5)},YYYYYY:function(){var t=this.year();return(0<=t?"+":"-")+r(Math.abs(t),6)},gg:function(){return r(this.weekYear()%100,2)},gggg:function(){return r(this.weekYear(),4)},ggggg:function(){return r(this.weekYear(),5)},GG:function(){return r(this.isoWeekYear()%100,2)},GGGG:function(){return r(this.isoWeekYear(),4)},GGGGG:function(){return r(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return v(this.milliseconds()/100)},SS:function(){return r(v(this.milliseconds()/10),2)},SSS:function(){return r(this.milliseconds(),3)},SSSS:function(){return r(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return t<0&&(t=-t,e="-"),e+r(v(t/60),2)+":"+r(v(t)%60,2)},ZZ:function(){var t=-this.zone(),e="+";return t<0&&(t=-t,e="-"),e+r(v(t/60),2)+r(v(t)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},Qt=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];$t.length;)ot=$t.pop(),Kt[ot+"o"]=e(Kt[ot],ot);for(;Gt.length;)ot=Gt.pop(),Kt[ot+ot]=t(Kt[ot],2);for(Kt.DDDD=t(Kt.DDD,3),l(i.prototype,{set:function(t){var e,i;for(i in t)"function"==typeof(e=t[i])?this[i]=e:this["_"+i]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,i,n;for(this._monthsParse||(this._monthsParse=[]),e=0;e<12;e++)if(this._monthsParse[e]||(i=nt.utc([2e3,e]),n="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[e]=new RegExp(n.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,i,n;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;e<7;e++)if(this._weekdaysParse[e]||(i=nt([2e3,1]).day(e),n="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[e]=new RegExp(n.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,i){return 11<t?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var i=this._calendar[t];return"function"==typeof i?i.apply(e):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,i,n){var o=this._relativeTime[i];return"function"==typeof o?o(t,e,i,n):o.replace(/%d/i,t)},pastFuture:function(t,e){var i=this._relativeTime[0<t?"future":"past"];return"function"==typeof i?i(e):i.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},
week:function(t){return K(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),(nt=function(t,e,i,n){var o;return"boolean"==typeof i&&(n=i,i=u),(o={_isAMomentObject:!0})._i=t,o._f=e,o._l=i,o._strict=n,o._isUTC=!1,o._pf=s(),Z(o)}).utc=function(t,e,i,n){var o;return"boolean"==typeof i&&(n=i,i=u),(o={_isAMomentObject:!0,_useUTC:!0,_isUTC:!0})._l=i,o._i=t,o._f=e,o._strict=n,o._pf=s(),Z(o).utc()},nt.unix=function(t){return nt(1e3*t)},nt.duration=function(t,e){var i,n,o,r=t,s=null;return nt.isDuration(t)?r={ms:t._milliseconds,d:t._days,M:t._months}:"number"==typeof t?(r={},e?r[e]=t:r.milliseconds=t):(s=yt.exec(t))?(i="-"===s[1]?-1:1,r={y:0,d:v(s[ct])*i,h:v(s[dt])*i,m:v(s[ht])*i,s:v(s[pt])*i,ms:v(s[ft])*i}):(s=wt.exec(t))&&(i="-"===s[1]?-1:1,r={y:(o=function(t){var e=t&&parseFloat(t.replace(",","."));return(isNaN(e)?0:e)*i})(s[2]),M:o(s[3]),d:o(s[4]),h:o(s[5]),m:o(s[6]),s:o(s[7]),w:o(s[8])}),n=new a(r),nt.isDuration(t)&&t.hasOwnProperty("_lang")&&(n._lang=t._lang),n},nt.version=rt,nt.defaultFormat=qt,nt.updateOffset=function(){},nt.lang=function(t,e){return t?(e?M(C(t),e):null===e?(O(t),t="en"):gt[t]||T(t),(nt.duration.fn._lang=nt.fn._lang=T(t))._abbr):nt.fn._lang._abbr},nt.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),T(t)},nt.isMoment=function(t){return t instanceof n||null!=t&&t.hasOwnProperty("_isAMomentObject")},nt.isDuration=function(t){return t instanceof a},ot=Qt.length-1;0<=ot;--ot)m(Qt[ot]);for(nt.normalizeUnits=function(t){return g(t)},nt.invalid=function(t){var e=nt.utc(NaN);return null!=t?l(e._pf,t):e._pf.userInvalidated=!0,e},nt.parseZone=function(t){return nt(t).parseZone()},l(nt.fn=n.prototype,{clone:function(){return nt(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var t=nt(this).utc();return 0<t.year()&&t.year()<=9999?A(t,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):A(t,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return k(this)},isDSTShifted:function(){return!!this._a&&(this.isValid()&&0<f(this._a,(this._isUTC?nt.utc(this._a):nt(this._a)).toArray()))},parsingFlags:function(){return l({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(t){var e=A(this,t||nt.defaultFormat);return this.lang().postformat(e)},add:function(t,e){return d(this,"string"==typeof t?nt.duration(+e,t):nt.duration(t,e),1),this},subtract:function(t,e){return d(this,"string"==typeof t?nt.duration(+e,t):nt.duration(t,e),-1),this},diff:function(t,e,i){var n,o,r=S(t,this),s=6e4*(this.zone()-r.zone());return"year"===(e=g(e))||"month"===e?(n=432e5*(this.daysInMonth()+r.daysInMonth()),o=12*(this.year()-r.year())+(this.month()-r.month()),o+=(this-nt(this).startOf("month")-(r-nt(r).startOf("month")))/n,o-=6e4*(this.zone()-nt(this).startOf("month").zone()-(r.zone()-nt(r).startOf("month").zone()))/n,"year"===e&&(o/=12)):(n=this-r,o="second"===e?n/1e3:"minute"===e?n/6e4:"hour"===e?n/36e5:"day"===e?(n-s)/864e5:"week"===e?(n-s)/6048e5:n),i?o:c(o)},from:function(t,e){return nt.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(nt(),t)},calendar:function(){var t=S(nt(),this).startOf("day"),e=this.diff(t,"days",!0),i=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(i,this))},isLeapYear:function(){return b(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?(t=J(t,this.lang()),this.add({d:t-e})):e},month:function(t){var e,i=this._isUTC?"UTC":"";return null!=t?("string"==typeof t&&"number"!=typeof(t=this.lang().monthsParse(t))||(e=this.date(),this.date(1),this._d["set"+i+"Month"](t),this.date(Math.min(e,this.daysInMonth())),nt.updateOffset(this)),this):this._d["get"+i+"Month"]()},startOf:function(t){switch(t=g(t)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t?this.weekday(0):"isoWeek"===t&&this.isoWeekday(1),this},endOf:function(t){return t=g(t),this.startOf(t).add("isoWeek"===t?"week":t,1).subtract("ms",1)},isAfter:function(t,e){return e=void 0!==e?e:"millisecond",+this.clone().startOf(e)>+nt(t).startOf(e)},isBefore:function(t,e){return e=void 0!==e?e:"millisecond",+this.clone().startOf(e)<+nt(t).startOf(e)},isSame:function(t,e){return e=e||"ms",+this.clone().startOf(e)==+S(t,this).startOf(e)},min:function(t){return(t=nt.apply(null,arguments))<this?this:t},max:function(t){return this<(t=nt.apply(null,arguments))?this:t},zone:function(t){var e=this._offset||0;return null==t?this._isUTC?e:this._d.getTimezoneOffset():("string"==typeof t&&(t=R(t)),Math.abs(t)<16&&(t*=60),this._offset=t,this._isUTC=!0,e!==t&&d(this,nt.duration(e-t,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(t){return t=t?nt(t).zone():0,(this.zone()-t)%60==0},daysInMonth:function(){return y(this.year(),this.month())},dayOfYear:function(t){var e=at((nt(this).startOf("day")-nt(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(t){var e=K(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==t?e:this.add("y",t-e)},isoWeekYear:function(t){var e=K(this,1,4).year;return null==t?e:this.add("y",t-e)},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},isoWeek:function(t){var e=K(this,1,4).week;return null==t?e:this.add("d",7*(t-e))},weekday:function(t){var e=(this.day()+7-this.lang()._week.dow)%7;return null==t?e:this.add("d",t-e)},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},get:function(t){return this[t=g(t)]()},set:function(t,e){return"function"==typeof this[t=g(t)]&&this[t](e),this},lang:function(t){return t===u?this._lang:(this._lang=T(t),this)}}),ot=0;ot<Nt.length;ot++)X(Nt[ot].toLowerCase().replace(/s$/,""),Nt[ot]);for(ot in X("year","FullYear"),nt.fn.days=nt.fn.day,nt.fn.months=nt.fn.month,nt.fn.weeks=nt.fn.week,nt.fn.isoWeeks=nt.fn.isoWeek,nt.fn.toJSON=nt.fn.toISOString,l(nt.duration.fn=a.prototype,{_bubble:function(){var t,e,i,n,o=this._milliseconds,r=this._days,s=this._months,a=this._data;a.milliseconds=o%1e3,t=c(o/1e3),a.seconds=t%60,e=c(t/60),a.minutes=e%60,i=c(e/60),a.hours=i%24,r+=c(i/24),a.days=r%30,s+=c(r/30),a.months=s%12,n=c(s/12),a.years=n},weeks:function(){return c(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*v(this._months/12)},humanize:function(t){var e=+this,i=G(e,!t,this.lang());return t&&(i=this.lang().pastFuture(e,i)),this.lang().postformat(i)},add:function(t,e){var i=nt.duration(t,e);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(t,e){var i=nt.duration(t,e);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(t){return this[(t=g(t)).toLowerCase()+"s"]()},as:function(t){return this["as"+(t=g(t)).charAt(0).toUpperCase()+t.slice(1)+"s"]()},lang:nt.fn.lang,toIsoString:function(){var t=Math.abs(this.years()),e=Math.abs(this.months()),i=Math.abs(this.days()),n=Math.abs(this.hours()),o=Math.abs(this.minutes()),r=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(t?t+"Y":"")+(e?e+"M":"")+(i?i+"D":"")+(n||o||r?"T":"")+(n?n+"H":"")+(o?o+"M":"")+(r?r+"S":""):"P0D"}}),Ht)Ht.hasOwnProperty(ot)&&(et(ot,Ht[ot]),tt(ot.toLowerCase()));et("Weeks",6048e5),nt.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},nt.lang("en",{ordinal:function(t){var e=t%10;return t+(1===v(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th")}}),mt?(module.exports=nt,it(!0)):"function"==typeof define&&define.amd?define("moment",function(t,e,i){return i.config&&i.config()&&!0!==i.config().noGlobal&&it(i.config().noGlobal===u),nt}):it()}.call(this),function(){var n={prefix:"",format:""},g={serialize:function(t){if(null===t)return"";var e=[];for(prop in t)if(t[prop])if(t[prop]instanceof Array)for(var i=0;i<t[prop].length;i++)key=prop+encodeURIComponent("[]"),e.push(key+"="+encodeURIComponent(t[prop][i].toString()));else e.push(prop+"="+encodeURIComponent(t[prop].toString()));return 0===e.length?"":"?"+e.join("&")},clean_path:function(t){return t.replace(/\/+/g,"/").replace(/[\)\(]/g,"").replace(/\.$/m,"").replace(/\/$/m,"")},extract:function(t,e){var i=undefined;return e.hasOwnProperty(t)?(i=e[t],delete e[t]):n.hasOwnProperty(t)&&(i=n[t]),i},extract_format:function(t){var e=t.hasOwnProperty("format")?t.format:n.format;return delete t.format,e?"."+e:""},extract_anchor:function(t){var e=t.hasOwnProperty("anchor")?t.anchor:null;return delete t.anchor,e?"#"+e:""},extract_options:function(t,e){return e.length>t&&"object"==typeof e[e.length-1]?e.pop():{}},path_identifier:function(t){return t?"object"==typeof t?("function"==typeof t.to_param&&t.to_param()||t.to_param||t.id||t).toString():t.toString():""},build_path:function(t,e,i,n){n=Array.prototype.slice.call(n);var o=g.get_prefix(),r=g.extract_options(t,n);if(n.length>t)throw new Error("Too many parameters provided for path");for(var s=0,a=0,l=0;l<e.length;l++){var u=e[l];if(g.optional_part(u)){var c=i[a];a++;var d=g.extract(c,r);g.specified(d)&&(o+=u,o+=g.path_identifier(d))}else if(o+=u,s<t){s++;var h=n.shift();if(!g.specified(h))throw new Error("Insufficient parameters to build path");o+=g.path_identifier(h)}}var p=g.extract_format(r),f=g.extract_anchor(r);return g.clean_path(o+p+f)+g.serialize(r)},specified:function(t){return!(t===undefined||null===t)},optional_part:function(t){return t.match(/\(/)},get_prefix:function(){var t=n.prefix;return""!==t&&(t=t.match("/$")?t:t+"/"),t}};window.Routes={jammit_path:function(t,e,i){return g.build_path(2,["/assets/","."],["format"],arguments)},resque_path:function(t){return g.build_path(0,["/resque"],[],arguments)},v2_album_scheduled_events_path:function(t,e){return g.build_path(1,["/v2/albums/","/scheduled_events"],["format"],arguments)},csv_import_v2_albums_path:function(t){return g.build_path(0,["/v2/albums/csv_import"],["format"],arguments)},v2_albums_path:function(t){return g.build_path(0,["/v2/albums"],["format"],arguments)},new_v2_album_path:function(t){return g.build_path(0,["/v2/albums/new"],["format"],arguments)},edit_v2_album_path:function(t,e){return g.build_path(1,["/v2/albums/","/edit"],["format"],arguments)},v2_album_path:function(t,e){return g.build_path(1,["/v2/albums/"],["format"],arguments)},v2_scheduled_events_path:function(t){return g.build_path(0,["/v2/scheduled_events"],["format"],arguments)},new_v2_scheduled_event_path:function(t){return g.build_path(0,["/v2/scheduled_events/new"],["format"],arguments)},edit_v2_scheduled_event_path:function(t,e){return g.build_path(1,["/v2/scheduled_events/","/edit"],["format"],arguments)},v2_scheduled_event_path:function(t,e){return g.build_path(1,["/v2/scheduled_events/"],["format"],arguments)},v2_photos_path:function(t){return g.build_path(0,["/v2/photos"],["format"],arguments)},new_v2_photo_path:function(t){return g.build_path(0,["/v2/photos/new"],["format"],arguments)},edit_v2_photo_path:function(t,e){return g.build_path(1,["/v2/photos/","/edit"],["format"],arguments)},v2_photo_path:function(t,e){return g.build_path(1,["/v2/photos/"],["format"],arguments)},user_custom_css_presets_path:function(t){return g.build_path(0,["/user_custom_css_presets"],["format"],arguments)},new_user_custom_css_preset_path:function(t){return g.build_path(0,["/user_custom_css_presets/new"],["format"],arguments)},edit_user_custom_css_preset_path:function(t,e){return g.build_path(1,["/user_custom_css_presets/","/edit"],["format"],arguments)},user_custom_css_preset_path:function(t,e){return g.build_path(1,["/user_custom_css_presets/"],["format"],arguments)},how_page_path:function(t){return g.build_path(0,["/how-pixlee-works"],["format"],arguments)},contact_page_path:function(t){return g.build_path(0,["/contact-us"],["format"],arguments)},our_customers_page_path:function(t){return g.build_path(0,["/our-customers"],["format"],arguments)},get_started_page_path:function(t){return g.build_path(0,["/get-started"],["format"],arguments)},logos_page_path:function(t){return g.build_path(0,["/logos"],["format"],arguments)},jobs_page_path:function(t){return g.build_path(0,["/jobs"],["format"],arguments)},mission_page_path:function(t){return g.build_path(0,["/mission"],["format"],arguments)},team_page_path:function(t){return g.build_path(0,["/team"],["format"],arguments)},press_page_path:function(t){return g.build_path(0,["/press"],["format"],arguments)},upgrade_browser_path:function(t){return g.build_path(0,["/upgrade_browser"],["format"],arguments)},product_page_path:function(t){return g.build_path(0,["/product"],["format"],arguments)},photorank_page_path:function(t){return g.build_path(0,["/photosmeetdata"],["format"],arguments)},usecases_page_path:function(t){return g.build_path(0,["/use-cases"],["format"],arguments)},css_generator_path:function(t){return g.build_path(0,["/css_generator"],["format"],arguments)},legal_page_path:function(t){return g.build_path(0,["/legal"],["format"],arguments)},dmca_page_path:function(t){return g.build_path(0,["/dmca"],["format"],arguments)},terms_path:function(t){return g.build_path(0,["/terms"],["format"],arguments)},case_study_niners_path:function(t){return g.build_path(0,["/case-studies/niners"],["format"],arguments)},case_study_whistler_path:function(t){return g.build_path(0,["/case-studies/whistler"],["format"],arguments)},case_study_warriors_path:function(t){return g.build_path(0,["/case-studies/warriors"],["format"],arguments)},case_study_sanuk_path:function(t){return g.build_path(0,["/case-studies/sanuk"],["format"],arguments)},account_frozen_page_path:function(t){return g.build_path(0,["/account_lock"],["format"],arguments)},register_new_user_path:function(t){return g.build_path(0,["/register/new_user"],["format"],arguments)},register_all_path:function(t){return g.build_path(0,["/register/all"],["format"],arguments)},new_user_path:function(t){return g.build_path(0,["/new_user"],["format"],arguments)},pricing_page_path:function(t){return g.build_path(0,["/pricing"],["format"],arguments)},signup_path:function(t){return g.build_path(0,["/signup"],["format"],arguments)},show_signup_form_path:function(t){return g.build_path(0,["/register/form"],["format"],arguments)},register_path:function(t){return g.build_path(0,["/register"],["format"],arguments)},new_user_free_path:function(t){return g.build_path(0,["/register/enterprise-trial"],["format"],arguments)},invoice_show_path:function(t,e){return g.build_path(1,["/invoices/view/"],["format"],arguments)},billing_create_user_path:function(t){return g.build_path(0,["/signup_user"],["format"],arguments)},billing_do_change_card_path:function(t){return g.build_path(0,["/account/change_card"],["format"],arguments)},stripe_hook_path:function(t){return g.build_path(0,["/billing/webhook"],["format"],arguments)},feedback_add_path:function(t){return g.build_path(0,["/feedback"],["format"],arguments)},contact_us_add_path:function(t){return g.build_path(0,["/contact"],["format"],arguments)},forgot_password_path:function(t){return g.build_path(0,["/reset"],["format"],arguments)},reset_pass_path:function(t,e){return g.build_path(1,["/reset/"],["format"],arguments)},login_path:function(t){return g.build_path(0,["/login"],["format"],arguments)},logout_path:function(t){return g.build_path(0,["/logout"],["format"],arguments)},user_already_exists_path:function(t){return g.build_path(0,["/register/exists"],["format"],arguments)},user_url_available_path:function(t){return g.build_path(0,["/register/url_available"],["format"],arguments)},user_settings_path:function(t){return g.build_path(0,["/settings"],["format"],arguments)},get_stripe_account_path:function(t){return g.build_path(0,["/get_stripe_account"],["format"],arguments)},user_invoices_path:function(t,e){return g.build_path(1,["/users/","/invoices"],["format"],arguments)},new_user_invoice_path:function(t,e){return g.build_path(1,["/users/","/invoices/new"],["format"],arguments)},edit_user_invoice_path:function(t,e,i){return g.build_path(2,["/users/","/invoices/","/edit"],["format"],arguments)},user_invoice_path:function(t,e,i){return g.build_path(2,["/users/","/invoices/"],["format"],arguments)},users_path:function(t){return g.build_path(0,["/users"],["format"],arguments)},edit_user_path:function(t,e){return g.build_path(1,["/users/","/edit"],["format"],arguments)},user_path:function(t,e){return g.build_path(1,["/users/"],["format"],arguments)},user_session_path:function(t){return g.build_path(0,["/user_session"],["format"],arguments)},new_user_session_path:function(t){return g.build_path(0,["/user_session/new"],["format"],arguments)},edit_user_session_path:function(t){return g.build_path(0,["/user_session/edit"],["format"],arguments)},password_resets_path:function(t){return g.build_path(0,["/password_resets"],["format"],arguments)},new_password_reset_path:function(t){return g.build_path(0,["/password_resets/new"],["format"],arguments)},edit_password_reset_path:function(t,e){return g.build_path(1,["/password_resets/","/edit"],["format"],arguments)},password_reset_path:function(t,e){return g.build_path(1,["/password_resets/"],["format"],arguments)},billing_do_cancel_subscription_path:function(t){return g.build_path(0,["/account/cancel_subscription"],["format"],arguments)},billing_do_change_subscription_path:function(t){return g.build_path(0,["/account/change_subscription"],["format"],arguments)},get_photo_messages_path:function(t,e){return g.build_path(1,["/direct_messaging/get_photo_messages/"],["format"],arguments)},send_direct_message_path:function(t){return g.build_path(0,["/direct_messaging/send_direct_message"],["format"],arguments)},set_photo_messages_to_read_path:function(t){return g.build_path(0,["/direct_messaging/set_photo_messages_to_read"],["format"],arguments)},social_publish_path:function(t,e){return g.build_path(1,["/social/publish/"],["format"],arguments)},auth_facebook_setup_path:function(t){return g.build_path(0,["/auth/facebook/setup"],["format"],arguments)},facebook_pages_list_path:function(t){return g.build_path(0,["/facebook_pages/list"],["format"],arguments)},open_graph:function(t){return g.build_path(0,["/social/open_graph"],["format"],arguments)},tumblr_blogs_list_path:function(t){return g.build_path(0,["/tumblr_blogs/list"],["format"],arguments)},facebook_album_publish_path:function(t,e){return g.build_path(1,["/albums/","/publish_to_facebook"],["format"],arguments)},tumblr_publish_path:function(t,e){return g.build_path(1,["/tumblr/publish/"],["format"],arguments)},social_logout_path:function(t,e){return g.build_path(1,["/","/logout"],["format"],arguments)},box_publish_path:function(t){return g.build_path(0,["/box/publish"],["format"],arguments)},user_analytics_path:function(t){return g.build_path(0,["/analytics"],["format"],arguments)},photo_approve_path:function(t){return g.build_path(0,["/photos/approve"],["format"],arguments)},photo_deny_path:function(t){return g.build_path(0,["/photos/deny"],["format"],arguments)},photo_approve_all_path:function(t){return g.build_path(0,["/photos/approve_visible"],["format"],arguments)},photo_deny_all_path:function(t){return g.build_path(0,["/photos/deny_visible"],["format"],arguments)},update_photos_path:function(t){return g.build_path(0,["/update_photos"],["format"],arguments)},publish_all_albums_path:function(t){return g.build_path(0,["/albums/publish_all"],["format"],arguments)},album_settings_path:function(t,e){return g.build_path(1,["/albums/","/settings"],["format"],arguments)},album_collect_settings_path:function(t,e){return g.build_path(1,["/albums/","/collect"],["format"],arguments)},album_publish_settings_path:function(t,e){return g.build_path(1,["/albums/","/publish"],["format"],arguments)},album_copy_path:function(t){return g.build_path(0,["/albums/copy"],["format"],arguments)},dashboard_path:function(t){return g.build_path(0,["/dashboard"],["format"],arguments)},notifications_path:function(t,e){return g.build_path(1,["/notifications/"],["format"],arguments)},app_path:function(t){return g.build_path(0,["/app"],["format"],arguments)},inbox_albums_path:function(t){return g.build_path(0,["/inbox/albums"],["format"],arguments)},photo_thumb_path:function(t,e){return g.build_path(1,["/photos/thumb/"],["format"],arguments)},album_photo_insights_path:function(t,e){return g.build_path(1,["/albums/","/insights"],["format"],arguments)},album_graph_stats_path:function(t,e){return g.build_path(1,["/albums/","/graph"],["format"],arguments)},root_path:function(t){return g.build_path(0,["/"],["format"],arguments)},user_super_short_album_add_path:function(t,e,i){return g.build_path(2,["/","/","/add"],["format"],arguments)},user_albums_path:function(t,e){return g.build_path(1,["/"],["format"],arguments)},albums_create_distill_path:function(t){return g.build_path(0,["/albums/create_distill"],["format"],arguments)},create_custom_flag_list_path:function(t){return g.build_path(0,["/users/custom_flag_list"],["format"],arguments)},social_share_param:function(){return"/social/share_social_media?"},category_list_path:function(t){return g.build_path(1,["/categories/"],["format"],arguments)},rails_info_properties_path:function(t){return g.build_path(0,["/rails/info/properties"],["format"],arguments)}},window.Routes.options=n}(),function(t){var o,r;r=t.sync,t.sync=function(t,e,i){var n;return i=i||{},_.defaults(i,{beforeSend:_.bind(o.beforeSend,e),complete:_.bind(o.complete,e)}),n=r(t,e,i),e._fetch||"read"!==t?n:e._fetch=n},o={beforeSend:function(){return this.trigger("sync:start",this)},complete:function(){return this.trigger("sync:stop",this)}}}(Backbone);var __bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp=Object.prototype.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},log_debug=function(){window.console&&window.console.firebug&&console.log.apply(this,arguments)},__slice=[].slice;Array.prototype.insertAt=function(t,e){return this.splice(t,0,e)},String.prototype.insertAt=function(t,e){return 0<t?this.substring(0,t)+e+this.substring(t,this.length):e+this},Date.prototype.addDays=function(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+t),e},Array.prototype.forEach||(Array.prototype.forEach=function(t,e){"use strict";if(null==this||"function"!=typeof t)throw new TypeError;for(var i=Object(this),n=i.length>>>0,o=2<=arguments.length?e:void 0,r=0;r<n;r++)r in i&&t.call(o,i[r],r,i)}),function(u){if(u.fn.toggleWrapper=function(t,e){var i,n,o;return null==t&&(t={}),null==e&&(e=!0),_.defaults(t,{className:"",backgroundColor:"transparent"!==this.css("backgroundColor")?this.css("backgroundColor"):"white",zIndex:"auto"===this.css("zIndex")?1e3:Number(this.css("zIndex"))}),n=this.offset(),o=this.outerWidth(!1),i=this.outerHeight(!1),e?u("<div>").appendTo("body").addClass(t.className).attr("data-wrapper",!0).css({width:o,height:i,top:n.top,left:n.left,position:"absolute",zIndex:t.zIndex+1}):u("[data-wrapper]").remove()},!u.support.cors&&u.ajaxTransport&&window.XDomainRequest){var t=/^https?:\/\//i,e=/^get|post$/i,o=new RegExp("^"+location.protocol,"i"),c=/text\/html/i,d=/\/json/i,h=/\/xml/i;u.ajaxTransport("* text html xml json",function(i,n){if(i.crossDomain&&i.async&&e.test(i.type)&&t.test(i.url)&&o.test(i.url)){var a=null,l=(n.dataType||"").toLowerCase();return{send:function(t,s){a=new XDomainRequest,/^\d+$/.test(n.timeout)&&(a.timeout=n.timeout),a.ontimeout=function(){s(500,"timeout")},a.onload=function(){var t="Content-Length: "+a.responseText.length+"\r\nContent-Type: "+a.contentType,e={code:200,message:"success"},i={text:a.responseText};try{if("html"===l||c.test(a.contentType))i.html=a.responseText;else if("json"===l||"text"!==l&&d.test(a.contentType))try{i.json=u.parseJSON(a.responseText)}catch(o){e.code=500,e.message="parseerror"}else if("xml"===l||"text"!==l&&h.test(a.contentType)){var n=new ActiveXObject("Microsoft.XMLDOM");n.async=!1;try{n.loadXML(a.responseText)}catch(o){n=undefined}if(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)throw e.code=500,e.message="parseerror","Invalid XML: "+a.responseText;i.xml=n}}catch(r){throw r}finally{s(e.code,e.message,i,t)}},a.onprogress=function(){},a.onerror=function(){s(500,"error",{text:a.responseText})};var e="";n.data&&(e="string"===u.type(n.data)?n.data:u.param(n.data)),a.open(i.type,i.url),a.send(e)},abort:function(){a&&a.abort()}}}})}}($),jQuery.browser={},jQuery.browser.msie=!1,jQuery.browser.version=0,navigator.userAgent.match(/MSIE ([0-9]+)\./)&&(jQuery.browser.msie=!0,jQuery.browser.version=RegExp.$1),window.videojs&&(videojs.options.flash.swf="https://assets.pixlee.com/flash/video-js.swf");var Pixlee=function(t,e){function i(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null==i?null:decodeURIComponent(i[1].replace(/\+/g," "))}function n(){$.ajax({url:"/initializeCookie",type:"POST",data:{distinct_user_hash:gon.distinct_user_hash},dataType:"json",success:function(t){gon.pixlee_votes=t.votes,s.execute("vote:loaded");var e={name:"pixlee:vote:loaded",type:"relay",source:"widget",destination:"lightbox",data:{pixlee_votes:t.votes}};window.top.postMessage(JSON.stringify(e),"*")}})}function o(){if(d<c)d+=1,setTimeout(function(){_.isFalsy(gon.distinct_user_hash)?("undefined"!=typeof analytics&&analytics.getAnonymousId&&(gon.distinct_user_hash=analytics.getAnonymousId()),o()):n()},100);else;}function r(){window.addEventListener("message",function(t){var e;if(t.data){try{e=JSON.parse(t.data)}catch(i){return}e.name&&"pixlee:css:generated"===e.name&&$.ajax({url:"/generatecss",type:"POST",data:e.data,dataType:"json",success:function(t){$("#proserveStylesheet").html(t.proserve_css),$("#dynamicStylesheet").html(t.css),s.execute("stylesheet:generated",t.css,t.params,t.display_options),s.displayOptions.set("standaloneOptions.bannerImage_showHide",e.data.displayOptions.standaloneOptions.bannerImage_showHide),s.displayOptions.set("standaloneOptions.logoImage_showHide",e.data.displayOptions.standaloneOptions.logoImage_showHide),s.displayOptions.set("standaloneOptions.logoImage_input",e.data.displayOptions.standaloneOptions.logoImage_input),s.displayOptions.set("standaloneOptions.bannerImage_input",e.data.displayOptions.standaloneOptions.bannerImage_input),s.displayOptions.set("standaloneOptions.logoImage_backgroundImage",e.data.displayOptions.standaloneOptions.logoImage_backgroundImage),s.displayOptions.set("standaloneOptions.bannerImage_backgroundImage",e.data.displayOptions.standaloneOptions.bannerImage_backgroundImage),s.displayOptions.set("headerOptions.end_tile_upload_button_background_showHide",e.data.displayOptions.headerOptions.end_tile_upload_button_background_showHide),s.displayOptions.set("reviewOptions.lightboxReviews",e.data.displayOptions.reviewOptions.lightboxReviews),s.displayOptions.set("reviewOptions.frequency",e.data.displayOptions.reviewOptions.frequency),s.displayOptions.set("carouselOptions.smoothSwiping",e.data.displayOptions.carouselOptions.smoothSwiping),s.displayOptions.set("pageSize",e.data.displayOptions.pageSize)}})}},!1)}var s;(s=new e.Application).version="v4";var a={name:"pixlee:widget:size:fix",type:"action",source:"widget",destination:"parent",data:{widgetType:gon.type,widgetId:gon.publication_id}};"show_widget"===gon.action&&window.parent.postMessage(JSON.stringify(a),"*");var l={name:"pixlee:experiment:info",type:"action",source:"widget",destination:"parent",data:{experimenting:gon.experimenting}};if(l.data.experimenting&&(l.data.experiment_id=gon.experiment_id,l.data.experiment_group=gon.experiment_group),window.parent.postMessage(JSON.stringify(l),"*"),gon.experimenting&&gon.experiment_group&&"no_widget"===gon.experiment_group){var u={name:"pixlee:hide:widget",type:"action",source:"widget",destination:"parent",data:{}};window.parent.postMessage(JSON.stringify(u),"*")}var c=gon.current_album&&gon.current_album.campaign?50:1,d=0;if(!gon.previewMode&&(i("ab_test",document.location.href)||!_.isFalsy(gon.current_account.extra_fields)&&!_.isFalsy(gon.current_account.extra_fields.AB))){gon.AB="A",$("html").easyab({slot:1,name:"widget",alternatives:[{alternative:function(t){gon.AB="B",t.hide()}}]});var h={name:"pixlee:widget:ab",type:"action",source:"widget",destination:"parent",data:{abTest:!0,bucket:gon.AB}};window.parent.postMessage(JSON.stringify(h),"*")}return s.on("before:start",function(t){if(s.isWidget=!0,s.config=s.request("set:config:photos:app"),s.currentUser=s.request("set:current:user",t.current_account),s.currentAlbum=s.request("set:current:album",t.current_album),s.displayOptions=s.request("set:display:options",t.display_options),s.recipe=s.request("set:recipe",t.recipe),_.isFalsy(s.currentAlbum.get("description"))?_.isFalsy(s.currentAlbum.get("title"))?s.altText="This is a photo gallery":s.altText="This is a photo gallery with the title of: "+s.request("decode:utf8",s.currentAlbum.get("title")):s.altText="This is a photo gallery with the title of: "+s.request("decode:utf8",s.currentAlbum.get("description")),gon.previewMode)r();else{var e=function(t){var e;if(t.data){try{e=JSON.parse(t.data)}catch(n){return}var i;if(e&&e.name&&"pixlee:hide:lightbox"===e.name&&_.isTruthy(window.lastElement)&&window.lastElement.focus(),e&&e.name&&"pixlee:close:uploader"===e.name&&_.isTruthy(window.lastElement)&&window.lastElement.focus(),e&&e.name&&"pixlee:social:login"==e.name&&s.execute("social:login",e.data),e&&e.name&&"pixlee:social:login:loaded"==e.name&&s.execute("social:login:loaded"),e&&e.name&&"pixlee:widget:visible"==e.name&&e.data.src===window.location.href&&setTimeout(function(){s.execute("widget:visible")},500),e&&e["function"]&&"kpiEvent"==e["function"])e.data&&e.data.event&&(i=e.data.event),s.execute("kpi:event",i);e.name&&"pixlee:fingerprint"===e.name&&(gon.fingerprint=e.data)}};window.addEventListener("message",e,!1)}s.publication_id=t.widget_id}),o(),s.reqres.setHandler("get:current:user",function(){return s.currentUser}),s.reqres.setHandler("get:current:album",function(){return s.currentAlbum}),s.reqres.setHandler("get:config",function(){return s.config}),s.reqres.setHandler("get:display:options",function(){return s.displayOptions}),s.reqres.setHandler("get:recipe",function(){return s.recipe}),s.reqres.setHandler("get:photo:url",function(t){return Routes.distillery_photo_path(t)}),s.reqres.setHandler("get:location:url",function(){return Routes.distillery_analytics_location_path()}),s.addRegions({widget:"#widget"}),s.reqres.setHandler("default:region",function(){return s.widget}),s.commands.setHandler("register:instance",function(t,e){if("development"===s.config.environment)return s.register(t,e)}),s.reqres.setHandler("concern",function(t){return s.Concerns[t]}),s.commands.setHandler("unregister:instance",function(t,e){if("development"===s.config.environment)return s.unregister(t,e)}),s.commands.setHandlers({"show:uploader:loader":function(){$("#uploader_loader").show()},"hide:uploader:loader":function(){$("#uploader_loader").hide()}}),s}(Backbone,Marionette);Pixlee.module("Concerns",function(t,e,i,n,r){t.HorizontalCollectionView={onShow:function(){gon.isMobileDevice?(this.width=0,r(this.el).parent().css({"overflow-x":"scroll","overflow-y":"hidden","-webkit-overflow-scrolling":"touch"}),r("#hw_container").width(gon.containerWidth)):(this.startSly(),r("#left-nav-arrow").addClass("inactive-arrow")),0===this.collection.length&&r("#widget_header_table,#photowall_description").css("opacity","1")},startSly:function(){this.sly=new Sly(r(this.el).parent(),{horizontal:1,itemNav:"basic",
itemSelector:".photo-item-container",speed:300}),this.sly.init(),gon.v2&&(r("body").css({"padding-right":"40px","padding-left":"40px"}),this.setWidgetHeight())},onAddChild:function(t){var e=this;clearTimeout(this.timer),this.firstLoad?(this.$el.unbind(".imagesLoaded"),e.loadSly(t)):(this.timer=setTimeout(function(){e.firstLoad=!0},100),this.$el.imagesLoaded().always(function(){e.loadSly(t)}))},loadSly:function(t){var e=this;if(gon.v2){var i=r(t.$el).find(".photo_block");t.$el.css({opacity:1});var n=r(t.$el).find(".lightboxed, .img_holder"),o=r(t.$el).find("svg, .image_info");i.css({height:e.getPhotoSize(),width:e.getPhotoSize()}),n.css({height:e.getPhotoSize(),width:e.getPhotoSize()}),o.css({width:e.getPhotoSize()})}else t.$el.css({opacity:1,height:"210px",width:"220px","float":"left",display:"block"}),r(t.$el).find(".layer_share").css({height:"210px",width:"200px",top:0}),r(t.$el).find(".vote_button").css({"margin-left":"22px",left:"auto"});gon.isMobileDevice||this.initialized?!gon.isMobileDevice&&this.initialized&&e.sly.reload():(this.initialized=!0,setTimeout(function(){e.sly.reload()},50)),e.trigger("images:loaded"),gon.isMobileDevice&&(this.width+=r(".photo-item-container").outerWidth()+15,r(this.el).width(this.width))},setWidgetHeight:function(){r("#widgets_main_region").removeClass("photowall_widget_medium"),gon.display_options&&"small_photo"===gon.display_options.photoSize?r("#widgets_main_region").addClass("photowall_widget_small"):gon.display_options&&"medium_photo"===gon.display_options.photoSize?r("#widgets_main_region").addClass("photowall_widget_medium"):gon.display_options&&r("#widgets_main_region").addClass("photowall_widget_large")},getPhotoSize:function(){if(gon.v2){if(gon.display_options&&"small_photo"===gon.display_options.photoSize)return"150px";if(gon.display_options&&"medium_photo"===gon.display_options.photoSize)return"200px";if(gon.display_options)return"260px"}else{if(gon.display_options&&"small_photo"===gon.display_options.photoSize)return"150px";if(gon.display_options&&"medium_photo"===gon.display_options.photoSize)return"200px";if(gon.display_options)return"240px"}},onBeforeAddChild:function(t){this.initLoader||gon.isMobileDevice||this.showLoader(),t.$el.css({opacity:0})},onDestroy:function(){},calcHorizontal:function(){r(".arrows").css({"margin-top":"-"+(parseInt(this.getPhotoSize(),10)+10)+"px",height:parseInt(this.getPhotoSize(),10)+"px"})}}}),Pixlee.module("Concerns",function(t,e,i,n,a,o){t.MasonryCollectionView={onShow:function(){0===this.collection.length&&a("#widget_header_table, #photowall_description").css("opacity","1"),this.counter=0,gon.v2||gon.packery||this.initMasonry(),gon.packery&&this.initPackery()},onRender:function(){gon.v2||gon.packery||this.initMasonry()},initPackery:function(){this.$el.packery({itemSelector:".photo-item-container",gutter:10}),this.referenceCollection=e.request("get:photos:widget:photowall"),this.image_count=0,this.moreimages=[],gon.fresh_images=[],this.child_views=[],this.$el.css("width","100%"),this.$el.addClass("mosiac")},changeRandomImage:function(){var t=this;if(0!=gon.fresh_images.length||this.syncing)if(0<gon.fresh_images.length){this.syncing=!1;var e=Math.floor(Math.random()*this.child_views.length);gon.lightBoxOpen||this.child_views[e].changeImage();t=this;setTimeout(function(){t.changeRandomImage()},5e3)}else setTimeout(function(){0<t.moreimages.length&&(o.each(t.moreimages,function(t){t.attributes&&t.attributes.source_url&&gon.fresh_images.push(t)}),t.moreimages=[]),t.referenceCollection.each(function(t){t.attributes&&t.attributes.source_url&&gon.fresh_images.push(t)}),t.changeRandomImage()},5e3);else this.referenceCollection.reset(),this.referenceCollection.models=[],t.referenceCollection.next?this.referenceCollection.nextPage():(gon.currentLength=0,this.referenceCollection.goTo(1)),this.syncing=!0,t.changeRandomImage()},onAddChild:function(t){var e=this;if(t.$el.find(".box").css("margin-bottom",a(".gutter").width()),"empty_photowall"!=t.$el.attr("id")){a("#widget_header_table,#photowall_description").css("opacity","1"),"undefined"!=typeof gon.widget&&(e.loaded||e.removeLoader()),t.$el.css({opacity:1});var i=a(t.$el).find(".lightboxed"),n=a(t.$el).find(".photo_block, .img_holder"),o=a(t.$el).find("svg, .image_info");if(!gon.v2||gon.isMobileDevice||gon.packery)if(gon.packery&&!gon.isMobileDevice)if(this.image_count<16){var r=e.randomPhotoSize()+"px";n.css({height:r,width:r}),i.css({height:r,width:r}),o.remove(),t.$el.find(".social_holder, .vote_button").remove(),t.$el.css({height:r,width:r}),this.$el.packery("appended",t.$el),this.$el.find(".img_holder").cycle({speed:500,timeout:0}),this.child_views.push(t),this.image_count++}else{var s=t.model;this.moreimages.push(s),t.model.collection.remove(t.model),this.image_count++,t.remove()}else gon.v2||(a(t.$el).find(".layer_share").css({height:e.getPhotoSize(),width:e.getPhotoSize(),top:0}),a(t.$el).find(".box_bg_image").css({height:e.getPhotoSize(),width:e.getPhotoSize()}),e.$el.masonry("appended",t.$el));else n.css({height:e.getPhotoSize(),width:e.getPhotoSize()}),i.css({height:e.getPhotoSize(),width:e.getPhotoSize()}),o.css({width:e.getPhotoSize()});e.trigger("images:loaded")}else t.$el.css({opacity:1})},onBeforeAddChild:function(t){"undefined"!=typeof gon.widget&&(this.initLoader||this.showLoader()),t.$el.css({opacity:0})},randomPhotoSize:function(){return 0==this.counter?(this.counter++,350):(2==this.counter?this.counter=0:this.counter++,170)},onRemoveChild:function(t){if(gon.packery)return!1;this.$el.masonry("remove",a(t)),this.$el.masonry({itemSelector:".box",gutter:a(".gutter").width(),isFitWidth:!0,isAnimatedFromBottom:!0})},onDestroy:function(){this.destroyMasonry()},destroyMasonry:function(){this.$el.masonry("destroy")},initMasonry:function(){this.$el.masonry(this.getDefaultsMasonryOptions())},getPhotoSize:function(){if(gon.v2){if(gon.display_options&&"small_photo"===gon.display_options.photoSize)return"150px";if(gon.display_options&&"medium_photo"===gon.display_options.photoSize)return"200px";if(gon.display_options)return"260px"}else{if(gon.display_options&&"small_photo"===gon.display_options.photoSize)return"150px";if(gon.display_options&&"medium_photo"===gon.display_options.photoSize)return"200px";if(gon.display_options)return"240px"}},getDefaultsMasonryOptions:function(){var t;return gon.display_options&&"small_photo"===gon.display_options.photoSize?150:gon.display_options&&"medium_photo"===gon.display_options.photoSize?200:gon.display_options?240:227,t=gon.isMobileDevice?0:"0",{itemSelector:gon.v2?".photo_block":".box",gutter:a(".gutter").width(),isFitWidth:!0,isAnimatedFromBottom:!0,transitionDuration:t}}}}),Pixlee.module("Concerns",function(t,i,e,n,o,r){var s={submitterAnchorVine:function(){switch(this.submitterType()){case"instagram":return"image"!=this.content_type&&this.content_type?r.isFalsy(this.platform_link)?'<a class="instagram_video" href="http://instagram.com/'+this.submitter().replace("@","")+'" target="_blank">@'+this.submitter().replace("@","")+"</a>":'<a class="instagram_video" href="'+this.platform_link+'" target="_blank">@'+this.submitter().replace("@","")+"</a>":r.isFalsy(this.platform_link)?'<a class="instagram" href="http://instagram.com/'+this.submitter().replace("@","")+'" target="_blank">@'+this.submitter().replace("@","")+"</a>":'<a class="instagram handle" href="'+this.platform_link+'" target="_blank">@'+this.submitter().replace("@","")+"</a>";default:return'<a class="vine">'+this.submitter()+"</a>"}return""},setDisplayOptions:function(){this.displayOptions||(this.displayOptions=i.reqres.request("get:display:options").toJSON())},userVotedSet:function(){var t=o.cookie("pixlee_likes");return r.contains(t,this.album_id+"_"+this.album_photo_id)},getActionLink:function(){return this.setDisplayOptions(),r.isFalsy(this.richAction)||r.isFalsy(this.richAction.link)?r.isFalsy(this.action_link)?r.isFalsy(gon.current_album.action_link)?r.isFalsy(gon.display_options.customCallToActionLink)?"":gon.display_options.customCallToActionLink:gon.current_album.action_link:this.action_link:this.richAction.link},getVotedText:function(){return r.isFalsy(gon.display_options.customVotedText)?"voted":gon.display_options.customVotedText},getActionText:function(){return this.setDisplayOptions(),r.isFalsy(this.richAction)||r.isFalsy(this.richAction.action_link_text)?r.isFalsy(this.action_link_text)?r.isFalsy(gon.current_album.action_link_text)?r.isFalsy(gon.display_options.customCallToActionText)?"":gon.display_options.customCallToActionText:gon.current_album.action_link_text:this.action_link_text:this.richAction.action_link_text},hasActionLink:function(){return this.setDisplayOptions(),553!=gon.current_account.id&&(!!i.reqres.request("get:current:user").canAccess("ecomm")||(!r.isFalsy(this.action_link_title)&&!r.isFalsy(this.action_link_photo)||(!!gon.display_options.customCallToActionPhoto||(!(!this.displayOptions.showCallToAction||r.isFalsy(this.displayOptions.customCallToActionText)||r.isFalsy(this.displayOptions.customCallToActionLink))||(!(r.isFalsy(this.action_link_text)||r.isFalsy(this.action_link)||!gon.display_options.showCallToAction)||(!r.isFalsy(this.action_link)||!r.isFalsy(gon.current_album.action_link)))))))},hasIndividualActionLink:function(){return!r.isFalsy(this.action_link_text)&&!r.isFalsy(this.action_link)},submitterType:function(){return r.isFalsy(this.source)?"desktop":this.source},submitterAnchor:function(t){switch(r.isFalsy(t)&&(t=!1),this.submitterType()){case"instagram":return"image"!=this.content_type&&this.content_type?r.isFalsy(this.platform_link)?'<a class="instagram_video handle" href="http://instagram.com/'+this.submitter().replace("@","")+'" target="_blank">@'+this.submitter().replace("@","")+"</a>":'<a class="instagram_video" href="'+this.platform_link+'" target="_blank">@'+this.submitter().replace("@","")+"</a>":r.isFalsy(this.platform_link)?'<a class="instagram handle" href="http://instagram.com/'+this.submitter().replace("@","")+'" target="_blank">@'+this.submitter().replace("@","")+"</a>":'<a class="instagram handle" href="'+this.platform_link+'" target="_blank">@'+this.submitter().replace("@","")+"</a>";case"twitter":return"image"!=this.content_type&&this.content_type?r.isFalsy(this.platform_link)?'<a class="vine handle">'+this.submitter()+"</a>":'<a class="vine handle" href="'+this.platform_link+'" target="_blank">@'+this.submitter().replace("@","")+"</a>":r.isFalsy(this.platform_link)?'<a class="twitter handle" href="http://twitter.com/'+this.submitter().replace("@","")+'" target="_blank">@'+this.submitter().replace("@","")+"</a>":'<a class="twitter handle" href="'+this.platform_link+'" target="_blank">@'+this.submitter().replace("@","")+"</a>";case"website":return'<a class="website handle">'+this.submitter()+"</a>";case"facebook":return'<a class="facebook handle">'+this.submitter()+"</a>";case"email":return t?'<a class="email handle" ></a>':'<a class="email handle">'+this.submitter()+"</a>";case"desktop":return'<a class="email handle">'+this.submitter()+"</a>";default:return'<a class="submitted_by_you handle">'+this.submitter(t)+"</a>"}return'<a class="website handle">'+this.submitter()+"</a>"},createdDate:function(){return moment(this.created_at).format("MMMM D, YYYY")},submitter:function(){return null!=this.user_name?i.request("escape:html",this.user_name):null==this.email_address||i.isWidget?(i.isWidget,""):i.request("escape:html",this.email_address)},getTitle:function(){return null!=this.title&&"null"!=this.title?this.title:null!=this.album_title&&"null"!=this.album_title&&""!=this.album_title?this.album_title:null!=this.photo_title&&"null"!=this.photo_title&&""!=this.photo_title?this.photo_title:""},altText:function(){var t="";if(r.isFalsy(this.alt_text))try{r.isFalsy(this.submitter())?(t+="Photo submission ",r.isFalsy(this.submitterType)||(t+="to "+i.request("escape:html",this.submitterType())+" ")):(t+="Photo taken by "+i.request("escape:html",this.submitter())+" ",r.isFalsy(this.submitterType)||(t+="on "+i.request("escape:html",this.submitterType())+" ")),r.isFalsy(this.getTitle())||(t+=" with the caption of: "+i.request("escape:html",this.getTitle())+".")}catch(e){t=""}else t=this.alt_text;return i.request("escape:html",t)},uploaderAdditionalFields:function(){var t=this.uploader_additional_fields,i="";return r.isEmpty(t)||r.each(t,function(t,e){e=e.split(" ")[0],i+='<div class="additional_upload_info '+e+'">'+t+"</div>"}),i},photoURL:function(t){if(null!=this.data_file_name)return this.photoFileURL(t);switch(this.submitterType()){case"instagram":if("image"!=this.content_type&&this.content_type){if("video"==this.content_type)return this.thumbnail_url.replace("http://","https://")}else if(null!=this.source_url)return this.source_url.replace("http://","https://");break;case"facebook":case"website":case"email":case"desktop":if(null!=this.source_url)return this.source_url.replace("http://","https://");break;case"twitter":if("image"!=this.content_type&&this.content_type){if("video"==this.content_type)return this.thumbnail_url.replace("http://","https://")}else if(null!=this.source_url)return this.source_url.replace("http://","https://");break;default:if(null!=this.source_url)return this.source_url.replace("http://","https://")}return""},photoFileURL:function(t){return t=t||"medium",this.config&&"development"==this.config.env?"http://s3.amazonaws.com/"+"pixlee-dev"+"/photos/"+(this.id||this.photo_id)+"/"+t+"/"+i.reqres.request("encode:utf8",this.data_file_name):"https://static.pixlee.com"+"/photos/"+(this.id||this.photo_id)+"/"+t+"/"+i.reqres.request("encode:utf8",this.data_file_name)},dedicatedLink:function(){return gon.global.pixleePhotosServer+this.currentUser.id+"/"+this.album_id+"/"+this.album_photo_id},dedicatedPath:function(){return"/"+this.currentUser.id+"/"+this.album_id+"/"+this.album_photo_id},videoURL:function(){return this.source_url.replace("http://","https://")},isVideo:function(){return"video"==this.content_type},isStory:function(){return"instagram_story"===this.subtype},shouldShowCaptions:function(){return!0},getCustomVideoThumbnail:function(){var t=this.video_settings||{};return!r.isEmpty(t)&&r.isTruthy(t.thumbnail_url)?t.thumbnail_url.replace("http://","https://"):null},thumbnail:function(t){var e=this.getCustomVideoThumbnail();return e||(r.isTruthy(this.data_file_name)&&(this.approved||this.resized)?this.photoFileURL(t):(this.medium_url||this.thumbnail_url||this.source_url||"").replace("http://","https://")||this.photoFileURL(t))},isStarred:function(){return"t"==this.is_starred||1==this.is_starred},showDate:function(){return!!gon.display_options.showTimestampsOnPhotowall},getDate:function(){return moment(this.tagged_at).format("MM/DD/YYYY")},getCaption:function(){return this.caption||""},requiredCaptions:function(){return r.isTruthy(i.displayOptions.get("requiredCaptions"))},captionPlaceholder:function(){return i.displayOptions.get("captionPlaceholder")||"Write a caption..."},productFieldEnabled:function(){return i.displayOptions.get("enableProductField")},productPlaceholder:function(){return(i.displayOptions.get("productFieldName").toUpperCase()||"PRODUCT:")+" "+(i.displayOptions.get("productFieldPlaceholder")||"Adding the product name, URL or location helps with getting your content featured!")},decode_utf8:function(t){return i.request("decode:utf8",t)}};t.PhotoViewHelpers={templateHelpers:s},t.PhotoHelpers=s}),Pixlee.module("Entities",function(t,e,i,n,o,r){t.Collection=i.Collection.extend({sliced:function(t,e){var i=this;return i=r(i.rest(t)),(i=r(i.first(e))).map(function(t){return t})},decode_utf8:function(t){return e.request("decode:utf8",t)},constructor:function(t,e){(e=e||{}).url&&(this.url=e.url),i.Collection.prototype.constructor.apply(this,arguments)}}),t.ClientPaginatedCollection=i.Paginator.clientPager.extend({paginator_ui:{firstPage:1,currentPage:1,perPage:30,totalPages:10},paginator_core:{type:"GET",dataType:"JSON",cache:!0}}),t.FilterableCollection=t.Collection.extend({clearFilterCriterias:function(){this._currentCriteria=!1,this._originalModels=null},filterBy:function(i,t){var n,o=this;!r.isFalsy(this._currentCriteria)&&r.isFalsy(t)||(this._originalModels=this.models,this._remaining_count=this.remaining_count),i?(n=[],r.each(this._originalModels,function(t){for(var e in i)-1!=o.decode_utf8(t.get(e).toLowerCase()).indexOf(i[e].toLowerCase())&&n.push(t)}),this._currentCriteria=i,this.remaining_count=n.length):(n=this._originalModels,this.clearFilterCriterias(),this.remaining_count=this._remaining_count),this.reset(n),this.trigger("collection:filtered")}}),t.PaginatedCollection=function(t){function i(t,e){e=e||{},this.paginator_core=this.paginator_core||{},this.paginator_ui=this.paginator_ui||{},this.server_api=this.server_api||{},this.sessionId=Math.floor(Date.now()/6e5)+"",r.defaults(this.paginator_core,{type:"GET",dataType:"JSON",url:r.result(e,"url"),cache:!0}),r.defaults(this.paginator_ui,{firstPage:1,currentPage:1,perPage:30,totalPages:10}),gon.isMobileDevice&&(this.paginator_ui.perPage=10),this.album=e.album,this.sort=e.sort,this.filter=e.filter,i.__super__.constructor.call(this,t,e)}return __extends(i,t),i.prototype.decode_utf8=function(t){return e.request("decode:utf8",t)},i}(i.Paginator.requestPager)}),Pixlee.module("Entities",function(e,t,i,n,r,s){var o;e.Model=function(t){function o(t){return this.saveError=__bind(this.saveError,this),this.saveSuccess=__bind(this.saveSuccess,this),t=t||{},s.extend(this,s.pick(t,e)),o.__super__.constructor.apply(this,arguments)}var e=["urlRoot","collection"];return __extends(o,t),o.prototype.destroy=function(t){return t=t||{},s.defaults(t,{wait:!0}),this.set({_destroy:!0},{silent:!0}),o.__super__.destroy.call(this,t)},o.prototype.isDestroyed=function(){return this.get("_destroy")},o.prototype.save=function(t,e,i){var n;return null!=t&&"object"!=typeof t||(i=e),i=i||{},n=this.isNew(),Cocktail.mixin(i,{wait:!0,success:s.bind(this.saveSuccess,this,n,this.collection,i.index),error:s.bind(this.saveError,this)}),this.unset("_errors"),o.__super__.save.call(this,t,e,i)},o.prototype.saveSuccess=function(t,e,i){return t?(e&&e.add(this,{at:i||0}),e&&e.trigger("model:created",this),this.trigger("created",this)):(e&&e.trigger("model:updated",this),this.trigger("updated",this))},o.prototype.saveError=function(t,e){var i;if(500!==e.status&&404!==e.status)return this.set({_errors:null!=(i=r.parseJSON(e.responseText))?i.errors:void 0})},o}(i.Model),e.DeepModel=function(t){function o(t){return this.saveError=__bind(this.saveError,this),this.saveSuccess=__bind(this.saveSuccess,this),t=t||{},s.extend(this,s.pick(t,e)),o.__super__.constructor.apply(this,arguments)}var e=["urlRoot","collection"];return __extends(o,t),o.prototype.destroy=function(t){return t=t||{},s.defaults(t,{wait:!0}),this.set({_destroy:!0},{silent:!0}),o.__super__.destroy.call(this,t)},o.prototype.isDestroyed=function(){return this.get("_destroy")},o.prototype.save=function(t,e,i){var n;return null!=t&&"object"!=typeof t||(i=e),i=i||{},n=this.isNew(),Cocktail.mixin(i,{wait:!0,success:s.bind(this.saveSuccess,this,n,this.collection,i.index),error:s.bind(this.saveError,this)}),this.unset("_errors"),o.__super__.save.call(this,t,e,i)},o.prototype.saveSuccess=function(t,e,i){return t?(e&&e.add(this,{at:i||0}),e&&e.trigger("model:created",this),this.trigger("created",this)):(e&&e.trigger("model:updated",this),this.trigger("updated",this))},o.prototype.saveError=function(t,e){var i;if(500!==e.status&&404!==e.status)return this.set({_errors:null!=(i=r.parseJSON(e.responseText))?i.errors:void 0})},o}(i.DeepModel),o={newModel:function(t){return new e.Model(t)}},t.reqres.setHandler("new:model",function(t){return t=t||{},o.newModel(t)})}),Pixlee.module("Controllers",function(t,i,e,n,o,r){t.Application=function(t){function e(t){null==t&&(t={}),this.region=t.region||i.request("default:region"),this._instance_id=r.uniqueId("controller"),i.execute("register:instance",this,this._instance_id),e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.destroy=function(){return i.execute("unregister:instance",this,this._instance_id),e.__super__.destroy.apply(this,arguments)},e.prototype.show=function(t,e){null==e&&(e={}),r.defaults(e,{loading:!1,region:this.region}),this._setMainView(t),this._manageView(t,e)},e.prototype._setMainView=function(t){this._mainView||(this._mainView=t,this.listenTo(t,"destroy",this.destroy))},e.prototype._manageView=function(t,e){e.loading?i.commands.execute("show:loading",t,e):e.region.show(t)},e}(n.Controller)}),Pixlee.module("Utilities",function(t,e,i,n){n.Behaviors.behaviorsLookup=function(){return e.Behaviors}}),Pixlee.module("Utilities",function(t,e,i,n,o,r){e.commands.setHandler("when:fetched",function(t,e){var i;return i=r.chain([t]).flatten().pluck("_fetch").value(),o.when.apply(o,i).done(function(){return e()})})}),Pixlee.module("Utilities",function(t,h,i,e,a,p){var f,n,g=Routes.social_share_param();f={decodeUtf8:function(t){var e=t;try{e=decodeURIComponent(t)}catch(i){try{e=unescape(t)}catch(i){e=t}}return e},murmurhash3_32_gc:function(t,e){var i,n,o,r,s,a,l,u;for(i=3&t.length,n=t.length-i,o=e,s=3432918353,a=461845907,u=0;u<n;)l=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24,++u,o=27492+(65535&(r=5*(65535&(o=(o^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:o^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(u)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return o^=t.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0},encodeUtf8:function(t){var e=t;try{e=encodeURIComponent(t)}catch(i){try{e=escape(t)}catch(i){e=t}}return e},escapeHtml:function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},i=h.request("decode:utf8",t);return String(i).replace(/[&<>"'\/]/g,function(t){return e[t]})},getEncodeDecodeConverter:function(){return function(t,e){return p.isFalsy(e)?"":t===i.ModelBinder.Constants.ModelToView?h.reqres.request("decode:utf8",e):h.reqres.request("encode:utf8",e)}},getBooleanToStringConverter:function(){return function(t,e){return t===i.ModelBinder.Constants.ModelToView?(!1===e||"false"===e||!p.isFalsy(e))&&e.toString():"true"==e}},getDataTypeAnalyticsConverter:function(){return function(t,e){return t===i.ModelBinder.Constants.ModelToView?"total"==e?"true":"false":"true"==e?"total":"approved"}},getStartDateConverter:function(){return function(t,e){return t===i.ModelBinder.Constants.ModelToView?n.formateDate(e):moment(e).startOf("day").utc().unix()}},getStartDateAnalyticsConverter:function(){return function(t,e){return t===i.ModelBinder.Constants.ModelToView?n.formateDateAnalytics(e):(e=new Date(e.replace(/-/g,"/")),moment(e).startOf("day").utc().unix())}},getEndDateConverter:function(){return function(t,e){return t===i.ModelBinder.Constants.ModelToView?n.formateDate(e):moment(e).endOf("day").utc().unix()}},getEndDateAnalyticsConverter:function(){return function(t,e){return t===i.ModelBinder.Constants.ModelToView?n.formateDateAnalytics(e):moment(e).endOf("day").utc().unix()}},decodeEncodeUtf8:function(t){return this.encodeUtf8(this.decodeUtf8(t))},compactInt:function(t,e){var i,n,o,r,s,a,l,u,c,d,h,p,f,g,_,m,v;if(e=e||0,e=Math.max(e,0),c=(a=parseInt(t,10))<0?"-":"",l=(p=""+(d=Math.abs(a))).length,i=["T","B","M","k"],d<1e3)return""+c+p;if(l>(u=[13,10,7,4])[0]+3)return a.toExponential(e).replace("e+","x10^");for(_=0,m=u.length;_<m;_++)if((v=u[_])<=l){s=v;break}return n=l-s+1,g=(h=p.split("")).slice(0,n),r=h.slice(n,n+e+1),f=g.join(""),(o=r.join("")).length<e&&(o+=""+new Array(e-o.length+1).join("0")),0===e?""+c+f+i[u.indexOf(s)]:""+c+(+(f+"."+o)).toFixed(e)+i[u.indexOf(s)]},insertParam:function(t,e,i){if(0<=t.indexOf(e+"=")){var n=t.substring(0,t.indexOf(e)),o=t.substring(t.indexOf(e)).substring(t.indexOf("=")+1);t=n+e+"="+i+(o=0<=o.indexOf("&")?o.substring(o.indexOf("&")):"")}else t.indexOf("?")<0?t+="?"+e+"="+i:t+="&"+e+"="+i;return t},removeParam:function(t,e){var i=String(t),n=new RegExp("\\?"+e+"=[^&]*&?","gi");return i=i.replace(n,"?"),n=new RegExp("\\&"+e+"=[^&]*&?","gi"),i=i.replace(n,"&"),n=null,i=i.replace(/(\?|&)$/,"")},generateUtmTags:function(t,e,i){return p.isEmpty(e)||(t=p.isTruthy(i)?f.insertParam(t,"utm_source",f.encodeUtf8(i)):t,t=p.isTruthy(e.medium)?f.insertParam(t,"utm_medium",f.encodeUtf8(e.medium)):t,t=p.isTruthy(e.campaign)?f.insertParam(t,"utm_campaign",f.encodeUtf8(e.campaign)):t,t=p.isTruthy(e.term)?f.insertParam(t,"utm_term",f.encodeUtf8(e.term)):t,t=p.isTruthy(e.content)?f.insertParam(t,"utm_content",f.encodeUtf8(e.content)):t),t},handlePinterestShare:function(t){var e=gon.display_options&&gon.display_options.utm?gon.display_options.utm:{},i=f.getTitle(t),n=window.location!=window.parent.location?document.referrer:document.location.href,o=f.insertParam(n,"pixlee_album_photo_id",t.get("album_photo_id"));o=f.generateUtmTags(o,e,"pinterest"),i=p.isFalsy(i)?gon.current_album.campaign?"I just voted for my favorite photo!":"Check this photo out!":h.request("decode:utf8",i);var r="https://pinterest.com/pin/create/button/?url="+h.request("encode:utf8",o)+"&media="+h.request("encode:utf8",h.request("get:photo:tumbnail",t))+"&description="+h.request("encode:utf8",i);r=f.generateUtmTags(r,e,"pinterest"),window.open(r,"_blank","height=450,width=600,toolbar=0,resizable=0"),f.trackShare(t.get("album_photo_id"),o,"pinterest",undefined,o,e)},get_short_url:function(t,e){h.request("get:config");a.getJSON("https://api-ssl.bitly.com/v3/shorten?",{format:"json",apiKey:"R_1437b1d85beb4300927d14a747f76eaf",login:"die",longUrl:t},function(t){e(t.data.url)})},handleTumblrShare:function(t){var e=gon.display_options&&gon.display_options.utm?gon.display_options.utm:{},i=f.getTitle(t),n=window.location!=window.parent.location?document.referrer:document.location.href,o=f.insertParam(n,"pixlee_album_photo_id",t.get("album_photo_id")),r=t.get("short_share_url")||o;r=f.generateUtmTags(r,e,"tumblr"),o=f.generateUtmTags(o,e,"tumblr"),i=p.isFalsy(i)?gon.current_album.campaign?"I just voted for my favorite photo!":"Check this photo out!":h.request("decode:utf8",i);var s="https://www.tumblr.com/share/photo?clickthru="+h.request("encode:utf8",r)+"&source="+h.request("encode:utf8",h.request("get:photo:tumbnail",t))+"&caption="+h.request("encode:utf8",i);s=f.generateUtmTags(s,e,"tumblr"),window.open(s,"_blank","height=450,width=600,toolbar=0,resizable=0"),f.trackShare(t.get("album_photo_id"),o,"tumblr",undefined,r,e)},handleFacebookShare:function(t){var e=gon.display_options&&gon.display_options.utm?gon.display_options.utm:{},i=f.getTitle(t);p.isFalsy(i)&&(i=gon.current_album.campaign?"I just voted for my favorite photo!":"Check this photo out!");var n=window.location!=window.parent.location?document.referrer:document.location,o=f.insertParam(n,"pixlee_album_photo_id",t.get("album_photo_id")),r=t.attributes.album_photo_id,s=gon.distinct_user_hash,a=null,l=window.location.protocol+"//"+window.location.host,u=g;u=f.insertParam(u,"descr",h.request("encode:utf8",h.request("encode:utf8",i))),u=f.insertParam(u,"title",h.request("encode:utf8",h.request("decode:utf8",gon.current_album.title))),u=f.insertParam(u,"img",h.request("encode:utf8",h.request("get:photo:tumbnail",t))),u=f.insertParam(u,"shareLink",h.request("encode:utf8",o)),u=f.insertParam(u,"album_photo_id",h.request("encode:utf8",r)),u=f.insertParam(u,"fingerprint",h.request("encode:utf8",s)),u=f.insertParam(u,"post_id",h.request("encode:utf8",a)),u=f.insertParam(u,"type","image"),u=f.insertParam(u,"source","facebook");var c=l+(u=f.generateUtmTags(u,e,"facebook"));window.open(c,"_blank","height=450,width=600,toolbar=0,resizable=0")},handleTwitterShare:function(t){var e=gon.display_options&&gon.display_options.utm?gon.display_options.utm:{},i=t.get("user_name"),n=f.getTitle(t);p.isFalsy(n)&&(n=gon.current_album.campaign?"I just voted for my favorite photo!":"Check this photo out!");var o=window.location!=window.parent.location?document.referrer:document.location,r=f.insertParam(o,"pixlee_album_photo_id",t.get("album_photo_id")),s=t.attributes.album_photo_id,a=gon.distinct_user_hash,l=null,u=window.location.protocol+"//"+window.location.host,c=g;c=f.insertParam(c,"descr",h.request("encode:utf8",h.request("encode:utf8",n))),c=f.insertParam(c,"title",h.request("encode:utf8",h.request("decode:utf8",gon.current_album.title))),c=f.insertParam(c,"img",h.request("encode:utf8",h.request("get:photo:tumbnail",t))),c=f.insertParam(c,"shareLink",h.request("encode:utf8",r)),c=f.insertParam(c,"album_photo_id",h.request("encode:utf8",s)),c=f.insertParam(c,"fingerprint",h.request("encode:utf8",a)),c=f.insertParam(c,"post_id",h.request("encode:utf8",l)),c=f.insertParam(c,"type","image"),c=f.insertParam(c,"author",i),c=f.insertParam(c,"source","twitter");var d=u+(c=f.generateUtmTags(c,e,"twitter"));window.open(d,"_blank","height=450,width=600,toolbar=0,resizable=0")},trackShare:function(e,i,n,o,r,s){clearTimeout(this.shareTimer),this.shareTimer=setTimeout(function(){var t;t=void 0!==o?o:null,0<parseInt(e)&&a.ajax({url:"/social/share",type:"post",data:{album_photo_id:parseInt(e),fingerprint:gon.distinct_user_hash,link:i,shortlink:r,provider:n,post_id:t,utm_medium:s.medium||"",utm_campaign:s.campaign||"",utm_term:s.term||"",utm_content:s.content||""},dataType:"json",success:function(t){t.error_code}})},2e3)},getTitle:function(t){return gon.display_options.options&&!gon.display_options.options.showCaptions?"":p.isFalsy(t.attributes.title)?p.isFalsy(t.attributes.album_title)?!p.isFalsy(t.attributes.photo_title)&&t.attributes.photo_title:t.attributes.album_title:t.attributes.title},validateUrl:function(t){return/^(https?|ftp):\/\/(?:(?:(?:[\w\.\-\+!$&'\(\)*\+,;=]|%[0-9a-f]{2})+:)*(?:[\w\.\-\+%!$&'\(\)*\+,;=]|%[0-9a-f]{2})+@)?(?:(?:[a-z0-9\-\.]|%[0-9a-f]{2})+|(?:\[(?:[0-9a-f]{0,4}:)*(?:[0-9a-f]{0,4})\]))(?::[0-9]+)?(?:[\/|\?](?:[\w#!:\.\?\+=&@!$'~*,;\/\(\)\[\]\-\{\}\"]|%[0-9a-f]{2})*)?$/i.test(t)},pingUrl:function(t,e,i){i=p.isFalsy(i)?this:i,a.ajax({url:Routes.ping_url_path(),dataType:"json",type:"GET",context:i,data:{url:t},success:e})},getAccountCurrencySymbol:function(){switch(gon.current_user.currency.toLowerCase()){case"usd":case"cad":case"aud":return"$";case"gbp":return"\xa3";case"eur":return"\u20ac";case"krw":return"\u20a9";default:return""}},hasPixleeAssistant:function(){return a("body").hasClass("hasPixleeAssistant")},getParameterByName:function(t,e){e=p.isFalsy(e)?window.location.href:"?"+e,t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return p.isFalsy(i)?null:p.isFalsy(i[2])?"":decodeURIComponent(i[2].replace(/\+/g," "))},createCookie:function(t,e,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var o="; expires="+n.toGMTString();document.cookie=t+"="+e+o+"; path=/; domain="+window.location.host.replace("www","")},readCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),n=0,o=i.length;n<o;n++){for(var r=i[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(e))return r.substring(e.length,r.length)}return null},readFromBrowser:function(t){var e,i=!1;try{window.localStorage&&(i=!0)}catch(n){i=!1}if(i)try{e=window.localStorage.getItem(t)}catch(n){e=this.readCookie(t)}else e=this.readCookie(t);return e},storeInBrowser:function(t,e){var i,n=!1;try{window.localStorage&&(n=!0)}catch(o){n=!1}if(null!=e)if("object"==typeof e&&(e=JSON.stringify(e)),n)try{window.localStorage.setItem(t,e)}catch(o){i=this.createCookie(t,e,30)}else this.createCookie(t,e,30);if(void 0===e){if(n)try{i=window.localStorage.getItem(t)}catch(o){i=this.readCookie(t)}else i=this.readCookie(t);try{i=JSON.parse(i)}catch(o){i=i}return i}if(null===e)if(n)try{window.localStorage.removeItem(t)}catch(o){this.createCookie(t,"",-1)}else this.createCookie(t,"",-1)},getGUID:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},getAnonymousId:function(t){return arguments.length?(this.storeInBrowser("ajs_anonymous_id",t),this):(t=this.readFromBrowser("ajs_anonymous_id"))?t:(t=this.getGUID(),this.storeInBrowser("ajs_anonymous_id",t),this.readFromBrowser("ajs_anonymous_id"))}},n={formateDate:function(t){return this.end_date=moment.utc(1e3*t).local().format("MM/DD/YYYY"),this.end_date},formateDateAnalytics:function(t){return this.end_date=moment.utc(1e3*t
).local().format("MM-DD-YYYY"),this.end_date}},h.reqres.setHandlers({"decode:utf8":function(t){return f.decodeUtf8(t)},"encode:utf8":function(t){return f.encodeUtf8(t)},"escape:html":function(t){return f.escapeHtml(t)},"get:start:date:analytics:converter":function(){return f.getStartDateAnalyticsConverter()},"get:end:date:analytics:converter":function(){return f.getEndDateAnalyticsConverter()},"get:encode:decode:converter":function(){return f.getEncodeDecodeConverter()},"get:data:type:analytics:converter":function(){return f.getDataTypeAnalyticsConverter()},"get:boolean:to:string:converter":function(){return f.getBooleanToStringConverter()},"get:end:date:converter":function(){return f.getEndDateConverter()},"get:start:date:converter":function(){return f.getStartDateConverter()},"has:pixlee:assistant":function(){return f.hasPixleeAssistant()},"decode:encode:utf8":function(t){return f.decodeEncodeUtf8(t)},"compact:int":function(t,e){return f.compactInt(t,e)},murmurhash:function(t,e){return f.murmurhash3_32_gc(t,e)},"validate:url":function(t){return f.validateUrl(t)},"ping:url":function(t,e,i){return f.pingUrl(t,e,i)},"get:account:currency:symbol":function(){return f.getAccountCurrencySymbol()},"get:anonymous:id":function(){return f.getAnonymousId()},"get:parameter:by:name":function(t,e){return f.getParameterByName(t,e)},"store:in:browser":function(t,e){return f.storeInBrowser(t,e)}}),h.commands.setHandlers({"facebook:share":function(){f.handleFacebookShare.apply(this,arguments)},"tumblr:share":function(){f.handleTumblrShare.apply(this,arguments)},"pinterest:share":function(){f.handlePinterestShare.apply(this,arguments)},"twitter:share":function(){f.handleTwitterShare.apply(this,arguments)}})}),Pixlee.module("Utilities",function(t,o,e,i,n,r){var s=["beforeIncluded","afterIncluded"],a=function(t){for(var e=this,i=0;i<t.length;i++){var n=o.request("concern",t[i]);null!=n.beforeIncluded&&n.beforeIncluded.call(e.prototype,e,n),Cocktail.mixin(e,r.omit(n,s)),null!=n.afterIncluded&&n.afterIncluded.call(e.prototype,e,n)}},l=[{Marionette:["ItemView","LayoutView","CollectionView","CompositeView","AppRouter"]},{Entities:["Model","DeepModel","Collection","PaginatedCollection","ClientPaginatedCollection"]}];r.each(l,function(t){r.each(t,function(t,e){r.each(t,function(t){(window[e]||o[e])[t].include=a})})})}),Pixlee.module("Utilities",function(t,i,n,e,o,r){r.extend(i,{navigate:function(t,e){return null==e&&(e={}),r.defaults(e,{trigger:!1}),i.execute("GA:Track",t,"primary","navigation.js"),n.history.navigate(t,e)},getCurrentRoute:function(){var t;return t=n.history.fragment,r.isEmpty(t)?null:t},startHistory:function(){if(n.history)return n.history.start()},navigateToExternalUrl:function(t,e){null==e&&(e={}),window.location=t}})}),Pixlee.module("Utilities",function(t,e,i,n,o,r){var s;s={register:function(t,e){return null==this._registry&&(this._registry={}),this._registry[e]=t},unregister:function(t,e){return delete this._registry[e]},resetRegistry:function(){var t,e,i,n;for(t in i=this.getRegistrySize(),n=this._registry)n[t].region.destroy();e="There were "+i+" controllers in the registry, there are now "+this.getRegistrySize(),0<this.getRegistrySize()?console.warn(e,this._registry):console.log(e)},getRegistrySize:function(){return r.size(this._registry)}},e.commands.setHandler("register:instance",function(t,e){if("development"===gon.global.env)return s.register(t,e)}),e.commands.setHandler("unregister:instance",function(t,e){if("development"===gon.global.env)return s.unregister(t,e)}),e.reqres.setHandler("reset:registry",function(){return s.resetRegistry()})}),function(t,n){_.extend(t.Renderer,{render:function(t,e){if(0!=t){var i;if(!(i=JST[t]))throw"Template "+t+" not found!";return _.extend(e,n.viewHelpers),i(e)}}})}(Marionette,Pixlee),Pixlee=Pixlee||{},Pixlee.viewHelpers={addClassIfTrue:function(t,e){if(t)return" "+e},checkedIfTrue:function(t){if(t)return'checked="checked"'},displayNoneIfTrue:function(t){if(t)return'style="display: none"'},backgroundImage:function(t){return"style=\"background-image: url('"+t+"')\""}},Pixlee.module("Utilities",function(t,o,e,i,l,s){var r;if(r={tries:0,queueArray:[],acceptCookiePolicy:!0,checkQueue:function(){var e=this;if(!this.getDistinctUserHash())return!1;var i=function(t){e.KeenClient||"undefined"==typeof Keen?e.KeenClient.recordEvent(t.event,t.obj):Keen.ready(function(){e.KeenClient=new Keen({projectId:keen_project_id,writeKey:keen_write_key,host:"tinyrick.pixlee.com"}),e.KeenClient.recordEvent(t.event,t.obj)})};s.each(this.queueArray,function(t){t.obj.attribution_window=gon.current_account.extra_fields.attribution_window||30,t.obj.distinct_user_hash||(t.obj.distinct_user_hash=e.getDistinctUserHash()),t.cookieEvent&&e.sendDataToParent(t.obj,t.cookieEvent),gon.fingerprint&&"none"!==gon.fingerprint&&(t.obj.fingerprint=gon.fingerprint),e.addKeenData(t.obj),i(t)}),this.queueArray=[]},getCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""},addKeenData:function(t){var e=[];e.push({name:"keen:ip_to_geo",input:{ip:"ip_address"},output:"ip_geo_info"}),t.ip_address=gon.remote_ip,e.push({name:"keen:ua_parser",input:{ua_string:"user_agent"},output:"parsed_user_agent"}),t.user_agent=navigator.userAgent,e.push({name:"keen:url_parser",input:{url:"page_url"},output:"parsed_page_url"}),t.page_url=document.location.href,e.push({name:"keen:referrer_parser",input:{referrer_url:"referrer_url",page_url:"page_url"},output:"referrer_info"}),t.referrer_url=document.referrer,t.page_url=document.location.href,t.keen={addons:e}},queueEvents:function(){var t=this;setTimeout(function(){0<t.queueArray.length&&t.acceptCookiePolicy&&t.checkQueue(),t.queueEvents()},200)},sendDataToParent:function(t,e){var i={name:e,type:"action",source:"widget",destination:"parent",data:t};try{window.parent.postMessage(JSON.stringify(i),"*")}catch(n){-1===document.referrer.indexOf("converse.com")&&-1===navigator.userAgent.indexOf("Opera")&&console.warn(n)}},OpenedPhotowall:function(t,e){var i=this.defaultProperties();this.photos=t,i.photos=this.convertToStrings(t),i.num_photos=t?t.length:0,e?(i.mosaic=!0,this.widget="Mosaic"):this.widget="Photowall",i.widget=this.widget,gon.widget=this.widget,gon.pixlee_start&&(i.loadTime=this.getPerf()-gon.pixlee_start),this.openedWidget(i,this.widget)},OpenedGrid:function(t){var e=this.defaultProperties();this.photos=t,e.photos=this.convertToStrings(t),e.num_photos=t?t.length:0,this.widget="Grid",e.widget=this.widget,gon.widget=this.widget,gon.pixlee_start&&(e.loadTime=this.getPerf()-gon.pixlee_start),this.openedWidget(e,this.widget)},OpenedTap2Shop:function(t){var e=this.defaultProperties();this.photos=t,this.widget="Tap2Shop",e.photos=this.convertToStrings(t),e.num_photos=t?t.length:0,e.widget=this.widget,gon.widget=this.widget,gon.pixlee_start&&(e.loadTime=this.getPerf()-gon.pixlee_start),this.openedWidget(e,this.widget)},OpenedSingle:function(t){var e=this.defaultProperties();e.photos=String(t),e.num_photos=1,this.widget="Single",e.widget=this.widget,gon.widget=this.widget,gon.pixlee_start&&(e.loadTime=this.getPerf()-gon.pixlee_start),this.openedWidget(e,this.widget)},kpiEvent:function(t){var e=this.defaultProperties();e.widget=this.widget,e.kpiEvent=t;var i={obj:e,event:"KPI Event"};this.queueArray.push(i)},OpenedSlideshow:function(t){var e=this.defaultProperties();e.photos=this.convertToStrings(t),e.num_photos=1,this.widget="Slideshow",e.widget=this.widget,gon.widget=this.widget,gon.pixlee_start&&(e.loadTime=this.getPerf()-gon.pixlee_start),this.openedWidget(e,this.widget)},OpenedCarousel:function(t,e){var i=this.defaultProperties();i.photos=this.convertToStrings(t),i.num_photos=t?t.length:0,this.widget="Carousel",i.carousel_options=e,i.widget=this.widget,gon.widget=this.widget,gon.pixlee_start&&(i.loadTime=this.getPerf()-gon.pixlee_start),this.openedWidget(i,this.widget)},OpenedHorizontal:function(t,e){var i=this.defaultProperties();i.photos=this.convertToStrings(t),i.num_photos=t?t.length:0,e?(i.coverflow=!0,this.widget="Coverflow"):this.widget="Horizontal",i.widget=this.widget,gon.widget=this.widget,gon.pixlee_start&&(i.loadTime=this.getPerf()-gon.pixlee_start),this.openedWidget(i,this.widget)},OpenedVertical:function(t){var e=this.defaultProperties();e.photos=this.convertToStrings(t),e.num_photos=t?t.length:0,this.widget="Vertical",e.widget=this.widget,gon.widget=this.widget,gon.pixlee_start&&(e.loadTime=this.getPerf()-gon.pixlee_start),this.openedWidget(e,this.widget)},getPerf:function(){return"undefined"!=typeof performance&&"undefined"!=typeof performance.now&&"undefined"!=typeof gon?performance.now():"undefined"!=typeof Date&&"undefined"!=typeof Date.now&&"undefined"!=typeof gon?Date.now():void 0},LoadMore:function(t,e){var i=this.defaultProperties(),n=s.difference(t,this.photos);this.photos=t,i.photos=this.convertToStrings(n),i.num_photos=n?n.length:0,e?(i.mosaic=!0,this.widget="Mosaic"):this.widget="Photowall",i.subcollection="Load More";var o={obj:i,cookieEvent:"pixlee:interacted",event:"Interacted"};this.queueArray.push(o)},ActionLinkClicked:function(t,e){var i=this.defaultProperties();i.album_photo_id=t,i.action_link_url=e,"tap2shop"===gon.type&&(i.tap2shop=!0),i.subcollection="Action Clicked";var n={obj:i,cookieEvent:"pixlee:interacted",event:"Interacted"};this.queueArray.push(n)},OpenedPhoto:function(t,e,i){var n=this.defaultProperties();n.album_photo_id=t,n.currentDistilleryPage=e,n.direct_click=i,"tap2shop"===gon.type&&(n.tap2shop=!0),n.subcollection="Opened Lightbox";var o={obj:n,cookieEvent:"pixlee:opened:photo",event:"Interacted"};this.queueArray.push(o)},PhotoAdded:function(t){var e=this.defaultProperties();e.photo_id=t;var i={obj:e,event:"Photo Added"};this.queueArray.push(i)},NavLeft:function(t){var e=this.defaultProperties();e.widget_config=this.defaultWidgetConfig(),e.photos=this.convertToStrings(t),e.widget=this.widget},NavRight:function(t){var e=this.defaultProperties();e.widget_config=this.defaultWidgetConfig(),e.photos=this.convertToStrings(t),e.num_photos=t?t.length:0,e.widget=this.widget,this.sendDataToParent({},"pixlee:widget:navigated"),e.subcollection="Nav Right";var i={obj:e,cookieEvent:"pixlee:interacted",event:"Interacted"};this.queueArray.push(i)},FilteredBy:function(t,e){var i=this.defaultProperties();i.widget=this.widget,i.filterBy=t,i.platform=e;var n={obj:i,event:"Filtered By"};this.queueArray.push(n)},PhotoShared:function(t,e){var i=this.defaultProperties();i.widget=this.widget,i.album_photo_id=t,i.platform=e,i.subcollection="Photo Shared";var n={obj:i,event:"Interacted"};this.queueArray.push(n)},StandaloneClickThrough:function(t){var e=this.defaultProperties();e.widget=this.widget,e.type=t,e.brand_url=gon.display_options.standaloneOptions.brandURL,e.is_mobile=gon.isMobile||!1,e.is_tablet=gon.isTablet||!1;var i={obj:e,event:"Click Through"};this.queueArray.push(i)},WidgetVisible:function(){var t=this.defaultProperties();t.widget_config=this.defaultWidgetConfig();var e={obj:t,event:"Widget Visible"};this.queueArray.push(e)},defaultProperties:function(){var t=gon.current_photo?gon.current_photo.album_id:gon.current_album.id,e=gon.current_photo?null:gon.recipe.filter_sort_id||gon.publication_id,i=this.getParameterByName("parent_url",document.location.href),n={album_id:t,account_id:gon.current_account.id,publication_id:e,distinct_user_hash:this.getDistinctUserHash(),sortType:gon.sortType,AB:gon.AB,parentURL:i,baseParentURL:s.isTruthy(i)?i.split(/[?#]/)[0]:null,displayed:this.isDisplayed(),widget_version:o.version,business_name:gon.current_account.business_name,account_type:gon.current_account.account_type};return gon.current_album&&(n.album_type=gon.current_album.album_type),gon.widget_id&&(n.widget_id=parseInt(gon.widget_id)),gon.widget_id_param&&(n.widget_id_param=parseInt(gon.widget_id_param)),gon.widget_type?n.widget_type=gon.widget_type:n.widget_type="simple",gon.fingerprint&&(n.fingerprint=gon.fingerprint),gon.experiment_id&&gon.experiment_group&&(n.experiment_id=gon.experiment_id,n.experiment_group=gon.experiment_group),n},defaultWidgetConfig:function(){var t,e,i=l("#upload_now"),n=gon.display_options,o=n.headerOptions,r=n.interactiveWidgetOptions,s=gon.recipe?this.extractActiveFilters(gon.recipe.filters):null,a=!!i&&"none"!==i.css("display");return t=n.is_datc?"DATC":n.showCallToAction?"CTA":"default",r&&(e={categories:r.categories,location:r.location,personalized:r.personalized,months:r.seasons,search:r.search,sort:r.sort,sortPopular:r.sortPopular,sortPrice:r.sortPrice,sortRecent:r.sortRecent,widgetType:r.widgetType,interactiveWidgetType:r.interactiveWidgetType,numOfCategories:r.selectedCategories?r.selectedCategories.length:0,selectedCategories:r.selectedCategories}),{interactiveWidgetOptions:e||!1,interactive_social_hub:n.is_interactive||!1,interactive_social_hub_type:!!r&&r.interactiveWidgetType,header_layout:!!o&&o.layout,uploader:a,uploader_button_style:!!o&&o.button,lightbox:t,theme:n.css_preset_filename||n.css_preset_filename_v2||"",mobile_optimization:n.showViewport||!1,load_priority:n.speedOptimization||!1,album_filters:s,end_tile_uploader:n.headerOptions.end_tile_upload_button_background_showHide||!1}},defaultUserInfo:function(){return{isMobile:gon.is_mobile||!1}},extractActiveFilters:function(t){var o={};return s.each(t,function(t,e){var i=!1;if(Array.isArray(t))i=0<t.length;else if("object"==typeof t){var n=0;s.each(t,function(t){n+=t.length?t.length:0}),i=0<n}else i=!s.isFalsy(t);i&&(o[e]=t)}),o},getDistinctUserHash:function(){if("undefined"!=typeof analytics&&analytics.getAnonymousId)return analytics.getAnonymousId()},isDisplayed:function(){return this.getParameterByName("displayed")&&"none"==this.getParameterByName("displayed")?"none":"block"},getTime:function(){return Date.now()},convertToStrings:function(t){return(t=s.map(t,function(t){return t+""})).join(",")},getCurrentItemIds:function(t,e){var i=[];return e.each(function(t){t.get("album_photo_id")&&i.push(t.get("album_photo_id"))}),i=i.slice(t.firstItem,t.lastItem+1)},getParameterByName:function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null==i?null:decodeURIComponent(i[1].replace(/\+/g," "))},openedWidget:function(t,e){var i=this;t.widget=e,t.widget_config=this.defaultWidgetConfig();var n={obj:t,event:"Opened Widget",cookieEvent:"pixlee:create:cookie"};i.queueArray.push(n)},clickUploader:function(t,e){var i=this.defaultProperties();i.widget=this.widget,i.user_info=this.defaultUserInfo(),i.user_info.name=e.name,i.user_info.user_handle=e.user_handle,i.user_info.email=e.email,i.step=t,i.channel=e.channel,i.number_of_media=e.number_of_media,i.header_options=e.header_options,i.widget_type=e.widget_type,s.isFalsy(e.nav_to)||(i.nav_to=e.nav_to),s.isFalsy(e.nav_from)||(i.nav_from=e.nav_from);var n={obj:i,event:"Click Uploader",cookieEvent:"pixlee:interacted"};this.queueArray.push(n)},googlePhotosFilterEvent:function(t,e){var i=this.defaultProperties(),n={obj:s.extend(i,e),event:t};this.queueArray.push(n)},interactiveWidgetAnalytics:function(t,e,i){var n=this.defaultProperties(),o={obj:s.extend(n,e),event:t};if(s.isFalsy(i)||(o.cookieEvent=i),"Click Interactive Bar"===t||"Apply Interactive Bar"===t){n.subcollection=t;var r={obj:s.extend(n,e),event:"Interacted"};this.queueArray.push(r)}else this.queueArray.push(o)}},s.isFalsy(gon.previewMode)){window.addEventListener("message",function(t){var e;if(t.data){try{e=JSON.parse(t.data)}catch(i){return}e.name&&("pixlee:fingerprint"===e.name?(gon.fingerprint=e.data,r.queueEvents()):"pixlee:cookie"===e.name&&(r.acceptCookiePolicy=e.data))}}.bind(this));var n={name:"pixlee:get:fingerprint:from:parent",type:"action",destination:"all",source:"",data:{}},a={name:"pixlee:get:cookie:from:parent",type:"action",destination:"all",source:"",data:{}};window.parent.postMessage(JSON.stringify(n),"*"),window.parent.postMessage(JSON.stringify(a),"*")}o.commands.setHandlers({"widget:visible":function(){r.WidgetVisible()},"opened:single":function(t){r.OpenedSingle(t)},"opened:photowall":function(t,e){r.OpenedPhotowall(t,e)},"opened:grid":function(t){r.OpenedGrid(t)},"opened:tap2shop":function(t){r.OpenedTap2Shop(t)},"opened:carousel":function(t,e,i){var n=s.isEmpty(t)?[]:r.getCurrentItemIds(t,e);r.OpenedCarousel(n,i)},"opened:horizontal":function(t,e,i){var n=s.isEmpty(t)?[]:r.getCurrentItemIds(t,e);r.OpenedHorizontal(n,i)},"opened:slideshow":function(t,e){var i=r.getCurrentItemIds(t,e);r.OpenedSlideshow(i)},"opened:vertical":function(t,e){var i=s.isEmpty(t)?[]:r.getCurrentItemIds(t,e);r.OpenedVertical(i)},"load:more":function(t){r.LoadMore(t)},"action:clicked":function(t,e){r.ActionLinkClicked(t,e)},"opened:photo":function(t,e,i){r.OpenedPhoto(t,e,i)},"nav:left":function(t,e){var i=r.getCurrentItemIds(t,e);r.NavLeft(i)},"nav:right":function(t,e){var i=r.getCurrentItemIds(t,e);r.NavRight(i)},"photo:shared":function(t,e){r.PhotoShared(t,e)},"kpi:event":function(t){r.kpiEvent(t)},"photo:added":function(t){r.PhotoAdded(t)},"filtered:by":function(t,e){r.FilteredBy(t,e)},"google:photos:filter:event":function(t,e){r.googlePhotosFilterEvent(t,e)},"standalone:click:through":function(t){r.StandaloneClickThrough(t)},"click:uploader":function(t,e){r.clickUploader(t,e)},"interactive:widget:analytics":function(t,e,i){r.interactiveWidgetAnalytics(t,e,i)}})}),Routes=Routes||{},Routes.backbone={photowall_path:"photowall",horizontal_path:"horizontal"},Routes.returnRoute=function(t){return t.insertAt(0,"#")},Routes.distillery_analytics_album_path=function(t,e){return this.setDefaults(),this.config.distilleryUrl+this.config.distilleryUrlAnalyticsAlbums+"/"+t+"/"+e+"?api_key="+this.currentUser.single_access_token},Routes.distillery_accounts_album_path=function(t,e){return this.setDefaults(),this.config.distilleryUrl+this.config.distilleryUrlAnalyticsAccounts+"/"+t+"/"+e+"?api_key="+this.currentUser.single_access_token},Routes.distillery_analytics_location_path=function(){return this.setDefaults(),this.config.distilleryAnalyticsUrl+"v1/albums/"+this.currentAlbum.id+"/locations?api_key="+this.currentUser.single_access_token},Routes.photos_album_add_path=function(t,e){return this.setDefaults(),this.config.pixleePhotosServer+t+"/"+e+"/add"},Routes.photowall_item_path=function(t){return this.returnRoute(Routes.backbone.photowall_path+"/"+t)},Routes.horizontal_item_path=function(t){return this.returnRoute(Routes.backbone.horizontal_path+"/"+t)},Routes.settings_item_path=function(t){return this.returnRoute(Routes.backbone.settings_path+"/"+t)},Routes.analytics_item_path=function(t){return this.returnRoute(Routes.backbone.analytics_path+"/"+t)},Routes.analytics_item_details_path=function(t,e){return Routes.backbone.analytics_path+"/"+t+"/"+e},Routes.analytics_accounts_details_path=function(t){return Routes.backbone.analytics_path+"/"+t},Routes.albums_item_path=function(t){return this.returnRoute("albums/"+t)},Routes.inbox_item_path=function(t){return this.returnRoute("inbox/"+t)},Routes.album_settings_path=function(t){return this.returnRoute("albums/settings/"+t)},Routes.album_publish_path=function(t){return this.returnRoute("albums/publish/"+t)},Routes.album_collect_path=function(t){return this.returnRoute("albums/collect/"+t)},Routes.distillery_albums_path=function(){return this.setDefaults(),this.config.distilleryUrl+this.config.distilleryUrlMyAlbums+"?api_key="+this.currentUser.single_access_token},Routes.distillery_inbox_path=function(){return this.setDefaults(),this.config.distilleryUrl+this.config.distilleryInboxUrl+"?api_key="+this.currentUser.single_access_token},Routes.distillery_photo_path=function(t){return this.setDefaults(),this.config.distilleryUrl+this.config.distilleryPhotoUrl+"?api_key="+this.currentUser.single_access_token+"&album_photo_id="+t},Routes.distillery_photo_crud_path=function(t){return this.setDefaults(),this.config.distilleryUrl+this.config.distilleryPhotoCrudUrl+"/"+t+"?api_key="+this.currentUser.single_access_token},Routes.distillery_widgets_path=function(){return this.setDefaults(),this.config.distilleryUrl+this.config.distilleryQueryUrl+"?api_key="+this.currentUser.single_access_token+"&updated_at="+this.currentAlbum.filtersort_cache_updated_at},Routes.setDefaults=function(){null==this.config&&(this.config=Pixlee.reqres.request("get:config").toJSON()),Routes.setDefaultUser()},Routes.setDefaultUser=function(){null==this.currentUser&&(this.currentUser=Pixlee.request("get:current:user").toJSON()),null==this.currentAlbum&&(this.currentAlbum=Pixlee.request("get:current:album").toJSON())},Routes.social_login_path=function(t,e,i){return"/auth/"+t+"?widget="+e+"&state="+i},Routes.linkTo=function(t,e,i){return null==i&&(i={}),_.defaults(i,{https:!1,backbone:!1}),i.https&&t.replace("http://").replace("https://"),i.backbone&&(e="#"+e),t+e},Pixlee.module("Utilities",function(t,c,e,i,n,d){var o,r,s,a=this;a.fingerprint="0",o={getCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""},addKeenData:function(t){var e=[];e.push({name:"keen:ip_to_geo",input:{ip:"ip_address"},output:"ip_geo_info"}),t.ip_address=gon.remote_ip,e.push({name:"keen:ua_parser",input:{ua_string:"user_agent"},output:"parsed_user_agent"}),t.user_agent=navigator.userAgent,e.push({name:"keen:url_parser",input:{url:"page_url"},output:"parsed_page_url"}),t.page_url=document.location.href,e.push({name:"keen:referrer_parser",input:{referrer_url:"referrer_url",page_url:"page_url"},output:"referrer_info"}),t.referrer_url=document.referrer,t.page_url=document.location.href,t.keen={addons:e}},trackAnalytics:function(t,e){var i=this;i.KeenClient||"undefined"==typeof Keen?(i.addKeenData(e),i.KeenClient.recordEvent(t,e)):Keen.ready(function(){i.KeenClient=new Keen({projectId:keen_project_id,writeKey:keen_write_key,host:"tinyrick.pixlee.com"}),i.addKeenData(e),i.KeenClient.recordEvent(t,e)})},facebookLogin:function(t){var e;e=t?r.photos_social_login_path("facebook",!1,a.fingerprint):r.social_login_path("facebook",!1,a.fingerprint),r.popupwindow(e,"Facebook Login",1e3,600)},googlePhotosLogin:function(){var t=r.photos_social_login_path("google",!1,a.fingerprint);r.popupwindow(t,"Google Login",1e3,600)},twitterLogin:function(t){var e;e=t?r.photos_social_login_path("twitter",!1,a.fingerprint):r.social_login_path("twitter",!1,a.fingerprint),r.popupwindow(e,"Twitter Login",1e3,600)},tumblrLogin:function(t){var e;e=t?r.photos_social_login_path("tumblr",!1,a.fingerprint):r.social_login_path("tumblr",!1,a.fingerprint),r.popupwindow(e,"Tumblr Login",1e3,600)},instagramLogin:function(t){var e;e=t?r.photos_social_login_path("instagram",!1,a.fingerprint):r.social_login_path("instagram",!1,a.fingerprint),r.popupwindow(e,"Instagram Login",1e3,600)},facebookLogout:function(t){r.logoutSocial("facebook",t)},twitterLogout:function(t){r.logoutSocial("twitter",t)},tumblrLogout:function(t){r.logoutSocial("tumblr",t)},instagramLogout:function(t){r.logoutSocial("instagram",t)},facebookLoginWidget:function(){var t=Routes.social_login_path("facebook",!0,a.fingerprint);r.popupwindow(t,"Facebook Login",1e3,600)},twitterLoginWidget:function(){var t=Routes.social_login_path("twitter",!0,a.fingerprint);r.popupwindow(t,"Twitter Login",1e3,600)},tumblrLoginWidget:function(){var t=Routes.social_login_path("tumblr",!0,a.fingerprint);r.popupwindow(t,"Tumblr Login",1e3,600)},instagramLoginWidget:function(){var t=Routes.social_login_path("instagram",!0,a.fingerprint);r.popupwindow(t,"Instagram Login",1e3,600)},handlePinterestShare:function(t){var e=r.getTitle(t);e=c.request("decode:utf8",e),r.popupwindow("https://pinterest.com/pin/create/button/?media="+c.request("encode:utf8",c.request("get:photo:tumbnail",t))+"&description="+c.request("encode:utf8",e),"Share on pinterest",750,302),this.trackAnalytics("shared to social platform",{category:"social platforms",moduleName:a.moduleName,url:window.location.href,platform:"pinterest",account_id:gon.current_account.id,parentURL:gon.parentURL,distinct_user_hash:gon.distinct_user_hash,fingerprint:gon.fingerprint})},handleTwitterShare:function(t){var e=r.getTitle(t);e=c.request("decode:utf8",e),r.popupwindow("https://twitter.com/intent/tweet?text="+c.request("encode:utf8",e)+" &url="+c.request("encode:utf8",c.request("get:photo:tumbnail",t)),"Share on Twitter",600,255),this.trackAnalytics("shared to social platform",{category:"social platforms",moduleName:a.moduleName,url:window.location.href,platform:"twitter",account_id:gon.current_account.id,parentURL:gon.parentURL,distinct_user_hash:gon.distinct_user_hash,fingerprint:gon.fingerprint})},handleFacebookShare:function(t,e){function i(){a.trackAnalytics("shared to social platform",{category:"social platforms",moduleName:a.moduleName,url:window.location.href,platform:"facebook",account_id:gon.current_account.id,parentURL:gon.parentURL,distinct_user_hash:gon.distinct_user_hash,fingerprint:gon.fingerprint})}var n=r.getTitle(t),o={method:"feed",picture:c.request("get:photo:tumbnail",t),description:c.request("decode:utf8",n),display:"popup"};d.isFalsy(e)||(o.to=e,o.from=e),FB.ui(o,i)},handleTumblrShare:function(t){var e=r.getTitle(t);e=c.request("decode:utf8",e),r.popupwindow("https://www.tumblr.com/share/photo?source="+c.request("encode:utf8",c.request("get:photo:tumbnail",t))+"&caption="+c.request("encode:utf8",e),"Share on Tumblr",450,428),this.trackAnalytics("shared to social platform",{category:"social platforms",moduleName:a.moduleName,url:window.location.href,platform:"tumblr",account_id:gon.current_account.id,parentURL:gon.parentURL,distinct_user_hash:gon.distinct_user_hash,fingerprint:gon.fingerprint})}},r={social_login_path:function(t,e,i){return c.reqres.request("get:config").toJSON().pixlee_backend_server+"auth/"+t+"?widget="+e+"&state="+i},photos_social_login_path:function(t,e,i){c.reqres.request("get:config").toJSON();return"/auth/"+t+"?widget="+e+"&state="+i},popupwindow:function(t,e,i,n){var o=window.screenLeft!=undefined?window.screenLeft:screen.left,r=window.screenTop!=undefined?window.screenTop:screen.top,s=screen.width/2-i/2+o,a=screen.height/2-n/2+r,l=window.open(t,e,"scrollbars=yes, width="+i+", height="+n+", top="+a+", left="+s),u=setInterval(function(){if(l.closed){var t=gon.social_profile;if(d.isFalsy(t)&&!d.isFalsy(window.localStorage))try{t=JSON.parse(localStorage.getItem("social_profile"))}catch(e){window.pixRaven.captureMessage("Failed to parse social_profile data from localstorage",{level:"warning",extra:{type:typeof e.data,eventData:e.data}})}d.isFalsy(t)||(c.commands.execute("photo:social:login:success",t),localStorage.removeItem("social_profile"),clearTimeout(u))}},1e3);window.focus&&l.focus()},getTitle:function(t){return d.isFalsy(t.get("title"))?d.isFalsy(t.get("album_title"))?!d.isFalsy(t.get("photo_title"))&&t.attributes.photo_title:t.attributes.album_title:t.attributes.title},getFacebookAlbums:function(r,s,a){var l=[],t=a?"/me/albums?after="+a:"/me/albums";FB.api(t,"get",{access_token:r},function(t){for(var e=25,i={page:1,nextUrl:null,next:!1},n=0;n<t.data.length;n++){var o=t.data[n];o.photo_url="https://graph.facebook.com/"+o.id+"/picture?type=album&access_token="+r,l.push(o)}!d.isEmpty(t.paging)&&!d.isEmpty(t.paging.cursors)&&t.data.length>=e&&(i.next=!0,i.nextUrl=t.paging.cursors.after),d.isFalsy(a)&&(l.push({name:"Tagged Videos",photo_url:""}),l.push({name:"Uploaded Videos",photo_url:""})),s(l,i)})},logoutSocial:function(e,i){n.ajax({url:Routes.social_logout_path(e),dataType:"json",success:function(t){t&&i.success&&o.trackAnalytics("logout social platform",{category:"social platforms",moduleName:a.moduleName,url:window.location.href,platform:e,account_id:gon.current_account.id,parentURL:gon.parentURL,distinct_user_hash:gon.distinct_user_hash,fingerprint:gon.fingerprint})}})}},c.commands.setHandlers({"facebook:login":function(t){s=t,o.facebookLogin()},"twitter:login":function(t){s=t,o.twitterLogin()},"instagram:login":function(t){s=t,o.instagramLogin()},"tumblr:login":function(t){s=t,o.tumblrLogin()},"facebook:login:photos":function(t){s=t,o.facebookLogin(!0)},"google:login:photos":function(t){s=t,o.googlePhotosLogin(!0)},"twitter:login:photos":function(t){s=t,o.twitterLogin(!0)},"instagram:login:photos":function(t){s=t,o.instagramLogin(!0)},"tumblr:login:photos":function(t){s=t,o.tumblrLogin(!0)},"facebook:logout":function(t){o.facebookLogout(t)},"twitter:logout":function(t){o.twitterLogout(t)},"instagram:logout":function(t){o.instagramLogout(t)},"tumblr:logout":function(t){o.tumblrLogout(t)},"facebook:login:widget":function(t){s=t,o.facebookLoginWidget()},"twitter:login:widget":function(t){s=t,o.twitterLoginWidget()},"instagram:login:widget":function(t){s=t,o.instagramLoginWidget()},"tumblr:login:widget":function(t){s=t,o.tumblrLoginWidget()},"get:facebook:albums":function(t,e,i){r.getFacebookAlbums(t,e,i)},"social:login:success":function(t){"twitter"==t.source?c.request("get:current:user").set("twitter_status",{is_connected:!0,message:""}):"instagram"==t.source?c.request("get:current:user").set("instagram_status",{is_connected:!0,message:""}):"tumblr"==t.source?c.request("get:current:user").set("isConnectedToTumblr",!0):"facebook"==t.source?c.request("get:current:user").set("facebook_status",{is_connected:!0,message:""}):"google"==t.source&&c.request("get:current:user").set("google_status",{is_connected:!0,message:""}),c.request("get:current:user").fetch({reset:!0}),o.trackAnalytics("login social platform",{category:"social platforms",moduleName:a.moduleName,url:window.location.href,platform:t.source,account_id:gon.current_account.id,parentURL:gon.parentURL,distinct_user_hash:gon.distinct_user_hash,fingerprint:gon.fingerprint}),s(t),s=null},"photo:social:login:success":function(t){o.trackAnalytics("login social platform photos",{category:"social platforms",moduleName:a.moduleName,url:window.location.href,platform:t.source,account_id:gon.current_account.id,parentURL:gon.parentURL,distinct_user_hash:gon.distinct_user_hash,fingerprint:gon.fingerprint}),s(t),s=null},"open:share:pinterest":function(t){o.handlePinterestShare(t)},"open:share:twitter":function(t){o.handleTwitterShare(t)},"open:share:facebook":function(t,e){o.handleFacebookShare(t,e)},"open:share:tumblr":function(t){o.handleTumblrShare(t)}})}),Pixlee.module("Behaviors",function(t,P,I,e,A,E){t.AppendUploaderTiles=e.Behavior.extend({ui:{uploaderTile:".uploader_tile"},events:{"click @ui.uploaderTile":"clickUploaderTile","keydown @ui.uploaderTile":"onKeydownUploader"},collectionEvents:{sync:"onSync"},onKeydownUploader:function(t){var e=13;t.keyCode===e&&t.target.click()},clickUploaderTile:function(t){var e={name:"pixlee:show:uploader",type:"action",source:"widget",destination:"parent",data:{widgetId:window.location.href}};window.lastElement=t.target,window.parent.postMessage(JSON.stringify(e),"*")},onSync:function(t,e){if(!E.isFalsy(e)){var i=this,n=gon.type,o=this.view.options.displayOptions.headerOptions,r=o.layout,s=o.end_tile_upload_button_background_showHide,a=1,l=(this.view.options.displayOptions.is_interactive,!E.isFalsy(P.displayOptions.get("hideIfLessThan"))||!E.isFalsy(gon.current_account.extra_fields.hideIfLessThan)),u=A("#frame"),c=A("ul.clearfix"),d=c.children(),h=A(".photo_block:visible"),p=0,f=0,g=0,_={name:"pixlee:widget:num:photos",type:"action",source:"widget",destination:"parent",data:{photoCount:i.view.collection?i.view.collection.length:0}};window.top.postMessage(JSON.stringify(_),"*");var m,v,y=i.view.collection.length;if(l&&(v=E.isFalsy(P.displayOptions.get("hideIfLessThan"))?gon.current_account.extra_fields.hideIfLessThan:P.displayOptions.get("hideIfLessThan")),"carousel"===n)y=i.view.collection.reject(function(t){return t.get("isUploaderTile")}).length;m=v!==undefined?v<=y:y;var w=-1!==E.indexOf(P.request("get:current:user").get("features"),"remove_powered_by"),b=!m&&l,x=!m&&E.isFalsy(s);w||b||x||(_={name:"pixlee:generate:attribution:link",type:"action",source:"widget",destination:"parent",data:{src:window.location.href,isStandardOrStory:"standard"===gon.current_album.album_type||"story"===gon.current_album.album_type,isHiddenAB:"B"===gon.AB,landingPageURL:gon.current_account.extra_fields.landing_page_url,disablePoweredByClick:P.displayOptions.get("disablePoweredByClick")}},window.parent.postMessage(JSON.stringify(_),"*")),l&&!m||!m&&E.isFalsy(s)||A("#header_wrapper").css("visibility","visible"),h.length&&(p=h.width(),f=h.length*p,g=u.width()-f),"vertical"!==n&&"coverflow"!==n&&"horizontal"!==n||p<g&&(a=E.isFalsy(this.view.options.displayOptions.num_uploader_tiles)?Math.floor(g/p
):this.view.options.displayOptions.num_uploader_tiles);var k="tile"===r?d.slice(1):d;if("carousel"!==n&&this.view.collection.length&&k.first().hasClass("uploader_tile")&&A.each(k,function(t,e){if(!A(e).hasClass("uploader_tile"))return!1;e.remove()}),!E.isFalsy(this.view.options.displayOptions.headerOptions.end_tile_upload_button_background_showHide)&&(0<e.total&&E.isFalsy(e.next)||0===e.total&&1===e.page))if("carousel"===n){var C=new I.Model({isUploaderTile:!0,uploaderTileType:"end"});E.isFalsy(this.view.collection.findWhere(C.attributes))&&(this.view.collection.add(C),this.view.collection.trigger("sync"))}else{this.view.$el.find(".uploader_tile").remove();for(var S=JST["javascripts/backbone/apps/common/templates/v2/_end_uploader_tile"](n),M=0;M<a;M++)c.append(S);this.view.sly&&this.view.sly.reload({silentScroll:!0})}if(1===e.page&&E.isFalsy(e.next)&&"photowall"!==n&&"mosaic_v2"!==n&&"carousel"!==n&&this.view.onRender(),E.isFalsy(this.view.sly)&&"photowall"!==n&&"mosaic_v2"!==n&&"carousel"!==n){var O=A("#frame"),T={horizontal:0,smart:1,activateMiddle:1,itemNav:"centered",activateOn:"click",mouseDragging:0,touchDragging:1,releaseSwing:1,startAt:0,scrollBy:0,speed:300,elasticBounds:1,easing:"easeOutExpo",prevPage:A(".prev"),nextPage:A(".next")};"coverflow"===n?(T.itemNav="forceCentered",T.horizontal=1,T.easing="swing"):"horizontal"===n&&(T.horizontal=1),this.sly=new Sly(O,T).init()}}}})}),Pixlee.module("Behaviors",function(t,e,i,n){t.RefreshOnCssGenerated=n.Behavior.extend({onReloadSly:function(){var t=this;setTimeout(function(){t.view.sly.reload()},400)}})}),Pixlee.module("Behaviors",function(t,a,e,i,l){t.FilterPhotos=i.Behavior.extend({initialize:function(){var e=this;Cookies.json=!0;var i=a.widget.currentView.collection;i.once("sync",function(){var t=Cookies.get("pixlee_social_cookie");e.initialUrl=i.url(),t&&t.social_login&&t.social_login.social_id&&e.processCollection(t)}),a.commands.setHandlers({"social:login":function(t){e.processCollection(t)},"social:login:loaded":function(){e.socialLoginLoad()}})},ui:{location_alert_overlay:"#location_alert_content",location_alert_allow:"#location_alert_allow",location_alert_deny:"#location_alert_deny",sign_in:"#sign_in",logged_in_container:"#logged_in_container",search_box:"#search_box",loading_social_auth:"#loading_social_auth",dropdown_list:"#dropdown_list",filter_tile:".filter_tile",log_in_container:"#log_in_container",interaction_toggle:"#interaction_toggle",sort_votes:'[data-attr="sortByVotes"]'},events:{"click #sign_in":function(){this.ui.search_box.val(""),this.ui.loading_social_auth.css("visibility","visible");var t={name:"pixlee:show:social:connect",type:"action",source:"widget",destination:"parent",data:{widgetId:window.parentIFrame.getId()}};return window.parent.postMessage(JSON.stringify(t),"*"),!1},"click .filter_tile":function(t){a.commands.execute("filtered:by",l(t.currentTarget).attr("data-attr")),this.selectAllPhotosFilter(),this.showLoader(),this.ui.dropdown_list.hide();var e;a.widget.currentView.collection;return l(t.target).hasClass("active")?(this.ui.filter_tile.removeClass("active"),e=this.initialUrl+"&filterBy=allPhotos"):(this.ui.filter_tile.removeClass("active"),l(t.currentTarget).addClass("active"),e=this.initialUrl+"&filterBy="+l(t.currentTarget).attr("data-attr")),this.fetchCollection(e),!1},"keyup #search_box":function(i){clearTimeout(this.timer);var n=this;this.timer=setTimeout(function(){a.commands.execute("filtered:by","search");var t,e=l(i.currentTarget).val().trim();n.selectAllPhotosFilter(),l("#widget").find(".clearfix").addClass("loading_content_spinner"),t=0<e.length?n.initialUrl+"&filterBy=caption&caption="+e:n.initialUrl,n.fetchCollection(t),n.ui.filter_tile.removeClass("active")},1e3)},"click #clear_search":function(){return this.ui.search_box.val("").trigger("keyup"),!1},"click .filter_box":function(){return this.ui.search_box.val(""),!1}},onRender:function(){!0!==a.request("get:current:album").get("campaign")&&this.ui.sort_votes.hide()},fetchCollection:function(t){l(".load_more").hide();var e=a.widget.currentView.collection,i=this;e.paginator_core.url=t,e.url=function(){return t},e.goTo(1,{success:function(){i.hideLoader(),l(".load_more").show()},reset:!0})},socialLoginLoad:function(){this.ui.sign_in.show(),this.ui.loading_social_auth.css("visibility","hidden")},editCollectionUrl:function(t){a.widget.currentView.collection;return t.source?this.initialUrl+"&platform="+t.source+"&access_token="+t.access_token+"&access_token_secret="+t.access_token_secret+"&social_id="+t.social_id:this.initialUrl+"&platform=email&email="+t},initCollectionEvents:function(){var t=this,e=a.widget.currentView.collection;t.defaultUrl=e.url(),e.on("sync",function(){t.hideLoader(),0<e.length?(l("#widget").find(".clearfix").removeClass("no_photos_view"),e.next&&l(".load_more").show(),0<l(".mosaic_frame").length&&l(".mosaic_frame").removeClass("no-pad")):(l("#widget").find(".clearfix").empty(),0<l(".mosaic_frame").length&&l(".mosaic_frame").addClass("no-pad"),l("#widget").find(".clearfix").addClass("no_photos_view"))})},signOut:function(){var t=this;this.showLoader(),Cookies.remove("pixlee_social_cookie"),this.ui.log_in_container.show(),this.ui.logged_in_container.hide(),this.hideDropdown(),this.ui.interaction_toggle.off("click");var e="click";"ontouchstart"in window&&(e="touchstart"),this.ui.logged_in_container.find("#dropdown_list").find(".dropdown_list_item").off(e);var i=t.defaultUrl;this.fetchCollection(i),l(".checked").removeClass("checked"),l(".dropdown_list_item").first().addClass("checked")},hideDropdown:function(){this.ui.logged_in_container.find("#dropdown_list").hide()},showLoader:function(){l("#widget").find(".clearfix").removeClass("no_photos_view").addClass("loading_content_spinner")},hideLoader:function(){l("#widget").find(".clearfix").removeClass("loading_content_spinner")},selectAllPhotosFilter:function(){this.ui.interaction_toggle.removeClass().addClass("all_photos"),this.ui.dropdown_list.find(".checked").removeClass("checked"),l('[data-attr="allPhotos"]').addClass("checked")},processCollection:function(i){var r=this;Cookies.set("pixlee_social_cookie",i,{expires:365}),r.initCollectionEvents();var s=a.widget.currentView.collection;if(!i.social_login)return!1;var t=this.editCollectionUrl(i.social_login);s.paginator_core.url=t,"facebook"!=i.platform&&"email"!=i.platform||l('.dropdown_list_item[data-attr="friendsPhotos"]').remove(),this.ModifiedUrl=t,this.ui.log_in_container.hide(),this.ui.logged_in_container.show(),this.ui.interaction_toggle.on("click",function(){r.ui.logged_in_container.find("#dropdown_list").toggle(),l("body").click(function(){r.ui.dropdown_list.hide()})});var e="click";"ontouchstart"in window&&(e="touchstart"),this.ui.logged_in_container.find("#dropdown_list").find(".dropdown_list_item").on(e,function(){if(l(this).hasClass("checked"))return!1;if("signOut"==l(this).attr("data-attr"))return r.signOut(),!1;var o;if(r.ui.logged_in_container.find("#dropdown_list").find(".dropdown_list_item").removeClass("checked"),l("#desktop_tablet_view").find(".active").removeClass("active"),l(this).addClass("checked"),r.ui.interaction_toggle.attr("class",l(this).attr("data-text")),"nearMe"!=l(this).attr("data-attr")&&(r.currentSelection=l(this).attr("data-text")),"allPhotos"==l(this).attr("data-attr"))o=r.ModifiedUrl+"&filterBy=allPhotos",a.commands.execute("filtered:by","allPhotos"),r.hideDropdown();else if("nearMe"==l(this).attr("data-attr")){r.ui.location_alert_overlay.show();var t=function(){r.ui.location_alert_deny.click(function(){return r.showLoader(),r.selectAllPhotosFilter(),o=r.ModifiedUrl+"&filterBy=allPhotos",r.fetchCollection(o),r.ui.location_alert_overlay.hide(),r.hideDropdown(),!1})};(function(n){r.ui.location_alert_allow.click(function(){r.hideDropdown(),r.showLoader(),r.ui.location_alert_overlay.hide(),l(".load_more").hide(),a.commands.execute("filtered:by",l(n).attr("data-attr"),"location"),navigator.geolocation&&(s.reset(),navigator.geolocation.getCurrentPosition(function(t){var e=t.coords.latitude,i=t.coords.longitude;return o=r.ModifiedUrl+"&filterBy="+l(n).attr("data-attr")+"&latitude="+e+"&longitude="+i,r.fetchCollection(o),r.hideDropdown(),!1}))})})(this),t(this)}else if("caption"==l(this).attr("data-attr")){a.commands.execute("filtered:by",l(this).attr("data-attr"),"search");var e="hello";o=r.ModifiedUrl+"&filterBy="+l(this).attr("data-attr")+"&caption="+e,r.hideDropdown()}else a.commands.execute("filtered:by",l(this).attr("data-attr"),i.platform),o=r.ModifiedUrl+"&filterBy="+l(this).attr("data-attr"),r.hideDropdown();return 0<l(".mosaic_frame").length&&l("#widget").find(".clearfix").empty(),"nearMe"!=l(this).attr("data-attr")?(r.showLoader(),r.fetchCollection(o),!1):void 0})}})}),Pixlee.module("Behaviors",function(t,a,e,i,l,u){t.HideEmptyAlbumWidget=i.Behavior.extend({initialize:function(){u.isFalsy(a.displayOptions.get("hideIfLessThan"))&&u.isFalsy(gon.current_account.extra_fields.hideIfLessThan)||l("html").css("opacity",0)},collectionEvents:{sync:function(){var o=this,r=function(){var t={name:"pixlee:widget:num:photos",type:"action",source:"widget",destination:"parent",data:{photoCount:o.view.collection?o.view.collection.length:0}};window.top.postMessage(JSON.stringify(t),"*")},s=setInterval(function(){if("parentIFrame"in window){if(!o.view.collection.length&&u.isFalsy(a.displayOptions.get("is_interactive")))window.parentIFrame.close();else if(u.isFalsy(a.displayOptions.get("hideIfLessThan"))&&u.isFalsy(gon.current_account.extra_fields.hideIfLessThan))if(o.view.collection.length||!u.isFalsy(gon.previewMode)||o.checkedCollection){if(l("#header_wrapper").css("visibility","visible"),-1===u.indexOf(a.request("get:current:user").get("features"),"remove_powered_by")){var t={name:"pixlee:generate:attribution:link",type:"action",source:"widget",destination:"parent",data:{src:window.location.href,isStandardOrStory:"standard"===gon.current_album.album_type||"story"===gon.current_album.album_type,isHiddenAB:"B"===gon.AB,landingPageURL:gon.current_account.extra_fields.landing_page_url,disablePoweredByClick:a.displayOptions.get("disablePoweredByClick")}};window.parent.postMessage(JSON.stringify(t),"*")}}else l(".btn").hide();else{var e=u.isFalsy(a.displayOptions.get("hideIfLessThan"))?gon.current_account.extra_fields.hideIfLessThan:a.displayOptions.get("hideIfLessThan"),i=gon.type,n=o.view.collection.length;if("carousel"===i)n=o.view.collection.reject(function(t){return t.get("isUploaderTile")}).length;n<e&&u.isFalsy(a.displayOptions.get("is_interactive"))?window.parentIFrame.close():(l("html").css("opacity",1),l("#header_wrapper").css("visibility","visible"))}r(),o.checkedCollection=!0,clearInterval(s)}},32)}}})}),Pixlee.module("Behaviors",function(t,n,e,i,o,r){t.Lightbox=i.Behavior.extend({ui:{imgHolder:".img_holder",layerVideo:".layer_video"},events:{"keydown @ui.imgHolder":"handleKeyboardEvents","click @ui.imgHolder":"openPhotoLightboxDebounced","click @ui.layerVideo":"openVideoLightboxDebounced"},initialize:function(){this.openPhotoLightboxDebounced=r.debounce(this.openPhotoLightbox,300,!0),this.openVideoLightboxDebounced=r.debounce(this.openVideoLightbox,300,!0)},onShow:function(){"undefined"!=typeof gon.show_lightbox&&r.isFalsy(gon.show_lightbox)&&(this.ui.imgHolder.addClass("noClick"),this.ui.layerVideo.addClass("noClick"))},handleKeyboardEvents:function(t){13===t.keyCode&&t.target.click()},openPhotoLightbox:function(){var t={sortType:gon.sortType,widget:gon.widget,perPage:this.getPageSize()},e={name:"pixlee:open:lightbox",type:"action",source:"widget",destination:"lightbox",data:{modelData:JSON.stringify(this.view.model.collection.toJSONForLightbox()),indexToOpen:this.view.model.collection.indexOf(this.view.model),variables:JSON.stringify(t),current_album:n.request("get:current:album").toJSON(),display_options:n.request("get:display:options").toJSON()}};window.lastElement=this.ui.imgHolder,window.parent.postMessage(JSON.stringify(e),"*")},openVideoLightbox:function(t){t.preventDefault();var e={sortType:gon.sortType,widget:gon.widget,perPage:this.getPageSize()},i={name:"pixlee:open:lightbox",type:"action",source:"widget",destination:"lightbox",data:{modelData:JSON.stringify(this.view.model.collection.toJSONForLightbox()),indexToOpen:this.view.model.collection.indexOf(this.view.model),variables:JSON.stringify(e),current_album:n.request("get:current:album").toJSON(),display_options:n.request("get:display:options").toJSON()}};window.lastElement=this.ui.imgHolder,window.parent.postMessage(JSON.stringify(i),"*")},getPageSize:function(){try{return this.view.model.collection.perPage}catch(t){return 0}}})}),Pixlee.module("Behaviors",function(t,e,i,n,o,r){t.Reviews=n.Behavior.extend({ui:{imageHolder:".img_holder",accesibilityImage:"img",textReview:".text_review_holder",reviewContent:".text_review",reviewerName:".reviewer_name",starHolder:".star_holder"},onShow:function(){this.reviewOptions=gon.display_options.reviewOptions||{},this.reviewOptions.displayReviews&&(this.markAsReview(),this.updatePhotoReviewInfo())},reviewReducer:function(t,e){return t+e.num_reviews},hasReviews:function(){var t=this.view.model.get("products");if(t.length){var e=r.pluck(t,"reviews_info");return 0<(e[0]?e.reduce(this.reviewReducer,0):0)&&!r.isFalsy(this.ui.textReview.data("review-id"))}},isAdjacent:function(t){var e=this.ui.imageHolder.width(),i=o("#widget").width();return Math.floor(i/e)%t==0},convertToReviewTile:function(){var t=this.ui.accesibilityImage.attr("data-prod-image");t=e.request("decode:utf8",t),this.view.$el.addClass("active_review"),this.ui.imageHolder.css("background-image","url("+t+")"),this.ui.accesibilityImage.attr("src",t)},markAsReview:function(){var t=this.view.model.collection,e=t.reviewSelectionOptions,i=this.reviewOptions.frequency||.35,n=t.perPage||15,o=n*i,r=Math.floor(n/o),s=Math.random()/2,a=.2,l=e.lastSet!==undefined?e.currentModelIndex-e.lastSet:0,u=Math.abs(r-e.gapNoise),c=this.hasReviews(),d=this.isAdjacent(l),h=!l||u<l&&!d,p=("mosaic_v2"===gon.type||"carousel"===gon.type&&"mosaic"===gon.display_options.carouselOptions.layout)&&gon.isMobile&&"small"===this.view.model.get("elementSize");c&&h&&s<=i&&!p?(this.convertToReviewTile(),e.lastSet=e.currentModelIndex,e.gapNoise=Math.ceil(o*a)):e.gapNoise=0,e.currentModelIndex++},updatePhotoReviewInfo:function(){this.view.model.set("selectedReviewInfo",{id:this.ui.textReview.data("review-id"),title:this.ui.reviewContent.data("title"),content:this.ui.reviewContent.text().trim(),rating:this.ui.starHolder.data("score"),user_name:this.ui.reviewerName.text().trim(),active:this.$el.hasClass("active_review")})}})}),Pixlee.module("Behaviors",function(t,o,e,i,r,s){t.Share=i.Behavior.extend({ui:{socialButton:".social_button"},events:{"click @ui.socialButton":"onShare","keydown @ui.socialButton":"onHandleKeyboard"},onHandleKeyboard:function(t){13===t.keyCode&&(t.preventDefault(),t.target.click())},onShare:function(t){var e,i=r(t.currentTarget);i.hasClass("pixlee_fshare")?e="facebook":i.hasClass("pixlee_tweet")?e="twitter":i.hasClass("pixlee_pinit")?e="pinterest":i.hasClass("pixlee_tumblr")&&(e="tumblr"),o.execute(e+":share",this.view.model),o.commands.execute("photo:shared",this.view.model.get("album_photo_id"),e);var n={name:"pixlee:social:share",type:"action",source:"widget",destination:"parent",data:{socialNetwork:e,products:s.map(this.view.model.get("products"),function(t){return{name:decodeURIComponent(t.title),sku:t.sku,imageUrl:decodeURIComponent(t.image),linkUrl:decodeURIComponent(t.link)}})}};window.parent.postMessage(JSON.stringify(n),"*")}})}),Pixlee.module("Behaviors",function(t,e,i,n,o,r){t.ShowPdpCaption=n.Behavior.extend({initialize:function(){this.view.templateHelpers=this.view.templateHelpers||{},Cocktail.mixin(this.view.templateHelpers,this.templateHelpers)},templateHelpers:{isPdpCaption:function(){return!r.isFalsy(e.request("get:display:options").get("pdpCaption"))},getPdpCaption:function(){var t=e.request("get:display:options").get("pdpCaption");return e.request("decode:utf8",t)}}})}),Pixlee.module("Behaviors",function(t,i,e,n){t.SocialConnect=n.Behavior.extend({initialize:function(){var t=this,e=i.widget.currentView.collection;t.defaultUrl=e.url(),e.on("sync",function(){t.getLoginStatus()})},events:{"click #facebook_login":function(){var e=this;i.execute("facebook:login:photos",function(t){e.processCollection("facebook",t)})},"click #instagram_login":function(){var e=this;i.execute("instagram:login:photos",function(t){e.processCollection("instagram",t)})},"click #twitter_login":function(){var e=this;i.execute("twitter:login:photos",function(t){e.processCollection("twitter",t)})}},processCollection:function(){var t=i.widget.currentView.collection;t.reset(),t.fetch()},getLoginStatus:function(){}})}),Pixlee.module("Behaviors",function(t,u,e,i,c,s){t.SubmitContentValidation=i.Behavior.extend({ui:{submitContent:"#submit_content_button",additionalTosInput:".additional_tos_input",tosInput:".tos_input"},events:{"keyup input":"removeSingleInputError","click @ui.tosInput":"removeSingleTosError"},onShow:function(){this.ui.submitContent.one("click",this.submitContent.bind(this))},submitContent:function(){this.view.ui.nameInput.find(".error").hide(),this.view.ui.emailInput.find(".error").hide(),this.view.ui.emailInput.find(".validate").hide(),this.view.ui.pixleeTosHolder.find(".error").hide(),this.view.ui.dobInput.find(".error").hide();var t=[this.checkDob(),this.checkFullName(),this.checkEmail(),this.checkPixleeAgreementTos(),this.checkClientAgreementTos(),this.checkAdditionalFields()];if(s.all(t)){var e=u.displayOptions.get("uploaderMinimumAge"),i=this.view.model.get("dob"),n=!e||!s.isTruthy(i)||moment().diff(moment(i,"MM-DD-YYYY"),"years")>=e;this.ui.submitContent.addClass("disabled"),this.view.trigger("update:breadcrumb","disabled"),n?(this[this.view.options.source+"Submit"](),this.view.triggerMethod("validation:success")):this.view.trigger("show:failed:submission:panel")}else this.ui.submitContent.one("click",this.submitContent.bind(this))},removeSingleInputError:function(t){c(t.currentTarget.parentElement).find(".error").hide()},removeSingleTosError:function(t){c(t.currentTarget).find(".error").hide()},checkDob:function(){var t=!0;if(this.view.ui.dobInput.is(":visible")){var e=moment(this.view.ui.dobInputText.val(),"YYYY-MM-DD"),i=moment();e.isValid()&&e.isBefore(i)&&e.isAfter("1920-01-01")?this.view.model.set("dob",e.format("MM-DD-YYYY")):(this.view.ui.dobInput.find(".error").show(),t=!1)}return t},checkFullName:function(){var t=!0;return s.isFalsy(this.view.ui.fullNameInputText.val())?(this.view.ui.nameInput.find(".error").show(),t=!1):("facebook"===this.view.options.source&&this.view.model.set("facebook_user_name",this.view.ui.fullNameInputText.val()),this.view.model.set("full_name",this.view.ui.fullNameInputText.val())),t},checkEmail:function(){var t=!0;s.isFalsy(this.view.ui.emailInputText.val())?(this.view.ui.emailInput.find(".error").show(),t=!1):/\S+@\S+\.\S+/.test(this.view.ui.emailInputText.val())?(this.view.ui.emailInput.find(".validate").hide(),this.view.model.set("email_address",this.view.ui.emailInputText.val())):(this.view.ui.emailInput.find(".validate").show(),t=!1);return t},checkPixleeAgreementTos:function(){var t=this.view.ui.pixleeTosCheckbox.is(":checked");return this.view.ui.pixleeTosHolder.find(".error").toggle(!t),t},checkClientAgreementTos:function(){var t=!0;return this.view.ui.clientTosHolder.is(":visible")&&!1!==gon.display_options.clientTosRequired&&(t=this.view.ui.clientTosCheckbox.is(":checked"),this.view.ui.clientTosHolder.find(".error").toggle(!t)),t},checkAdditionalFields:function(){var i=!0,n=this.view.model;return i=this.checkAndAddAdditionalTosFields(i,{}).valid,this.view.ui.additionalField.each(function(){var t=c(this),e=t.hasClass("required");s.isFalsy(t.find(".additional_input").val())?e&&(i=!1,t.find(".error").show()):(t.find(".error").hide(),n.set(t.find("label").html(),t.find(".additional_input").val()))}),i},instagramSubmit:function(){var t=this.createPhotoCollection(this.view.collection.models),e=u.request("get:current:album"),i=this.createPhotoObj(this.view.connectedUser.toJSON(),t,"instagram",e.get("id"));this.submitPhotos(i,this)},facebookSubmit:function(){var t=u.request("get:current:album"),e=this.createPhotoCollection(this.view.collection.models),i=this.createPhotoObj(this.view.connectedUser.toJSON(),e,"facebook",t.get("id"));this.submitPhotos(i,this)},googleSubmit:function(){var t=u.request("get:current:album"),e=this.createPhotoCollection(this.view.collection.models,"google"),i=this.createPhotoObj(this.view.connectedUser.toJSON(),e,"google",t.get("id"));this.submitPhotos(i,this)},desktopSubmit:function(){for(var t=this,e=u.request("get:config").toJSON(),i=u.request("get:current:user").toJSON(),n=this.view.collection.models,o=e.distilleryUrl+"inbound/v1/create_cp?api_key="+i.single_access_token+"&time_stamp="+Date.now(),r=0;r<n.length;r++){var s=n[r],a=(s.get("uid"),u.request("get:current:album").get("id")),l={album_id:a,title:s.get("caption")||null,uploader_product_input:s.get("uploader_product_input")||"",email:this.view.model.get("email_address"),username:this.view.model.get("full_name"),connected_user:this.view.connectedUser.toJSON()};s.set("album_id",a),c.ajax({type:"POST",url:o,contentType:"application/json",dataType:"json",data:JSON.stringify(l),success:t.successCallback,context:{model:s}})}},successCallback:function(t){var e,i=this.model.get("files"),n=u.request("decode:utf8",i[0].name).replace(/[\`\'\'\(\)\/\+\%]/gi,"_"),o=t.path+n;this.model.set("photoId",t.album_photo_id),i[0].fileKey=o,(e=s.isFalsy(this.model.attributes.form)||s.isFalsy(this.model.attributes.form.length)?c("#drag_drop_title"):this.model.attributes.form).find("input[name=key]").val(o),e.find("input[name=Filename]").val(n),e.find("input[name=policy]").val(t.encoded_policy),e.find("input[name=signature]").val(t.signature),e.find("input[name=AWSAccessKeyId]").val(t.access_key||"AKIATNG6EAYVBK6T77BU"),e.find("input[name=Content-Type]").val(i[0].type),this.model.attributes.submit()},createPhotoCollection:function(t,e){for(var i=[],n=0;n<t.length;n++){var o={};o="google"===e?{id:t[n].get("id"),type:t[n].get("type"),caption:u.request("encode:utf8",t[n].get("caption")||""),extra_data:t[n].get("extra_data"),uploader_product_input:u.request("encode:utf8",t[n].get("uploader_product_input")||""),googlePhotoObject:t[n]}:{id:t[n].get("id"),type:t[n].get("type"),caption:u.request("encode:utf8",t[n].get("caption")),uploader_product_input:u.request("encode:utf8",t[n].get("uploader_product_input")||""),extra_data:t[n].get("extra_data")},i.push(o)}return i},checkAndAddAdditionalTosFields:function(a,l){var u=this.view.model;return this.ui.additionalTosInput.each(function(){var t=c(this),e=t.hasClass("required"),i=t.find("input").first().is(":checked");e&&!i&&(a=!1,t.find(".error").toggle(!i));var n=t.find("label"),o=n.text(),r=window.getComputedStyle?window.getComputedStyle(n[0],":before").content:"none",s="none"===r?o:r;u.set(s,i),l.uploader_additional_fields&&(l.uploader_additional_fields[s]=i)}),{extraFields:l,valid:a}},createPhotoObj:function(t,e,i,n){var r={uploader_additional_fields:{full_name:t.full_name,email_address:t.email_address,dob:t.dob}},o=c(".additional_field");return o.length&&o.each(function(){var t=c(this),e=t.find(".error"),i=t.find(".additional_input"),n=t.hasClass("required");if(s.isFalsy(i.val()))n&&e.show();else{e.hide();var o=t.find("label").html();r.uploader_additional_fields[o]=i.val()}}),r=this.checkAndAddAdditionalTosFields(!0,r).extraFields,{connectedUser:JSON.stringify(t),collection:JSON.stringify(e),source:i,album_id:n,extra_fields:JSON.stringify(r)}},submitPhotos:function(t){u.execute("show:uploader:loader"),this.uploadedAlbumPhotoIds=[];var i=new Pusher(gon.global.pusherKey),n="social_photo_processed-"+(gon.distinct_user_hash||gon.fingerprint)+"-"+Date.now();(t.pusherChannelName=n,s.isFalsy(i.channels.find(n)))&&i.subscribe(n).bind("add_photo",function(t){this.uploadedAlbumPhotoIds.push(t.album_photo_id);var e=this.view.collection.models.length;this.uploadedAlbumPhotoIds.length===e&&(i.unsubscribe(n),this.submitPhotosComplete())}.bind(this));c.ajax({type:"POST",url:"/uploadSocial",contentType:"application/json",dataType:"json",data:JSON.stringify(t)}),setTimeout(function(){i.unsubscribe(n),this.submitPhotosComplete()}.bind(this),15e3)},submitPhotosComplete:function(){u.execute("hide:uploader:loader");var t={uploadedAlbumPhotoIds:this.uploadedAlbumPhotoIds||[]};this.view.isDestroyed||(this.view.trigger("update:bread:crumb","four"),this.view.trigger("show:confirm:panel",t))}})}),Pixlee.module("Behaviors",function(t,u,e,i,c,d){t.SubmitPhotos=i.Behavior.extend({ui:{submitContent:"#submit_content",dragDropTitle:"#drag_drop_title"},onShow:function(){this.ui.submitContent.one("click",this,this.submitValidation)},submitValidation:function(t){var e=t.data,i=e.$el.find(".required"),n=!0;c.each(i,function(t,e){var i=c(e).parent();d.isFalsy(e.value)?(n=!1,i.addClass("error")):i.removeClass("error")}),n?(e[e.view.options.source+"Submit"](),e.view.triggerMethod("submit")):e.ui.submitContent.one("click",e,e.submitValidation)},instagramSubmit:function(){var t,e,i=u.request("get:current:album"),n=this.view.collection.models;t=this.createPhotoCollection(n),e=this.createPhotoObj(this.view.connectedUser.toJSON(),t,"instagram",i.get("id")),this.submitPhotos(e,this)},facebookSubmit:function(){var t,e,i=u.request("get:current:album"),n=this.view.collection.models;t=this.createPhotoCollection(n),e=this.createPhotoObj(this.view.connectedUser.toJSON(),t,"facebook",i.get("id")),this.submitPhotos(e,this)},desktopSubmit:function(){for(var t,e=u.request("get:config").toJSON(),i=u.request("get:current:user").toJSON(),n=this.view.collection.models,o=e.distilleryUrl+"inbound/v1/create_cp?api_key="+i.single_access_token+"&time_stamp="+Date.now(),r=this,s=0;s<n.length;s++){var a=n[s],l=(a.get("uid"),u.request("get:current:album").get("id"));a.set("album_id",l),t={album_id:l,title:d.isFalsy(a.get("caption"))?null:a.get("caption"),email:this.view.model.get("email_address"),username:this.view.model.get("full_name"),connected_user:this.view.connectedUser.toJSON()},c.ajax({type:"POST",url:o,contentType:"application/json",dataType:"json",data:JSON.stringify(t),success:r.successCallback,context:{model:a}})}},successCallback:function(t){var e,i=this.model.get("files"),n=u.request("decode:utf8",i[0].name).replace(/[\`\'\'\(\)\/\+\%]/gi,"_"),o=t.path+n;this.model.set("photoId",t.album_photo_id),i[0].fileKey=o,e=d.isFalsy(this.model.attributes.form)||d.isFalsy(this.model.attributes.form.length)?c("#drag_drop_title"):this.model.attributes.form,window.console&&(console.log("this.model.attributes.form "+this.model.toJSON()),console.log("$(#drag_drop_title).length "+c("#drag_drop_title").length),console.log("form.length "+e.length),console.log('$("#drag_drop_title").find("input[name=key]").length '+e.find("input[name=key]").length)),e.find("input[name=key]").val(o),window.console&&(console.log("key"),console.log(o),console.log(e.find("input[name=key]").val())),e.find("input[name=Filename]").val(n),window.console&&(console.log("Filename"),console.log(n),console.log(e.find("input[name=Filename]").val())),e.find("input[name=policy]").val(t.encoded_policy),window.console&&(console.log("policy"),console.log(t.encoded_policy),console.log(e.find("input[name=policy]").val())),e.find("input[name=signature]").val(t.signature),window.console&&(console.log("signature"),console.log(t.signature),console.log(e.find("input[name=signature]").val())),e.find("input[name=AWSAccessKeyId]").val(t.access_key||"AKIATNG6EAYVBK6T77BU"),window.console&&(console.log("AWSAccessKeyId"),console.log(t.access_key),console.log(e.find("input[name=AWSAccessKeyId]").val())),e.find("input[name=Content-Type]").val(i[0].type),window.console&&(console.log("Content-Type"),console.log(i[0].type),console.log(e.find("input[name=Content-Type]").val())),this.model.attributes.submit()},createPhotoCollection:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],o=d.isFalsy(n.get("caption"))?"":n.get("caption");e.push({id:n.get("id"),type:n.get("type"),caption:u.request("encode:utf8",o),extra_data:n.get("extra_data")})}return e},createPhotoObj:function(t,e,i,n){return{connectedUser:JSON.stringify(t),collection:JSON.stringify(e),source:i,album_id:n}},submitPhotos:function(t){var e=this;c.ajax({type:"POST",url:"/uploadSocial",contentType:"application/json",dataType:"json",data:JSON.stringify(t),success:function(){var t;147890==u.request("get:current:album").get("id")?(t=u.displayOptions.get("thankYouUrl_input"),d.isFalsy(t)||(t=t+e.view.connectedUser.get("full_name")+"&email="+e.view.connectedUser.get("email_address"),window.top.location=t)):e.view.trigger("show:confirm:panel")}})}})}),Pixlee.module("Behaviors",function(t,i,e,n,o,a){t.Tap2ShopMobile=n.Behavior.extend({ui:{customCtaAnchor:".custom_call_to_action_anchor",layerVideo:".layer_video"},events:{"click @ui.customCtaAnchor":"ctaClicked","click @ui.layerVideo":"openVideoLightboxDebounced"},initialize:function(){this.currentAlbum=i.request("get:current:album"),this.displayOptions=i.request("get:display:options"),this.openVideoLightboxDebounced=a.debounce(this.openVideoLightbox,300,!0)},onShow:function(){var t=this.generateCtaLink();if(!a.isFalsy(t)){var e=i.request("decode:utf8",this.formatLink(t,this.view.model));this.ui.customCtaAnchor.attr("href",e),"video"===this.view.model.get("content_type")&&this.ui.layerVideo.attr("href",e)}},ctaClicked:function(){var t=this.generateCtaLink();a.isFalsy(t)||(i.execute("opened:photo",this.view.model.get("album_photo_id"),1,t),i.execute("action:clicked",this.view.model.get("album_photo_id"),t))},generateCtaLink:function(){var t="",e=this.view.model;return"product"!==this.currentAlbum.get("album_type")&&e.get("action_link")?t=e.get("action_link"):0<e.get("products").length?t=e.get("products")[0].link:gon.display_options.customCallToActionLink&&(t=gon.display_options.customCallToActionLink),t},openVideoLightbox:function(t){t.preventDefault();for(var e={sortType:gon.sortType,widget:gon.widget},i=this.view.model.collection.clone(),n=i.length-1;0<=n;n--)"video"!==i.models[n].get("content_type")&&i.models.splice(n,1);var o={name:"pixlee:open:lightbox",type:"action",source:"widget",destination:"lightbox",data:{modelData:JSON.stringify(i.toJSONForLightbox()),indexToOpen:i.indexOf(this.view.model),variables:JSON.stringify(e),current_album:this.currentAlbum.toJSON(),display_options:this.displayOptions.toJSON()}};window.parent.postMessage(JSON.stringify(o),"*")},formatLink:function(t){var e=this.displayOptions;if(a.isFalsy(e.get("url_scheme"))&&a.isFalsy(gon.current_account.extra_fields.url_scheme))return t;try{var i,n=t,o=this.currentAlbum.get("title").replace(/ /g,"-").toLowerCase(),r=encodeURIComponent(encodeURIComponent(o));switch(e.get("url_scheme")?e.get("url_scheme").url_scheme_title:gon.current_account.extra_fields.url_scheme.url_scheme_title){case"kimpton_gacid":i="&gacid="+window.PixleeTags.Kimpton.GACID;break;case"kcp_pixlee":i="&om=pixlee:"+r+":"+this.currentAlbum.id;break;case"kcp_pixlee_v2":i="&pixlee="+r+":"+this.currentAlbum.id;break;default:i=e.get("url_scheme")?e.get("url_scheme").attribution_string:gon.current_account.extra_fields.url_scheme.attribution_string}return-1!==n.indexOf(i)?n:n+i}catch(s){return t}}})}),Pixlee.module("Behaviors",function(t,e,i,n,o,r){t.UploadContentValidation=n.Behavior.extend({ui:{nextPanel:"#next",dragDropTitle:"#drag_drop_title"},onShow:function(){this.ui.nextPanel.one("click",this.submitValidation.bind(this))},submitValidation:function(){var t=this.$el.find(".required"),n=!0;o.each(t,function(t,e){var i=o(e).parent();r.isFalsy(e.value)?(n=!1,i.addClass("error")):i.removeClass("error")}),n?this.view.triggerMethod("show:submit:content:panel"):this.ui.nextPanel.one("click",this.submitValidation.bind(this))}})}),Pixlee.module("Behaviors",function(t,n,e,i,o,r){t.Upload=i.Behavior.extend({ui:{uploadNow:"#upload_now"},initialize:function(){gon.previewMode&&window.addEventListener("message",this.receiveDesignEditorMessages,!1)},events:{"click @ui.uploadNow":"openUploader","keydown @ui.uploadNow":"onKeydownUploader"},onShow:function(){var t=n.request("get:display:options"),e=t.get("headerOptions");r.isFalsy(n.request("get:current:album").get("public_contribution"))&&Object.keys(e).length<=1?this.ui.uploadNow.remove():void 0!==t.get("pdpShowUploader")&&r.isFalsy(t.get("pdpShowUploader"))&&this.ui.uploadNow.remove();var i=this.ui.uploadNow.is(":hidden");"tile"===e.layout&&r.isFalsy(e.showViewGallery||e.showDescription||e.showTitle||!i)&&o("#header_tile_container").remove()},onKeydownUploader:function(t){var e=13
;t.keyCode===e&&this.openUploader()},openUploader:function(){var t={name:"pixlee:show:uploader",type:"action",source:"widget",destination:"parent",data:{widgetId:window.location.href}};this.designEditorDevice&&(t.data.designEditorDevice=this.designEditorDevice),window.lastElement=this.ui.uploadNow,window.parent.postMessage(JSON.stringify(t),"*")},receiveDesignEditorMessages:function(){var n=this;r.throttle(function(t){try{var e=JSON.parse(t.data);"pixlee:design:editor:device"===e.name&&(n.designEditorDevice=e.data.deviceType)}catch(i){return}},1e3)}})}),Pixlee.module("Behaviors",function(t,e,i,n,o,r){t.UploaderValidation=n.Behavior.extend({events:{"click #done":"clickDone"},clickDone:function(){var e=!0,i=this;(this.view.ui.nameInput.find(".error").hide(),this.view.ui.emailInput.find(".error").hide(),this.view.ui.emailInput.find(".validate").hide(),this.view.ui.pixleeTosHolder.find(".error").hide(),this.view.ui.dobInput.find(".error").hide(),this.view.ui.dobInput.is(":visible"))&&(moment(this.view.ui.dobInputText.val(),"MM-DD-YYYY").isValid()?this.view.model.set("dob",this.view.ui.dobInputText.val()):(this.view.ui.dobInput.find(".error").show(),e=!1));(r.isFalsy(this.view.ui.fullNameInputText.val())?(this.view.ui.nameInput.find(".error").show(),e=!1):("facebook"===this.view.options.source&&this.view.model.set("facebook_user_name",this.view.ui.fullNameInputText.val()),this.view.model.set("full_name",this.view.ui.fullNameInputText.val())),r.isFalsy(this.view.ui.emailInputText.val()))?(this.view.ui.emailInput.find(".error").show(),e=!1):/\S+@\S+\.\S+/.test(this.view.ui.emailInputText.val())?(this.view.ui.emailInput.find(".validate").hide(),this.view.model.set("email_address",this.view.ui.emailInputText.val())):(this.view.ui.emailInput.find(".validate").show(),e=!1);this.view.ui.pixleeTosCheckbox.is(":checked")?this.view.ui.pixleeTosHolder.find(".error").hide():(e=!1,this.view.ui.pixleeTosHolder.find(".error").show()),this.view.ui.clientTosHolder.is(":visible")&&(this.view.ui.clientTosCheckbox.is(":checked")?this.view.ui.clientTosHolder.find(".error").hide():(e=!1,this.view.ui.clientTosHolder.find(".error").show())),0<o(".additional_tos_input").length&&o(".additional_tos_input").each(function(){o(this).find("input").is(":checked")?o(this).find(".error").hide():(e=!1,o(this).find(".error").show())}),this.view.ui.additionalField.each(function(){var t=o(this).hasClass("required");r.isFalsy(o(this).find(".additional_input").val())?t&&(e=!1,o(this).find(".error").show()):(o(this).find(".error").hide(),i.view.model.set(o(this).find("label").html(),o(this).find(".additional_input").val()))}),e&&this.view.triggerMethod("validation:success")}})}),Pixlee.module("Behaviors",function(t,e,i,n,o,r){t.Vote=n.Behavior.extend({ui:{voteButton:".vote_button",voteCount:".vote_count"},modelEvents:{voted:"onVoted",lightboxVote:"onLightboxVote"},events:{"click @ui.voteButton":"onVoteClicked"},onVoteClicked:function(){this.voteInterval=this.voteInterval||gon.current_album&&gon.current_album.vote_interval,this.ui.voteButton.addClass("active"),o.ajax({url:"/social/like",type:"POST",data:{id:this.view.model.get("album_photo_id"),distinct_user_hash:gon.distinct_user_hash||analytics.getAnonymousId(),fingerprint:gon.fingerprint},dataType:"json",success:function(t){if(t.pixlee_likes){var e={name:"pixlee:save:votes",type:"action",source:"lightbox",destination:"parent",data:{pixlee_likes:t.pixlee_likes}};window.parent.postMessage(JSON.stringify(e),"*")}0===t.error_code?(this.view.model.set({like_count:t.like_count,userVoted:!0}),this.view.model.trigger("voted")):1===t.error_code||(2===t.error_code?this.ui.voteButton.removeClass("active"):3===t.error_code&&(this.view.model.set("userVoted",!0),this.view.model.trigger("voted")))}.bind(this)})},onVoted:function(){this.ui.voteButton.addClass("active"),this.ui.voteCount.text(this.view.model.get("like_count")),-1===[undefined,null,"1 day","7 days","1 year"].indexOf(this.voteInterval)&&(this.view.model.set("userVoted",!1),this.ui.voteButton.removeClass("active"))},onLightboxVote:function(){this.ui.voteButton.addClass("active"),this.ui.voteButton.click()}}),t.CollectionVote=n.Behavior.extend({collectionEvents:{sync:function(){this.firstLoad=!0,this.onSync(this)}},initialize:function(){var o=this;this.view.options.collectionQueue&&this.view.options.collectionQueue.on("sync",function(){this.firstLoad=!0,this.onSync(this)}.bind(this)),e.commands.setHandlers({"vote:loaded":r.bind(this.onSync,this)}),window.addEventListener("message",function(t){var e;if(t.data){try{e=JSON.parse(t.data)}catch(n){return}if(e.name&&"pixlee:lightbox:vote"==e.name){var i=JSON.parse(e.data);r.each(o.view.collection.models,function(t){t.get("album_id")+"_"+t.get("album_photo_id")==i.album_id+"_"+i.album_photo_id&&(t.trigger("lightboxVote"),t.set("userVoted",!0))})}}},!1)},onSync:function(){if(gon.pixlee_votes&&0<gon.pixlee_votes.length&&this.firstLoad){var t={name:"pixlee:save:votes",type:"action",source:"lightbox",destination:"parent",data:{pixlee_likes:gon.pixlee_votes}};window.parent.postMessage(JSON.stringify(t),"*");var e=this.view.collectionQueue?this.view.collectionQueue.models:this.view.collection.models;r.each(e,function(t){-1!=r.indexOf(gon.pixlee_votes,t.get("album_id")+"_"+t.get("album_photo_id"))&&(t.trigger("voted"),t.set("userVoted",!0))})}}})}),Pixlee.module("Concerns",function(t,e,i,n,o,r){t.SetSponserUrl={setUrl:function(){r.isFalsy(params.header_sponserImage_input)||(header_sponserImage_input=params.header_sponserImage_input,e.displayOptions.set("header_sponserImage_input",header_sponserImage_input),headerView=_this.getHeaderView({model:e.request("get:current:album")}),_this.show(headerView,{region:layout.widget_header_region}))}}}),Pixlee.module("Concerns",function(t,e,i,n,o,r){t.designEditorCollectionHelpers={initialize:function(){r.isTruthy(gon.previewMode)&&(this.displayOptions=e.request("get:display:options"),this.listenTo(this.displayOptions,{"change:reviewOptions.lightboxReviews":this.refreshWidget,"change:reviewOptions.frequency":this.refreshWidget,"change:pageSize":this.refreshWidget,"change:carouselOptions.smoothSwiping":this.refreshWidget}))},refreshWidget:function(t){gon.activeReviewIds=[],this.closeLightbox(),r.isArray(this.swiperQueue)?(this.options.photosCollection.reset(),this.updateSwipingMode(t.get("carouselOptions.smoothSwiping"))):this.collectionQueue&&this.collectionQueue!==this.collection?this.collectionQueue.fetch({reset:!0}):this.collection.fetch({reset:!0})},closeLightbox:function(){var t={name:"pixlee:close:lightbox",type:"action",source:"lightbox",destination:"all",data:{}};window.parent.postMessage(JSON.stringify(t),"*")}}}),Pixlee.module("Concerns",function(t,e,i,n,o,r){t.headerHelpers={templateHelpers:function(){var t=this.options.displayOptions.headerOptions;return{getLayoutClass:function(){return r.isFalsy(t)?"":t.layout},getButtonClass:function(){return r.isFalsy(t)?"":t.button},getHeaderTitle:function(){return r.isFalsy(t)?"":t.title},getHeaderDescription:function(){return r.isFalsy(t)?"":t.description},showTitle:function(){return r.isFalsy(t)?"":t.showTitle},showDescription:function(){return r.isFalsy(t)?"":t.showDescription},isViewGallery:function(){return!r.isFalsy(t)&&t.showViewGallery},getViewGalleryText:function(){return t.viewGalleryTitle},getViewGalleryUrl:function(){return t.viewGalleryUrl},decode_utf8:function(t){return e.request("decode:utf8",t)}}}}}),Pixlee.module("Concerns",function(t,e,i,n,o,r){t.keyboardHelpers={focusableElementsArray:["a[href]","area[href]","button:not([disabled])","embed","iframe",'input:not([type="hidden"]):not([tabindex="-1"]):visible',"object","select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"]):visible'],onShow:function(){document.addEventListener("keydown",function(){document.body.classList.contains("using-mouse")&&document.body.classList.remove("using-mouse"),document.body.classList.add("using-keyboard")}),document.addEventListener("mousedown",function(){document.body.classList.contains("using-keyboard")&&document.body.classList.remove("using-keyboard"),document.body.classList.add("using-mouse")})},createFocusIndex:function(t){var n=[];return r.each(t,function(t){var e=o(t).find(this.focusableElementsArray.join()),i=Array.prototype.slice.call(e);n.push(i)}.bind(this)),[].concat.apply([],n)}}}),Pixlee.module("Concerns",function(t,e,i,n,o,r){t.LayoutHelpers={initialize:function(){this.displayOptions=e.request("get:display:options"),gon.previewMode&&this.listenForMessage()},listenForMessage:function(){var t=r.throttle(function(t){try{var e=JSON.parse(t.data);"pixlee:css:generated"===e.name&&o("#header_banner_image img").attr("src",e.data.displayOptions.headerOptions.bannerImage||"")}catch(i){return}},1e3);window.addEventListener("message",t,!1)},templateHelpers:function(){var t=this.displayOptions.get("headerOptions");return{getLayoutClass:function(){return r.isFalsy(t)?"":t.layout},isHeaderV2:function(){return!r.isFalsy(t)&&1<Object.keys(t).length},isTile:function(){return"tile"===t.layout}}}}}),Pixlee.module("Concerns",function(t,e,p,i,n,f){t.perfectMosaicHelpers={calculatePhotoSizes:function(t){var e=this.collectionQueue.findWhere({queueModel:!0});this.collectionQueue.remove(e);var i,n=2*Math.floor(t/2),o=Math.floor(n/2),r=this.collectionQueue.length/4,s=r=1===f.random(0,1)?Math.floor(r):Math.ceil(r),a=0;for(i=0;i<this.collectionQueue.length&&(s=r+i,!(0<=(a=this.calculateMosaicFit(this.collectionQueue,s,n,o))));i++);if(a<0)for(a=0,i=1;i<=r&&(s=r-i,!(0<=(a=this.calculateMosaicFit(this.collectionQueue,s,n,o))));i++)i===r&&(a=0);var l=this.collectionQueue.length-a,u=this.randomizeLargePhotos(this.collectionQueue,s,n,o,l),c=this.options.displayOptions.headerOptions,d=c&&"tile"===c.layout;for(1===this.collectionQueue.currentPage&&d&&0<u.length&&1<l&&(u.shift(),l--),i=0;i<l;i++){var h=this.collectionQueue.shift();f.contains(u,h)?h.set("elementSize","large"):h.set("elementSize","small"),this.collection.add(h)}0<l&&0===this.collectionQueue.length&&(e=new p.Model({queueModel:!0}),this.collectionQueue.add(e))},calculateMosaicFit:function(t,e,i,n){var o=2*i-e%n*4;return(t.length-e-o)%i},randomizeLargePhotos:function(t,e,i,n,o){var r=o-(o-i<e?n:i);r=e<t.length&&r<e?e:r;var s=f.filter(t.models,function(t,e){if(e<r)return!0});return f.sample(s,e)}}}),Pixlee.module("Concerns",function(t,e,i,n,o,r){t.ReviewHelpers={templateHelpers:{pluckReviews:function(e){var t=e.reviews_info?e.reviews_info.reviews:[];return r.map(t,function(t){return t.productImage=e.image_thumb,t.productName=e.title,t})},ensureUniqueReviews:function(t){return r.contains(gon.activeReviewIds,t.id)},selectReview:function(){var t=this.products,e={id:0,score:0,title:"No Review",content:"No Review",user_name:""};if(t.length){gon.activeReviewIds=gon.activeReviewIds||[];var i=r.reject(r.flatten(r.map(t,this.pluckReviews)),this.ensureUniqueReviews),n=Math.floor(Math.random()*i.length);i[n]&&(e=i[n]),60<gon.activeReviewIds.length&&(gon.activeReviewIds=[]),gon.activeReviewIds=gon.activeReviewIds.concat(e.id)}this.selectedReview=e},getReview:function(){return r.isFalsy(this.selectedReview)&&this.selectReview(),this.selectedReview}}}}),Pixlee.module("Concerns",function(t,i,e,n,o,r){t.StandaloneHeaderHelpers={ui:{standaloneContainer:"#standalone_header",brandLogo:"#brand_logo",brandImageLink:"#banner_image_link",instagramProfile:"#instagram_profile",twitterProfile:"#twitter_profile",pinterestProfile:"#pinterest_profile",facebookProfile:"#facebook_profile",socialIcons:".social_profile_icons"},events:{"click @ui.brandLogo":"trackAnalytics","click @ui.brandImageLink":"trackAnalytics","click @ui.socialIcons":"trackAnalytics"},initialize:function(){this.displayOptions=i.request("get:display:options"),this.listenTo(this.displayOptions,{"change:standaloneOptions.bannerImage_showHide":this.render,"change:standaloneOptions.logoImage_showHide":this.render,"change:standaloneOptions.logoImage_backgroundImage":this.render,"change:standaloneOptions.bannerImage_backgroundImage":this.render,"change:standaloneOptions.logoImage_input":this.render,"change:standaloneOptions.bannerImage_input":this.render})},onShow:function(){var t=["instagram","twitter","pinterest","facebook"];r.each(t,this.showSocialIcon.bind(this))},trackAnalytics:function(t){i.execute("standalone:click:through",o(t.currentTarget).attr("id"))},showSocialIcon:function(t){var e=t+"Profile";r.isFalsy(this.displayOptions.get(t+"_username"))||this.ui[e].css("display","inline-block")},templateHelpers:function(){var e=this;return{shouldShowBannerImage:function(){return e.displayOptions.get("standaloneOptions.bannerImage_showHide")},shouldShowLogoImage:function(){return e.displayOptions.get("standaloneOptions.logoImage_showHide")},isStandalone:function(){return"standalone"===e.displayOptions.get("channel")},getLogoImage:function(){return r.isFalsy(e.displayOptions.get("standaloneOptions.logoImage_backgroundImage"))?"":"background-image: url("+e.displayOptions.get("standaloneOptions.logoImage_backgroundImage")+")"},getLogoRedirectURL:function(){return e.displayOptions.get("standaloneOptions.logoImage_input")||""},getBannerImage:function(){return r.isFalsy(e.displayOptions.get("standaloneOptions.bannerImage_backgroundImage"))?gon.previewMode?"":"display:none;":"background-image: url("+e.displayOptions.get("standaloneOptions.bannerImage_backgroundImage")+")"},getBannerImageURL:function(){return r.isFalsy(e.displayOptions.get("standaloneOptions.bannerImage_backgroundImage"))?"":e.displayOptions.get("standaloneOptions.bannerImage_backgroundImage")},getBannerRedirectURL:function(){return e.displayOptions.get("standaloneOptions.bannerImage_input")||""},getInstagramURL:function(){var t=e.displayOptions.get("instagram_username");return r.isFalsy(t)||r.isFalsy(t.user_name)?"":"https://www.instagram.com/"+t.user_name},getTwitterURL:function(){var t=e.displayOptions.get("twitter_username");return r.isFalsy(t)||r.isFalsy(t.user_name)?"":"https://www.twitter.com/"+t.user_name},getPinterestURL:function(){var t=e.displayOptions.get("pinterest_username");return r.isFalsy(t)||r.isFalsy(t.user_name)?"":"https://www.pinterest.com/"+t.user_name},getFacebookURL:function(){var t=e.displayOptions.get("facebook_username");return r.isFalsy(t)||r.isFalsy(t.social_id)?"":"https://www.facebook.com/"+t.social_id},getLayoutClass:function(){return e.displayOptions.get("headerOptions").layout},getButtonClass:function(){return e.displayOptions.get("headerOptions").button},getHeaderTitle:function(){return e.displayOptions.get("headerOptions").showTitle?e.displayOptions.get("headerOptions").title:""},getHeaderDescription:function(){return e.displayOptions.get("headerOptions").showDescription?e.displayOptions.get("headerOptions").description:""},isTile:function(){return"tile"===e.displayOptions.get("headerOptions").layout},getWidgetType:function(){return e.displayOptions.get("type")},isHeaderV2:function(){var t=e.displayOptions.get("headerOptions");return!r.isFalsy(t)&&1<Object.keys(t).length},isViewGallery:function(){return!r.isFalsy(e.displayOptions.get("headerOptions"))&&e.displayOptions.get("headerOptions").showViewGallery},getViewGalleryText:function(){return e.displayOptions.get("headerOptions").viewGalleryTitle},getViewGalleryUrl:function(){return e.displayOptions.get("headerOptions").viewGalleryUrl},getHeaderBannerImage:function(){return e.displayOptions.get("headerOptions").bannerImage||""},decode_utf8:function(t){return i.request("decode:utf8",t)}}}}}),Pixlee.module("Concerns",function(t,e,i,n,o,r){t.tabindexHelpers={onShow:function(){this.initTabListener()},initTabListener:function(){var e=this;document.addEventListener("keydown",function(t){document.body.classList.contains("using-mouse")&&document.body.classList.remove("using-mouse"),document.body.classList.add("using-keyboard"),e.highlightTabIndex(t,e)}),document.addEventListener("mousedown",function(){document.body.classList.contains("using-keyboard")&&document.body.classList.remove("using-keyboard"),document.body.classList.add("using-mouse"),e.removeHighlightTabIndex(e)})},highlightTabIndex:function(e,t){setTimeout(function(){if(9===e.keyCode){this.removeHighlightTabIndex(this);var t=o(document.activeElement).closest(".photo_block");r.isFalsy(this.sly)||r.isFalsy(t)||this.sly.activate(t),this.lastActiveElement=document.activeElement}}.bind(t),5)},removeHighlightTabIndex:function(t){r.isFalsy(t.lastActiveElement)||(o(t.lastActiveElement).attr("tabindex",0),t.lastActiveElement=!1)}}}),Pixlee.module("Concerns",function(t,e){t.UploaderReviewPanelItem={onShow:function(){this.triggerMethod("update:breadcrumb","three"),"video"===this.model.get("type")?this.$el.addClass("content_video"):this.$el.addClass("content_image"),e.displayOptions.get("enableProductField")||this.$el.addClass("no_product_field")},changeCaption:function(){this.model.set("caption",this.ui.captionText.val().trim())},changeProductField:function(){this.model.set("uploader_product_input",this.ui.productField.val().trim())},deleteContent:function(){1===this.model.collection.length&&this.triggerMethod("update:breadcrumb","two",!0),this.model.collection.remove(this.model)}}}),Pixlee.module("Views",function(t,e,i,n,o){t.CollectionView=n.CollectionView.extend({childViewEventPrefix:"child",showLoader:function(){!this.loaded&&0<this.collection.length&&0===o("#loader").length&&(this.loader=o('<div id="loading_container" />').append('<div id="loader" />'),this.$el.after(this.loader))},removeLoader:function(){this.loaded=!0,this.loader&&this.loader.remove()}})}),Pixlee.module("Views",function(t,e,i,n){t.CompositeView=n.CompositeView.extend({childViewEventPrefix:"child"})}),Pixlee.module("Views",function(t,e,i,n){t.ItemView=n.ItemView.extend({})}),Pixlee.module("Views",function(t,e,i,n){t.Layout=n.LayoutView.extend({})}),Pixlee.module("Views",function(t,e,i,n,o,r){var s,a,l;s=n.View.prototype.remove,a=n.View,l=n.View.prototype.destroy,n.View=n.View.extend({addOpacityWrapper:function(t){return null==t&&(t=!0),this.$el.toggleWrapper({className:"opacity"},t)},setInstancePropertiesFor:function(){var t,e,i,n,o;for(e in t=1<=arguments.length?__slice.call(arguments,0):[],o=[],n=r.pick.apply(r,[this.options].concat(__slice.call(t))))i=n[e],o.push(this[e]=i);return o},remove:function(){var t,e,i,n=this;if(t=1<=arguments.length?__slice.call(arguments,0):[],null==(i=this.model)||"function"!=typeof i.isDestroyed||!i.isDestroyed())return s.apply(this,t);e=this.$el.toggleWrapper({className:"removing"}),setTimeout(function(){e.remove(),s.apply(n,t)},350),this.$el.css({"-webkit-transform":"scale(0)","-moz-transform":"scale(0)","-ms-transform":"scale(0)","-o-transform":"scale(0)",transform:"scale(0)",opacity:"0"})},destroy:function(){var t;t=1<=arguments.length?__slice.call(arguments,0):[],i.ModelBinder&&this._modelBinder.unbind(),l.apply(this,t)},_modelBinder:undefined,constructor:function(){var t;t=1<=arguments.length?__slice.call(arguments,0):[],i.ModelBinder&&(this._modelBinder=new i.ModelBinder),a.apply(this,t)},configure:function(t){this.options&&(t=r.extend({},r.result(this,"options"),t)),this.options=t}})}),Pixlee.module("Components.Loading",function(i,o,t,e,n,r){i.LoadingController=o.Controllers.Application.extend({initialize:function(t){var e,i=t.view,n=t.config;switch(n=r.isBoolean(n)?{}:n,r.defaults(n,{loadingType:"spinner",entities:this.getEntities(i),debug:!1}),n.loadingType){case"opacity":this.region.currentView.$el.css("opacity",.5);break;case"spinner":case"analytics_spinner":e=this.getLoadingView(),this.show(e);break;default:throw new Error("Invalid loadingType")}this.showRealView(i,e,n)},showRealView:function(t,e,i){var n=this;o.execute("when:fetched",i.entities,function(){switch(i.loadingType){case"opacity":n.region.currentView.$el.removeAttr("style");break;case"spinner":n.region.currentView!==e&&t.destroy()}i.debug||t.isDestroyed||n.show(t)})},getEntities:function(t){return r.chain(t).pick("model","collection").toArray().compact().value()},getLoadingView:function(){return new i.LoadingView},getAnalyticsLoadingView:function(){return new i.AnalyticsLoadingView},getSpinJsView:function(){return new i.SpinJsView}}),o.commands.setHandler("show:loading",function(t,e){return new i.LoadingController({view:t,region:e.region,config:e.loading})})}),Pixlee.module("Components.Loading",function(t,e){t.LoadingView=e.Views.ItemView.extend({template:"javascripts/base/backbone/lib/components/loading/templates/_loader",id:"loading_container"}),t.AnalyticsLoadingView=e.Views.ItemView.extend({template:!1,className:"loading_data"})}),function(){this.JST||(this.JST={}),this.JST["javascripts/base/backbone/lib/components/loading/templates/_loader"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="loader"></div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/base/backbone/lib/components/loading/templates/loader"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<div id=\"loader\" style='position:relative !important;left:-25px !important;'></div>\n");return __p.join("")}}.call(this),Pixlee.module("Components.Photowall",function(i,t,e,n,o,r){i.Controller=t.Controllers.Application.extend({initialize:function(t){var e=this;this.collectionView=t.view,this.photowallLayout=this.getPhotowallLayout(),this.loadMoreButton=this.getLoadMoreButton(),this.loadMoreLoadingView=this.getLoadMoreLoadingView(),this.collectionView.collection.on("sync",function(t,e){gon.sortType=e.sortType}),this.listenTo(this.photowallLayout,{show:this.onLayoutShow,"load:more:clicked":this.onLoadMoreCLick,"clear:filter":this.resetCollection});var i=r.debounce(this.onFilterSortChange,800);this.collectionView.collection.sort&&this.collectionView.collection.sort.on("change",i,this),this.collectionView.collection.filter&&this.collectionView.collection.filter.on("change",i,this);var n=function(){e.loadMoreButton.destroy(),e.loadMoreLoadingView.destroy()};this.listenTo(this.photowallLayout,"destroy",function(){this.destroy(),n()},this)},getPhotowallLayout:function(t){var e;return t=t||{},e=this.getDefaultConfig(r.result(this.contentView,"photowall")),r.extend(e,t),new i.Layout({config:e,collectionView:this.collectionView,collection:this.collectionView.collection})},getLoadMoreButton:function(){return new i.LoadMoreButton},getDefaultConfig:function(t){return t=t||{},r.defaults(t,{loadMoreFooter:!0})},getLoadMoreLoadingView:function(){return new i.LoadMoreLoadingView},onLayoutShow:function(){this.show(this.collectionView,{region:this.photowallLayout.photosRegion,loading:!0})},onLoadMoreCLick:function(){this.loadMoreLoadingView.isDestroyed&&(this.loadMoreLoadingView=this.getLoadMoreLoadingView()),this.photowallLayout.isDestroyed&&(this.photowallLayout=this.getPhotowallLayout()),this.show(this.loadMoreLoadingView,{region:this.photowallLayout.photowallFooterRegion}),this.loadCollectionNextPage()},onFilterSortChange:function(){r.isFalsy(this.photowallLayout.photowallFooterRegion)||this.photowallLayout.photowallFooterRegion.destroy(),this.resetCollection()},loadCollectionNextPage:function(){var t=this.collectionView.collection.getSelectedElements();this.collectionView.collection.nextPage(),r.each(t,function(t){t.select()})},resetCollection:function(){var t=this;this.collectionView.collection.remaining_count=undefined,this.collectionView.collection.trigger("count:change"),this.collectionView.$el.addClass("loading_content"),this.collectionView.collection.unSelectAll(),t.collectionView.collection.goTo(1,{reset:!0,success:function(){t.collectionView.$el.removeClass("loading_content"),r.isFalsy(t.collectionView.collection._currentCriteria)||t.collectionView.collection.filterBy(t.collectionView.collection._currentCriteria,!0)}})}}),t.reqres.setHandler("photowall:wrapper",function(t,e){if(e=e||{},!t.collection)throw new Error("No collection found inside of photowall's collectionView");return new i.Controller({view:t,config:e}).photowallLayout})}),Pixlee.module("Components.Photowall",function(i,t,e,n,o,r){i.Layout=t.Views.Layout.extend({template:"javascripts/base/backbone/lib/components/photowall/templates/layout",id:"photos_container",regions:{photosRegion:"#photos_region",photowallFooterRegion:"#photowall_footer_region"},triggers:{"click #load_more":"load:more:clicked"},initialize:function(t){this.collectionView=t.collectionView;var e=r.debounce(this.onRender,500);this.collectionView.on("images:loaded",e,this),this.delegateEvents()},onRender:function(){if(this.collectionView.$el.css("opacity",1),!this.isDestroyed){var t=this.getRegion("photowallFooterRegion"),e=new i.LoadMoreButton;!this.collection.next||1<this.collection.length&&this.collection.length===this.collection.remaining_count?t&&t.currentView&&!t.currentView.isDestroyed&&t.currentView.destroy():(this.collection.next||1<this.collection.length&&"horizontal"!==this.collectionView.options.type&&this.collection.length<this.collection.remaining_count)&&(e.isDestroyed&&(e=new i.LoadMoreButton),t.show(e))}}}),i.LoadMoreButton=t.Views.ItemView.extend({template:"javascripts/base/backbone/lib/components/photowall/templates/_load_more"}),i.LoadMoreLoadingView=t.Views.ItemView.extend({template:"javascripts/base/backbone/lib/components/photowall/templates/_load_more_loading"})}),function(){this.JST||(this.JST={}),this.JST["javascripts/base/backbone/lib/components/photowall/templates/_load_more"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="load_more_container">\n\t<a id="load_more" class="load_button">load more content</a>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/base/backbone/lib/components/photowall/templates/_load_more_loading"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<a id="load_more" class="load_more_spinner"></a>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/base/backbone/lib/components/photowall/templates/_no_more_photos"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="no_more_photos">No more content</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/base/backbone/lib/components/photowall/templates/_no_search_results"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="no_search_result">Sorry no content found.</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/base/backbone/lib/components/photowall/templates/_no_search_results_inbox"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="no_search_result">no content found.</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/base/backbone/lib/components/photowall/templates/layout"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="photos_region"></div>\n<div id="photowall_footer_region"></div>\n');return __p.join("")}}.call(this),Pixlee.module("Entities",function(e,t,i,n,o,r){var s;e.Config=e.Model.extend({mutators:{isAdmin:function(){return!r.isFalsy(this.get("adminSu"))}}}),s={getConfig:function(t){return t=t||{},new e.Config({distilleryUrl:gon.global.distilleryUrl,emailServerUrl:gon.global.emailServerUrl,distilleryAnalyticsUrl:gon.global.distilleryAnalyticsUrl,distilleryUrlMyAlbums:gon.global.distilleryUrlMyAlbums,distilleryUrlCountMyAlbums:gon.global.distilleryUrlCountMyAlbums,distilleryUrlAnalyticsAlbums:gon.global.distilleryUrlAnalyticsAlbums,distilleryUrlAnalyticsAccounts:gon.global.distilleryUrlAnalyticsAccounts,distilleryInboxUrl:gon.global.distilleryInboxUrl,distilleryInboxCountUrl:gon.global.distilleryInboxCountUrl,pixleePhotosServer:gon.global.pixleePhotosServer,photoAssetsUrl:gon.global.photoAssetsUrl,distilleryPhotoUrl:gon.global.distilleryPhotoUrl,distilleryPhotoCrudUrl:gon.global.distilleryPhotoCrudUrl,s3_bucket_url:gon.global.s3BucketUrl,environment:gon.global.env,adminSu:t.adminSu,adminUnsu:t.adminUnsu,pixleeAdminPanelUrl:t.pixleeAdminPanelUrl,productSimilarityUrl:gon.global.productSimilarityUrl})},getConfigPhotosApp:function(){return new e.Config({distilleryUrl:gon.global.distilleryUrl,distilleryAnalyticsUrl:gon.global.distilleryAnalyticsUrl,distilleryQueryUrl:gon.global.distilleryQueryUrl,pixlee_backend_server:gon.global.pixleeBackendServer,environment:gon.global.env,s3_bucket_url:gon.global.s3BucketUrl,distilleryPhotoUrl:gon.global.distilleryPhotoUrl})}},t.reqres.setHandler("set:config",function(t){return s.getConfig(t)}),t.reqres.setHandler("set:config:photos:app",function(){return s.getConfigPhotosApp()})}),Pixlee.module("Entities",function(e,t){var i;i={setDisplayOptions:function(t){return new e.DisplayOptions(t)}},e.DisplayOptions=e.DeepModel.extend(),t.reqres.setHandler("set:display:options",function(t){return i.setDisplayOptions(t)})}),Pixlee.module("Entities",function(e,t){var i;i={setRecipe:function(t){return new e.Recipe(t)}},e.Recipe=e.Model.extend(),t.reqres.setHandler("set:recipe",function(t){return i.setRecipe(t)})}),Pixlee.module("Entities",function(i,t,e,n,o,r){var s;s={getAlbum:function(t){var e;return(e=new i.Album({id:t})).fetch(),e},setCurrentAlbum:function(t){return new i.Album(t)}},i.Album=i.Model.extend({urlRoot:function(){return Routes.v2_albums_path()},defaults:{public_viewing:!0,campaign:!1,moderation:!0,public_contribution:!0,vote_interval:"1 day",title:"",description:"",notify_user_when_approved:!1,has_default_action_link:!1,regions:[]},validation:{title:{required:!0,minLength:1},user_id:{required:!0,pattern:"number"},public_viewing:{required:!0},campaign:{required:!0},moderation:{required:!0},public_contribution:{required:!0}},labels:{title:"Album name"},isCategory:function(){return"category"===this.get("album_type")},isProduct:function(){return"product"===this.get("album_type")},isStandard:function(){return"standard"===this.get("album_type")},isHome:function(){return"home"===this.get("album_type")},isStory:function(){return"story"===this.get("album_type")},isGlobal:function(){return r.isEmpty(this.get("regions"))},getRegionNames:function(){return this.isGlobal()?["All Regions"]:new i.Regions(this.get("regions")).pluck("name")}}),t.reqres.setHandlers({"get:album":function(t){return s.getAlbum(t)},"set:current:album":function(t){return s.setCurrentAlbum(t)}}),t.commands.setHandlers({"copy:photos:to:album":function(t,e,i){s.copyPhotosToAlbum(t,e,i)}})}),Pixlee.module("Entities",function(n,c,t,e,i,r){var o;o={getPhotoFileUrl:function(t,e){return"https://static.pixlee.com/photos/"+e.get("id")+"/"+t+"/"+c.reqres.request("encode:utf8",e.get("data_file_name"))},getPhoto:function(t){var e;return(e=new n.Photo({album_photo_id:t})).fetch({reset:!0}),e},newPhoto:function(){return new n.Photo},getCustomVideoThumbnail:function(t){var e=t.get("video_settings")||{};return!r.isEmpty(e)&&r.isTruthy(e.thumbnail_url)?e.thumbnail_url.replace("http://","https://"):null},getPhotoThumbnailUrl:function(t){var e=this.getCustomVideoThumbnail(t);return e||(r.isFalsy(t.get("data_file_name"))?t.get("medium_url")?t.get("medium_url").replace("http://","https://"):t.get("thumbnail_url")?t.get("thumbnail_url").replace("http://","https://"):t.get("source_url")?t.get("source_url").replace("http://","https://"):void 0:c.request("get:photo:file:url","medium",t))},getPhotosCollectionWidgets:function(t,e){var i;return t=t||{},i=new n.PhotosWidgets([],t),!1!==e&&i.goTo(1,{reset:!0,timeout:1e4,error:this.failCallback}),i},failCallback:function(t,e){if("notmodified"!==e.statusText&&"success"!==e.statusText){var i={name:"pixlee:close:widget",type:"action",source:"widget",destination:"parent",data:{}};top.postMessage(JSON.stringify(i),"*")}}},n.Photo=n.Model.extend({url:function(){return c.reqres.request("get:photo:url",this.get("album_photo_id"))},mutators:{pixlee_cdn_photos:{get:function(){return this.attributes.pixlee_cdn_photos},"transient":!0},products:{get:function(){return this.attributes.products},"transient":!0},taggedAtFormatted:{get:function(){return moment(parseInt(this.attributes.tagged_at,10)).format("MM-DD-YYYY")},"transient":!0},approvedOnDateFormatted:{get:function(){return moment(parseInt(this.attributes.approved_on_date,10)).format("MM-DD-YYYY")},"transient":!0},captionFormatted:{get:function(){var t;r.isFalsy(this.attributes.title)&&""!==this.attributes.title?r.isFalsy(this.attributes.album_title)?r.isFalsy(this.attributes.photo_title)||(t=this.attributes.photo_title
):t=this.attributes.album_title:t=this.attributes.title;var e=c.request("decode:utf8",t);return r.isFalsy(e)?"":e},"transient":!0},notesFormatted:{get:function(){var t;r.isFalsy(this.attributes.notes)&&""!==this.attributes.notes||(t=this.attributes.notes);var e=c.request("decode:utf8",t);return r.isFalsy(e)?"":e},"transient":!0},submitterFormatted:{get:function(){var t,e;return t=r.isFalsy(this.attributes.user_name)?r.isFalsy(this.attributes.email_address)?"":this.attributes.email_address:this.attributes.user_name,r.isFalsy(this.attributes.source)&&(e="desktop"),"instagram"!==(e=this.attributes.source)&&"twitter"!==e||(t="@"+t.replace("@","")),t},"transient":!0},emailFormatted:{get:function(){return r.isFalsy(this.attributes.email_address)||r.isFalsy(this.attributes.user_name)||this.attributes.email_address!=this.attributes.user_name?r.isFalsy(this.attributes.email_address)?"":this.attributes.email_address:""},"transient":!0},submitterHref:{get:function(){if(!r.isFalsy(this.get("platform_link")))return this.get("platform_link");if(!r.isFalsy(this.get("submitter_link")))return this.get("submitter_link");var t=this.get("user_name")||"";switch(this.get("source")){case"instagram":return"http://instagram.com/"+t;case"twitter":return"http://twitter.com/"+t;case"youtube":return"https://www.youtube.com/channel/"+this.get("connected_user_social_id");default:return"javascript: void(0)"}},"transient":!0},src:{get:function(){var t="https://static.pixlee.com";if(null!=this.get("data_file_name"))return t+"/photos/"+this.get("id")+"/original/"+c.reqres.request("encode:utf8",this.get("data_file_name"));if("image"!=this.get("content_type")&&this.get("content_type")){if("video"==this.get("content_type"))return this.get("thumbnail_url").replace("http://","https://")}else if(null!=this.get("source_url"))return this.get("source_url").replace("http://","https://");return""},"transient":!0},submitter_type:{get:function(){return r.isFalsy(this.attributes.source)?"desktop":this.attributes.source},"transient":!0},isVideo:{get:function(){return"video"==this.get("content_type")}},isStory:{get:function(){return"instagram_story"===this.get("subtype")}},posterUrl:{get:function(){return this.get("big_url")||this.get("thumbnail_url")},"transient":!0},videoURL:{get:function(){return(this.get("source_url")||"").replace("http://","https://")},"transient":!0},likeCount:{get:function(){return this.get("like_count")||0},"transient":!0},shareCount:{get:function(){return this.get("share_count")||0},"transient":!0},actionLinkFormatted:{get:function(){return r.isFalsy(this.get("action_link"))?"":c.request("decode:utf8",this.get("action_link"))},"transient":!0},actionLinkTextFormatted:{get:function(){return r.isFalsy(this.get("action_link_text"))?"":c.request("decode:utf8",this.get("action_link_text"))},"transient":!0},actionLinkTitleFormatted:{get:function(){return r.isFalsy(this.get("action_link_title"))?"":c.request("decode:utf8",this.get("action_link_title"))},"transient":!0},actionLinkPhotoFormatted:{get:function(){return r.isFalsy(this.get("action_link_photo"))?"":c.request("decode:utf8",this.get("action_link_photo"))},"transient":!0}},parse:function(t){return r.isFalsy(c.isWidget)&&r.isObject(t.data)?t.data:t},toJSONForLightbox:function(){var i=this.toJSON();return r.each(this.mutators,r.bind(function(t,e){!0===r.isObject(this.mutators[e])&&r.isFunction(this.mutators[e].get)?i[e]=r.bind(this.mutators[e].get,this)():i[e]=r.bind(this.mutators[e],this)()},this)),i}}),n.PhotosWidgets=n.PaginatedCollection.extend({model:n.Photo,server_api:{page:function(){return this.currentPage},filter_id:function(){return c.reqres.request("get:recipe").toJSON().filter_sort_id||gon.publication_id},unique_id:function(){if(c.reqres.request("get:recipe")&&c.reqres.request("get:recipe").toJSON().sort){if(c.reqres.request("get:recipe").toJSON().sort.dynamic||c.reqres.request("get:recipe").toJSON().sort.random){var t="";return r.isTruthy(gon.distinct_user_hash)?t=gon.distinct_user_hash:"undefined"!=typeof analytics&&r.isTruthy(analytics.getAnonymousId())&&(t=analytics.getAnonymousId()),(c.request("murmurhash",this.sessionId,32)+c.request("murmurhash",t,32))%25}return 0}return 0},per_page:function(){var t=6,e=9,i=9,n=18,o=24,r=30,s=parseInt(c.displayOptions.get("pageSize")),a=parseInt(c.displayOptions.get("pageSizeMobile"))||s,l=parseInt(c.displayOptions.get("pageSizeTablet"))||s,u=0===s;return c.displayOptions.get("is_interactive")&&-1!==this.paginator_core.url.indexOf("view_port")?100:c.MosaicApp?32:c.HorizontalApp||c.CoverflowApp||c.VerticalApp||c.SlideShowApp?gon.isMobile?u?t:a||t:gon.isTablet?u?e:l||e:u?i:s||i:gon.isMobile?u?n:a||n:gon.isTablet?u?o:l||o:u?r:s||r},sortType:function(){return this.sortType}},parse:function(t){return"undefined"!=typeof t.error_code&&1==t.error_code&&(window.location.href="/"),0===t.data.length&&1==this.currentPage&&(this.remaining_count=0),this.next=t.next,t.data},toJSONForLightbox:function(){var e=[];return r.each(this.models,function(t){r.isFalsy(t.get("isUploaderTile"))&&e.push(t.toJSONForLightbox())},this),e},filterBy:function(e,t){var i;!r.isFalsy(this._currentCriteria)&&r.isFalsy(t)||(this._originalModels=this.models,this._remaining_count=this.remaining_count),e?(i=[],r.each(this._originalModels,function(t){-1!=e.indexOf(t.id)&&i.push(t)}),this._currentCriteria=e,this.remaining_count=i.length):(i=this._originalModels,this.remaining_count=this._remaining_count),this.reset(i),this.trigger("collection:filtered")},interactiveWidgetFilterBy:function(e,t){var i;!r.isFalsy(this._currentCriteria)&&r.isFalsy(t)||(r.isFalsy(this._originalModels)?this._originalModels=this.models:this._originalModels=r.union(this._originalModels,this.models),this._remaining_count=this.remaining_count),e?(i=[],r.each(this._originalModels,function(t){-1!=e.indexOf(t.id)&&i.push(t)}),this._currentCriteria=e,this.remaining_count=i.length):(i=this._originalModels,this.remaining_count=this._remaining_count),r.each(i,function(t){t.set("isRendered",!1)}),this.reset(i),this.trigger("collection:filtered")},filterPhotosWithLocation:function(t,o){var e=this.models.filter(function(t){var e=t.get("latitude"),i=t.get("longitude");if(e&&i){var n=new google.maps.LatLng(e,i);if(o.contains(n))return t}});this.interactiveWidgetFilterBy(r.pluck(e,"id"),t)},resetToOriginal:function(){r.isFalsy(this._originalModels)?this._originalModels=this.models:(this.reset(this._originalModels),this.remaining_count=this._remaining_count)}}),n.PhotosWidgetsMosaic=n.PhotosWidgets.extend({}),c.reqres.setHandlers({"get:photo":function(t){return o.getPhoto(t)},"get:new:photo":function(){return o.newPhoto()},"get:photos:widget:photowall":function(t){return o.getPhotosCollectionWidgets({url:function(){return Routes.distillery_widgets_path()}},t)},"get:photos:widget:mosaic":function(){return o.getPhotosCollectionWidgets({url:function(){return Routes.distillery_widgets_path()},per_page:40})},"get:photo:tumbnail":function(t){return o.getPhotoThumbnailUrl(t)},"get:photo:file:url":function(t,e){return o.getPhotoFileUrl(t,e)}})}),Pixlee.module("Entities",function(i,t,e,n,o,r){var s;i.SlimUser=i.Model.extend({canAccess:function(t){return-1!==this.get("features").indexOf(t)},canUserAccess:function(t){return t=t.toLowerCase(),-1!==this.get("user_features").indexOf("master")||-1!==this.get("user_features").indexOf(t)}}),i.User=i.Model.extend({defaults:{account_type:1,account_name:"Starter Plan",features:["collectPhotos"],email_invoices:!1,shownTutorials:[]},urlRoot:Routes.users_path(),canAccess:function(t){return-1!=this.get("features").indexOf(t)},canUserAccess:function(t){return-1!==this.get("user_features").indexOf(t)},isAdmin:function(){return 1===this.get("account_type")},isStandard:function(){return r.contains([2,5],this.get("account_type"))},isProfessional:function(){return r.contains([3,6],this.get("account_type"))},isSocial:function(){return 8===this.get("account_type")},isCommerce:function(){return 9===this.get("account_type")},isEnterprise:function(){return r.contains([4,7,10],this.get("account_type"))},isMultinational:function(){return 12==this.get("account_type")},hasMultinationalAnalytics:function(){return this.isMultinational()||this.canAccess("mnl_preview")},hasMultinationalPublishing:function(){return this.hasMultinationalAnalytics()},hasMultinationalAlbumManagement:function(){return this.hasMultinationalAnalytics()},hasMultinationalProductManagementRestriction:function(){return this.hasMultinationalAnalytics()},hasMultinationalSocialLogin:function(){return this.hasMultinationalAnalytics()},hasProductAiTagging:function(){return this.canAccess("product_recommendation")&&this.canUserAccess("product_recommendation")},getUserMaxPhotos:function(){switch(this.get("account_type")){case 2:return 25e3;case 1:return 5e3;case 3:return 1e5;case 4:return 1e6;default:return 5e4}},setDisplayBoolean:function(t){o.ajax({url:"users/mark_boolean",data:{the_field:t},type:"post"})},haveExpiredTokens:function(){return!!(this.isFacebookExpired()||this.isInstagramExpired()||this.isTwitterExpired())},isFacebookExpired:function(){return-1!=this.get("facebook_status").message.toLowerCase().indexOf("error validating")},isInstagramExpired:function(){return-1!=this.get("instagram_status").message.toLowerCase().indexOf("invalid")||-1!=this.get("instagram_status").message.toLowerCase().indexOf("expire")},isTwitterExpired:function(){return-1!=this.get("twitter_status").message.toLowerCase().indexOf("user has been suspended")||-1!=this.get("twitter_status").message.toLowerCase().indexOf("invalid or expired token")},isStarter:function(){return 11===this.get("account_type")},isSocialConnected:function(){return!!(this.isInstagramConnected()&&this.isTwitterConnected()&&this.isFacebookConnected())},isInstagramConnected:function(){return this.get("instagram_status").is_connected},isFacebookConnected:function(){return this.get("facebook_status").is_connected},isTwitterConnected:function(){return this.get("twitter_status").is_connected},isSocialStudioConnected:function(){return this.get("connected_to_social_studio")},shouldShowTutorial:function(t){return-1==this.get("shownTutorials").indexOf(t)},mutators:{shownTutorialsArray:{get:function(){this.attributes.shownTutorials=this.attributes.shownTutorials||"";var t=this.attributes.shownTutorials.split(",");return 1==t.length&&r.isFalsy(t[0])&&(t=[]),t},"transient":!0},shownTutorials:{get:function(){return this.get("shownTutorialsArray").join(",")}}}}),i.SpamUser=i.Model.extend({url:function(){return Routes.remove_marked_as_spam_users_path(this.get("id"))}}),i.SpamUsers=i.Collection.extend({url:function(){return Routes.get_marked_as_spam_users_path()},model:i.SpamUser,parse:function(t){return t.users}}),i.AccountUsers=i.Collection.extend({url:function(){return Routes.account_users_path()},model:i.SlimUser}),s={newUser:function(t){return t=t||{},new i.User(t)},setCurrentUser:function(t){return new i.User(t)},setDisplayBoolean:function(t,e){t.setDisplayBoolean(e),t.get("shownTutorialsArray").push(e)},getMarkedAsSpamUsers:function(t){var e=new i.SpamUsers(t);return e.fetch(),e},getAccountUsers:function(t){var e=new i.AccountUsers(t);return e.fetch(),e}},t.reqres.setHandlers({"get:new:user":function(t){return s.newUser(t)},"set:current:user":function(t){return s.setCurrentUser(t)},"get:spam:users":function(t){return s.getMarkedAsSpamUsers(t)},"get:account:users":function(t){return s.getAccountUsers(t)}}),t.commands.setHandlers({"user:set:analytics:tutorial:seen":function(t){return s.setDisplayBoolean(t,"analytics_v3_tutorial")}}),t.commands.setHandlers({"user:set:tutorial:seen":function(t,e){return s.setDisplayBoolean(t,e)},"remove:spammer":function(){}})}),function(){this.JST||(this.JST={}),this.JST["javascripts/backbone/apps/common/templates/v2/_end_uploader_tile"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push(""),"mosaic_v2"===obj?__p.push('\n\t<li class="photo_block uploader_tile large fade_in" tabindex="0">\n'):__p.push('\n\t<li class="photo_block uploader_tile" tabindex="0">\n'),__p.push('\n\t<div id="end_uploader_tile_inside"></div>\n</li>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/backbone/apps/common/templates/v2/_front_header_uploader_tile"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<li id="header_tile_container" class="photo_block" >\n    <div id="header_wrapper" class="',getLayoutClass()," ",getButtonClass(),' ">\n        '),showTitle()&&__p.push('\n        <ul id="hashtag_holder"><li>',decode_utf8(getHeaderTitle()),"</li></ul>\n        "),__p.push("\n        "),showDescription()&&__p.push('\n        <div id="description_holder">',decode_utf8(getHeaderDescription()),"</div>\n        "),__p.push('\n        <button id="upload_now" aria-label="Add your photo"></button>\n        '),isViewGallery()&&__p.push('\n        <a href="',getViewGalleryUrl(),'" target="_blank" id="view_gallery" tabindex="0">',decode_utf8(getViewGalleryText()),"</a>\n        "),__p.push('\n        <p class="screen_reader_only">Clicking on these links will bring up a modal containing a larger version of the image.</p>\n    </div>\n</li>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/backbone/apps/common/templates/v2/_header"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push(""),isStandalone()&&(__p.push('\n<div id="standalone_header">\n\t<div id="header_nav">\n\t\t'),shouldShowLogoImage()&&__p.push('\n\t\t\t<a href="',getLogoRedirectURL(),'" id="brand_logo" target="_blank" style="',getLogoImage(),'"></a>\n\t\t'),__p.push('\n\t\t<div id="social_profiles_container">\n\t\t\t<a href="',getInstagramURL(),'" class="social_profile_icons" id="instagram_profile" target="_blank"></a>\n\t\t\t<a href="',getTwitterURL(),'" class="social_profile_icons" id="twitter_profile" target="_blank"></a>\n\t\t\t<a href="',getPinterestURL(),'" class="social_profile_icons" id="pinterest_profile" target="_blank"></a>\n\t\t\t<a href="',getFacebookURL(),'" class="social_profile_icons" id="facebook_profile" target="_blank"></a>\n\t\t</div>\n\t</div>\n\t'),shouldShowBannerImage()&&__p.push('\n\t\t<div id="banner_image" style="',getBannerImage(),'">\n\t\t\t<img src="',getBannerImageURL(),'">\n\t\t\t<a id="banner_image_link" href="',getBannerRedirectURL(),'" target="_blank"></a>\n\t\t</div>\n\t'),__p.push("\n</div>\n")),__p.push("\n\n\n"),isHeaderV2()?(__p.push("\n\t<!-- button classes: uploader_button, uploader_text_w_icon, uploader_text_inline -->\n\t<!-- header classes: justified, centered, side, tile, vertical_left_aligned -->\n\t"),isStandalone()||__p.push('\n\t<div id="header_banner_image">\n\t\t<img src="',getHeaderBannerImage(),'">\n\t</div>\n\t'),__p.push("\n\t"),isTile()||(__p.push('\n\t\t<div id="header_wrapper" class="',getWidgetType()," ",getLayoutClass()," ",getButtonClass(),' " style="visibility:hidden">\n\t\t\t<ul id="hashtag_holder">\n\t\t\t\t'),_.isFalsy(getHeaderTitle())?"justified"===getLayoutClass()&&"uploader_button"===getButtonClass()&&__p.push("\n\t\t\t\t\t<!-- fix button cut-off bug with the above conditions -->\n\t\t\t\t\t<li>&nbsp;</li>\n\t\t\t\t"):__p.push("\n\t\t\t\t\t<li>",decode_utf8(getHeaderTitle()),"</li>\n\t\t\t\t"),__p.push('\n\t\t\t</ul>\n\t\t\t<div id="description_holder">',decode_utf8(getHeaderDescription()),'</div>\n\t\t\t<button id="upload_now" aria-label="Add your photo">\n\t\t\t\t<span></span>\n\t\t\t</button>\n\t\t\t'),isViewGallery()&&__p.push('\n\t\t\t<a href="',getViewGalleryUrl(),'" target="_blank" id="view_gallery">\n\t\t\t\t',decode_utf8(getViewGalleryText()),"\n\t\t\t</a>\n\t\t\t"),__p.push('\n\t\t\t<p class="screen_reader_only">Clicking on these links will bring up a modal containing a larger version of the image.</p>\n\t\t</div>\n\t')),__p.push("\n")):(__p.push('\n\t<div id="common_header">\n\t\t<ul id="hashtag_holder">'),_.each(gon.collect_string,function(t){__p.push("\n\t\t\t<li>",t,"</li>\n\t\t\t")}),__p.push('</ul>\n\t\t<div id="description_holder">'),"function"==typeof isPdpCaption&&(__p.push(""),isPdpCaption()&&__p.push("",getPdpCaption(),""),__p.push("")),__p.push(""),_.isFalsy(description)||__p.push("",(""+Pixlee.request("decode:utf8",description)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"),""),__p.push('</div>\n\t\t<button id="upload_now" aria-label="Add your photo"></button>\n\t\t'),isViewGallery()&&__p.push('\n\t\t<a href="',getViewGalleryUrl(),'" target="_blank" id="view_gallery">\n\t\t\t',decode_utf8(getViewGalleryText()),"\n\t\t</a>\n\t\t"),__p.push("\n\t</div>\n")),__p.push("\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/backbone/apps/common/templates/v2/_photo_item"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<a class="img_holder" ',backgroundImage(thumbnail("medium")),' role="link" tabindex="0" aria-label="',submitterType()," ",isVideo()?"video":"photo",'">\n  <img alt="',decodeUtf8(altText()),'" src="',thumbnail("medium"),'" data-prod-image="',getReview().productImage,'" style="position: fixed; left: -100000px;"/>\n</a>\n\n'),isStory()&&__p.push('\n<div class="story"></div>\n'),__p.push("\n\n"),isVideo()&&__p.push('\n\t<a class="layer_video lightboxed" id="',album_photo_id,"\" rel='album'>\n\t    ",decodeUtf8(altText()),'\n\t\t<div class="play_button"></div>\n\t</a>\n'),__p.push("\n"),Pixlee.request("get:current:album").get("campaign")&&(__p.push('\n\t<div class="vote_button '),userVotedSet()&&__p.push(" active "),__p.push('">\n\t\t'),gon.display_options.showVoteCount&&__p.push('\n\t\t<div class="vote_count">',like_count,"</div>\n\t\t"),__p.push("\n\t</div>\n")),__p.push("\n\n"),gon.display_options.reviewOptions&&gon.display_options.reviewOptions.displayReviews&&__p.push('\n<div class="text_review_holder" data-review-id="',getReview().id,'">\n\t<div class="text_review_content">\n\t\t<div class="star_holder star_',getReview().score,'" data-score="',getReview().score,'"> ',getReview().score,' Star Rating</div>\n\t\t<div class="text_review" data-title="',getReview().title,'">\n\t\t\t',getReview().content,'\n\t\t</div>\n\t</div>\n\t<div class="reviewer_name">',getReview().user_name,"</div>\n</div>\n"),__p.push('\n\n<div class="info_holder">\n\t<svg viewBox="0 -5 240 51" preserveAspectRatio="none">\n\t\t<path d="M120,0c82.1,0,100.6,39.2,120,39.2c0,0.7,0,3.6,0,6.7c-23.6,0-194.8,0-240,0\n      c0-2.7,0-4.1,0-6.7C14,39.2,37.9,0,120,0z"/>\n\t</svg>\n\t<div class="social_holder" style="bottom: 0px;">\n\t\t<div class="pixlee_fshare social_button" role="button" aria-label="Share on Facebook" tabindex="0"></div>\n\t\t<div class="pixlee_tweet social_button" role="button" aria-label="Share on Twitter" tabindex="0"></div>\n\t\t<div class="pixlee_pinit social_button" role="button" aria-label="Share on Pinterest" tabindex="0"></div>\n\t\t<div class="pixlee_tumblr social_button" role="button" aria-label="Share on Tumblr" tabindex="0"></div>\n    </div>\n\t<div class="info_content">\n\t\t<div class="users_handle">',submitterAnchor(!0),"</div>\n        ",uploaderAdditionalFields(),'\n\t\t<div class="like_count">',native_likes,'</div>\n\t\t<div class="users_caption">'),""!=getTitle()&&__p.push("",(""+decodeUtf8(getTitle())).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")," "),__p.push('</div>\n\t\t<div class="users_date">',getDate(),"</div>\n\t</div>\n\t"),gon.display_options.showWidgetUserAvatar&&__p.push('\n\t<div class="user_avatar" style="background-image:url(',avatar_url,')"></div>\n\t'),__p.push('\n</div>\n<div class="content_source ',submitterType(),'"></div>\n'),_.isFalsy(gon.display_options.customCallToActionLink)||__p.push('\n<a href="',decodeURIComponent(gon.display_options.customCallToActionLink),'" target="_top" class="custom_call_to_action_anchor" style="font-size:0px">call to action link</a>\n'),__p.push("\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/backbone/apps/common/templates/v2/_tap2shop_photo_item"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push(""),!_.isFalsy(gon.display_options.customCallToActionLink)&&gon.isMobile?__p.push('\n<a href="',decodeURIComponent(gon.display_options.customCallToActionLink),'" target="',ctaTarget(),'" class="custom_call_to_action_anchor">\n'):__p.push('\n<a target="',ctaTarget(),'" class="custom_call_to_action_anchor">\n'),__p.push('\n\t<div class="img_holder" style="background-image:url(',thumbnail(tap2shop_thumbnail_size),')"><img alt="',decodeUtf8(altText()),'" style="display:none" data-prod-image="',getReview().productImage,'"/></div>\n\t'),isStory()&&__p.push('\n\t<div class="story"></div>\n\t'),__p.push("\n\t"),isVideo()&&__p.push('\n\t\t<a class="layer_video lightboxed" id="',album_photo_id,'" rel=\'album\'>\n\t\t\t<div class="play_button"></div>\n\t\t</a>\n\t'),__p.push("\n\t"),gon.display_options.reviewOptions&&gon.display_options.reviewOptions.displayReviews&&__p.push('\n\t<div class="text_review_holder" data-review-id="',getReview().id,'">\n\t\t<div class="text_review_content">\n\t\t\t<div class="star_holder star_',getReview().score,'"> ',getReview().score,' Star Rating</div>\n\t\t\t<div class="text_review">\n\t\t\t\t',getReview().content,' \n\t\t\t</div>\n\t\t</div>\n\t\t<div class="reviewer_name">',getReview().user_name,"</div>\n\t</div>\n\t"),__p.push("\n</a>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/backbone/apps/common/templates/v2/_uploader_tile"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="header_wrapper" >\n\t'),showTitle()&&__p.push('\n\t\t<div id="hashtag_holder">',getHeaderTitle(),"</div>\n\t"),__p.push("\n\t"),showDescription()&&__p.push('\n\t\t<div id="description_holder">',getHeaderDescription(),"</div>\n\t"),__p.push('\n\t\t<button id="upload_now" aria-label="Upload Now">\n\t\t\t<span></span>\n\t\t</button>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["javascripts/backbone/apps/common/templates/v2/_xl_photo_item"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<a class="img_holder" ',backgroundImage(thumbnail("xl")),' role="link" tabindex="0" aria-label="',submitterType()," ",isVideo()?"video":"photo",'">\n   <img alt="',decodeUtf8(altText()),'" src="',thumbnail("xl"),'" data-prod-image="',getReview().productImage,'" style="position: fixed; left: -100000px;"/>\n</a>\n\n'),isStory()&&__p.push('\n<div class="story"></div>\n'),__p.push("\n\n"),isVideo()&&__p.push('\n    <a class="layer_video lightboxed" id="',album_photo_id,"\" rel='album'>\n        ",decodeUtf8(altText()),'\n        <div class="play_button"></div>\n    </a>\n'),__p.push("\n"),Pixlee.request("get:current:album").get("campaign")&&(__p.push('\n    <div class="vote_button '),userVotedSet()&&__p.push(" active "),__p.push('">\n        '),gon.display_options.showVoteCount&&__p.push('\n        <div class="vote_count">',like_count,"</div>\n        "),__p.push("\n    </div>\n")),__p.push("\n\n"),gon.display_options.reviewOptions&&gon.display_options.reviewOptions.displayReviews&&__p.push('\n<div class="text_review_holder" data-review-id="',getReview().id,'">\n    <div class="product_name">',decodeUtf8(getReview().productName),'</div>\n    <div class="text_review_content">\n        <div class="star_holder star_',getReview().score,'" data-score="',getReview().score,'"> ',getReview().score,' Star Rating</div>\n        <div class="text_review" data-title="',getReview().title,'">\n            ',getReview().content,'\n        </div>\n    </div>\n    <div class="reviewer_name">',getReview().user_name,"</div>\n</div>\n"),__p.push('\n\n<div class="info_holder">\n    <svg viewBox="0 -5 240 51" preserveAspectRatio="none">\n        <path d="M120,0c82.1,0,100.6,39.2,120,39.2c0,0.7,0,3.6,0,6.7c-23.6,0-194.8,0-240,0\n      c0-2.7,0-4.1,0-6.7C14,39.2,37.9,0,120,0z"/>\n    </svg>\n    <div class="social_holder" style="bottom: 0px;">\n        <div class="pixlee_fshare social_button" role="button" aria-label="Share on Facebook" tabindex="0"></div>\n        <div class="pixlee_tweet social_button" role="button" aria-label="Share on Tweet" tabindex="0"></div>\n        <div class="pixlee_pinit social_button" role="button" aria-label="Share on Pinterest" tabindex="0"></div>\n        <div class="pixlee_tumblr social_button" role="button" aria-label="Share on Tumblr" tabindex="0"></div>\n    </div>\n    <div class="info_content">\n        <div class="users_handle">',submitterAnchor(!0),"</div>\n        ",uploaderAdditionalFields(),'\n        <div class="like_count">',native_likes,'</div>\n        <div class="users_caption">'),""!=getTitle()&&__p.push("",(""+decodeUtf8(getTitle())).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")," "),__p.push('</div>\n        <div class="users_date">',getDate(),"</div>\n    </div>\n    "),gon.display_options.showWidgetUserAvatar&&__p.push('\n    <div class="user_avatar" style="background-image:url(',avatar_url,')"></div>\n    '),__p.push('\n</div>\n<div class="content_source ',submitterType(),'"></div>\n'),_.isFalsy(gon.display_options.customCallToActionLink)||__p.push('\n<a href="',decodeURIComponent(gon.display_options.customCallToActionLink),'" target="_top" class="custom_call_to_action_anchor" style="font-size:0px">call to action link</a>\n'),__p.push("\n");return __p.join("")}}.call(this),function(Ot,t,Tt){"use strict";function Pt(l,t,e){function s(t){var e=0,i=et.length;if(t=t||{},J.old=Ot.extend({},J),Y=z?0:N[j.horizontal?"width":"height"](),K=$[j.horizontal?"width":"height"](),W=z?l:H[j.horizontal?"outerWidth":"outerHeight"](),et.length=0,J.start=0,J.end=Math.max(W-Y,0),lt){e=nt.length,it=H.children(j.itemSelector),nt.length=0;var u,c=Lt(H,j.horizontal?"paddingLeft":"paddingTop"),d=Lt(H,j.horizontal?"paddingRight":"paddingBottom"),n="border-box"===Ot(it).css("boxSizing"),h="none"!==it.css("float"),p=0,f=it.length-1;if(W=0,it.each(function(t,e){var i=Ot(e),n=i[j.horizontal?"outerWidth":"outerHeight"](),o=Lt(i,j.horizontal?"marginLeft":"marginTop"),r=Lt(i,j.horizontal?"marginRight":"marginBottom"),s=n+o+r,a=!o||!r,l={};l.el=e,l.size=a?n:s,l.half=l.size/2,l.start=W+(a?o:0),l.center=l.start-Math.round(Y/2-l.size/2),l.end=l.start-Y+l.size,t||(W+=c),W+=s,j.horizontal||h||r&&o&&0<t&&(W-=Math.min(o,r)),t===f&&(l.end+=d,W+=d,p=a?r:0),nt.push(l),u=l}),Qt)try{H[0].style[j.horizontal?"width":"height"]=(n?W:W-c-d)+10+"px"}catch(a){window.console.log("sly not supported in IE9")}else H[0].style[j.horizontal?"width":"height"]=(n?W:W-c-d)+10+"px";W-=p,nt.length?(J.start=nt[0][st?"center":"start"],J.end=st?u.center:Y<W?u.end:J.start):J.start=J.end=0}if(J.center=Math.round(J.end/2+J.start/2),v(),G.length&&0<K&&(j.dynamicHandle?(Q=Vt(Q=J.start===J.end?K:Math.round(K*Y/W),j.minHandleSize,K),G[0].style[j.horizontal?"width":"height"]=Q+"px"):Q=G[j.horizontal?"outerWidth":"outerHeight"](),Z.end=K-Q,kt||_()),!z&&0<Y){var o=J.start,r="";if(lt)Ot.each(nt,function(t,e){st?et.push(e.center):e.start+e.size>o&&o<=J.end&&(o=e.start,et.push(o),(o+=Y)>J.end&&o<J.end+Y&&et.push(J.end))});else for(;o-Y<J.end;)et.push(o),o+=Y;if(X[0]&&i!==et.length){for(var s=0;s<et.length;s++)r+=j.pageBuilder.call(B,s);(tt=X.html(r).children()).eq(ot.activePage).addClass(j.activeClass)}}ot.slideeSize=W,ot.frameSize=Y,ot.sbSize=K,ot.handleSize=Q,lt?(B.initialized?(ot.activeItem>=nt.length||0===e&&0<nt.length)&&m(ot.activeItem>=nt.length?nt.length-1:0,!e):(m(j.startAt),B[at?"toCenter":"toStart"](j.startAt)),t.silentScroll||(at&&nt.length?-1!=ot.activeItem?g(nt[ot.activeItem].center):g(nt[Math.floor(nt.length/2)].center):g(Vt(J.dest,J.start,J.end)))):B.initialized?g(Vt(J.dest,J.start,J.end)):g(j.startAt,1),V("load")}function g(t,e,i){var n=d(t);if(lt&&bt.released&&!i){var o=t>J.start&&t<J.end;at?(o&&nt[n.centerItem].center>=t&&(t=nt[n.centerItem].center),st&&j.activateMiddle&&m(n.centerItem)):o&&(t=nt[n.firstItem].start)}if(bt.init&&bt.slidee&&j.elasticBounds?t>J.end?t=J.end+(t-J.end)/6:t<J.start&&(t=J.start+(t-J.start)/6):t=Vt(t,J.start,J.end),nt.length){var r=nt.length*nt[0].size+60,s=nt.length%2==0,a=!!(gon&&gon.display_options&&gon.display_options.headerOptions)&&gon.display_options.headerOptions.end_tile_upload_button_background_showHide;if(B.firstLoad&&"horizontal"===gon.type&&r<B.frame.offsetWidth&&s&&!a){var l=nt[0].size/2;t=nt[n.centerItem].center+l}}yt.start=+new Date,yt.time=0,yt.from=J.cur,yt.to=t,yt.delta=t-J.cur,yt.tweesing=bt.tweese||bt.init&&!bt.slidee,yt.immediate=!yt.tweesing&&(e||bt.init&&bt.slidee||!j.speed),bt.tweese=0,t!==J.dest&&(J.dest=t,V("change"),kt||u()),y(),v(),h(),c()}function u(){if(!kt)return kt=zt(u),void(bt.released&&V("moveStart"));if(yt.immediate?J.cur=yt.to:yt.tweesing?(yt.tweeseDelta=yt.to-J.cur,Math.abs(yt.tweeseDelta)<.1?J.cur=yt.to:J.cur+=yt.tweeseDelta*(bt.released?j.swingSpeed:j.syncSpeed)):(yt.time=Math.min(+new Date-yt.start,j.speed),J.cur=yt.from+yt.delta*jQuery.easing[j.easing](yt.time/j.speed,yt.time,0,1,j.speed)),yt.to===J.cur?(J.cur=yt.to,bt.tweese=kt=0):kt=zt(u),V("move"),!z)try{Dt?H[0].style[Dt]=Ut+(j.horizontal?"translateX":"translateY")+"("+-J.cur+"px)":H[0].style[j.horizontal?"left":"top"]=-Math.round(J.cur)+"px"}catch(i){}!kt&&bt.released&&V("moveEnd"),_();var t=Ot(".clearfix"),e=t.parent().width()-t.width();0<e&&n(t,e)}function n(t,e){var i=t.position().left,n=Ot(j.prevPage),o=Ot(j.nextPage),r=Ot(j.forward),s=Ot(j.backward);i<0?n.add(s).removeClass(j.disabledClass).addClass(j.activeClass):e<i?o.add(r).removeClass(j.disabledClass).addClass(j.activeClass):(o.add(r).addClass(j.disabledClass),n.add(s).addClass(j.disabledClass))}function _(){G.length&&(Z.cur=J.start===J.end?0:((bt.init&&!bt.slidee?J.dest:J.cur)-J.start)/(J.end-J.start)*Z.end,Z.cur=Vt(Math.round(Z.cur),Z.start,Z.end),vt.hPos!==Z.cur&&(vt.hPos=Z.cur,Dt?G[0].style[Dt]=Ut+(j.horizontal?"translateX":"translateY")+"("+Z.cur+"px)":G[0].style[j.horizontal?"left":"top"]=Z.cur+"px"))}function c(){tt[0]&&vt.page!==ot.activePage&&(vt.page=ot.activePage,tt.removeClass(j.activeClass).eq(ot.activePage).addClass(j.activeClass),V("activePage",vt.page))}function i(){wt.speed&&J.cur!==(0<wt.speed?J.end:J.start)||B.stop(),Mt=bt.init?zt(i):0,wt.now=+new Date,wt.pos=J.cur+(wt.now-wt.lastTime)/1e3*wt.speed,g(bt.init?wt.pos:Math.round(wt.pos)),bt.init||J.cur!==J.dest||V("moveEnd"),wt.lastTime=wt.now}function o(t,e,i){if("boolean"===It(e)&&(i=e,e=Tt),e===Tt)g(J[t],i);else{if(at&&"center"!==t)return;var n=B.getPos(e);n&&g(n[t],i,!at)}}function r(t){return null!=t?Rt(t)?0<=t&&t<nt.length?t:-1:it.index(t):-1}function a(t){return r(Rt(t)&&t<0?t+nt.length:t)}function m(t,e){var i=r(t);return!(!lt||i<0)&&((vt.active!==i||e)&&(it.eq(ot.activeItem).removeClass(j.activeClass),it.eq(i).addClass(j.activeClass),vt.active=ot.activeItem=i,h(),V("active",i)),i)}function d(t){t=Vt(Rt(t)?t:J.dest,J.start,J.end);var e={},i=st?0:Y/2;if(!z)for(var n=0,o=et.length;n<o;n++){if(t>=J.end||n===et.length-1){e.activePage=et.length-1;break}if(t<=et[n]+i){e.activePage=n;break}}if(lt){for(var r=!1,s=!1,a=!1,l=0,u=nt.length;l<u;l++)if(!1===r&&t<=nt[l].start+nt[l].half&&(r=l),!1===a&&t<=nt[l].center+nt[l].half&&(a=l),l===u-1||t<=nt[l].end+nt[l].half){s=l;break}e.firstItem=Rt(r)?r:0,e.centerItem=Rt(a)?a:e.firstItem,e.lastItem=Rt(s)?s:e.centerItem}return e}function v(t){Ot.extend(ot,d(t))}function h(){var t=!1,e=0;gon&&gon.display_options&&(t=ot.lastItem!==+gon.display_options.pageSize-1,gon.display_options.headerOptions&&gon.display_options.headerOptions.layout&&(e=0<=gon.display_options.headerOptions.layout.indexOf("side")?1:0));var i=J.dest<=J.start,n=J.dest>=J.end&&t,o=i?1:n?2:3,r=Ot(".photo_block:visible");if((r.length+e)*r.width()<ot.frameSize)return gt.add(ht).addClass(j.disabledClass),void _t.add(dt).addClass(j.disabledClass);if(vt.slideePosState!==o&&(gt.is("button,input")&&gt.prop("disabled",i),_t.is("button,input")&&_t.prop("disabled",n),gt.add(ht)[i?"addClass":"removeClass"](j.disabledClass),_t.add(dt)[n&&"undefined"!=typeof vt.slideePosState?"addClass":"removeClass"](j.disabledClass),vt.slideePosState=o),vt.fwdbwdState!==o&&bt.released&&(vt.fwdbwdState=o,ht.is("button,input")&&ht.prop("disabled",i),dt.is("button,input")&&dt.prop("disabled",n)),lt){var s=0===ot.activeItem,a=ot.activeItem>=nt.length-1,l=s?1:a?2:3;vt.itemsButtonState!==l&&(vt.itemsButtonState=l,pt.is(
"button,input")&&pt.prop("disabled",s),ft.is("button,input")&&ft.prop("disabled",a),pt[s?"addClass":"removeClass"](j.disabledClass),ft[a&&"undefined"!=typeof vt.slideePosState?"addClass":"removeClass"](j.disabledClass))}}function p(t,e,i){if(t=a(t),e=a(e),-1<t&&-1<e&&t!==e&&(!i||e!==t-1)&&(i||e!==t+1)){it.eq(t)[i?"insertAfter":"insertBefore"](nt[e].el);var n=t<e?t:i?e:e-1,o=e<t?t:i?e+1:e,r=e<t;t===ot.activeItem?vt.active=ot.activeItem=i?r?e+1:e:r?e:e-1:ot.activeItem>n&&ot.activeItem<o&&(vt.active=ot.activeItem+=r?1:-1),s()}}function f(t,e){for(var i=0,n=mt[t].length;i<n;i++)if(mt[t][i]===e)return i;return-1}function y(){bt.released&&!B.isPaused&&B.resume()}function w(t){return Math.round(Vt(t,Z.start,Z.end)/Z.end*(J.end-J.start))+J.start}function b(){bt.history[0]=bt.history[1],bt.history[1]=bt.history[2],bt.history[2]=bt.history[3],bt.history[3]=bt.delta}function x(t){bt.released=0,bt.source=t,bt.slidee="slidee"===t}function k(t){if(!bt.init&&!M(t.target)){var e="touchstart"===t.type,i=t.data.source,n="slidee"===i;("handle"!==i||j.dragHandle&&Z.start!==Z.end)&&(n&&!(e?j.touchDragging:j.mouseDragging&&t.which<2)||(e||At(t,1),x(i),bt.init=1,bt.$source=Ot(t.target),bt.touch=e,bt.pointer=e?t.originalEvent.touches[0]:t,bt.initX=bt.pointer.pageX,bt.initY=bt.pointer.pageY,bt.initPos=n?J.cur:Z.cur,bt.start=+new Date,bt.time=0,bt.path=0,bt.delta=0,bt.locked=0,bt.history=[0,0,0,0],bt.pathToLock=n?e?30:10:0,bt.initLoc=bt[j.horizontal?"initX":"initY"],bt.deltaMin=n?-bt.initLoc:-Z.cur,bt.deltaMax=n?document[j.horizontal?"width":"height"]-bt.initLoc:Z.end-Z.cur,Nt.on(e?Wt:Yt,C),B.pause(1),(n?H:G).addClass(j.draggedClass),V("moveStart"),n&&(Ct=setInterval(b,10))))}}function C(t){bt.released="mouseup"===t.type||"touchend"===t.type,bt.pointer=bt.touch?t.originalEvent[bt.released?"changedTouches":"touches"][0]:t,bt.pathX=bt.pointer.pageX-bt.initX,bt.pathY=bt.pointer.pageY-bt.initY,bt.path=Math.sqrt(Math.pow(bt.pathX,2)+Math.pow(bt.pathY,2)),bt.delta=Vt(j.horizontal?bt.pathX:bt.pathY,bt.deltaMin,bt.deltaMax),!bt.locked&&bt.path>bt.pathToLock&&(bt.locked=1,(j.horizontal?Math.abs(bt.pathX)<Math.abs(bt.pathY):Math.abs(bt.pathX)>Math.abs(bt.pathY))?bt.released=1:bt.slidee&&bt.$source.on(Jt,Et)),bt.released?(bt.touch||At(t),S(),j.releaseSwing&&bt.slidee&&(bt.swing=(bt.delta-bt.history[0])/40*300,bt.delta+=bt.swing,bt.tweese=10<Math.abs(bt.swing))):!bt.locked&&bt.touch||At(t),g(bt.slidee?Math.round(bt.initPos-bt.delta):w(bt.initPos+bt.delta))}function S(){clearInterval(Ct),Nt.off(bt.touch?Wt:Yt,C),(bt.slidee?H:G).removeClass(j.draggedClass),setTimeout(function(){bt.$source.off(Jt,Et)}),B.resume(1),J.cur===J.dest&&bt.init&&V("moveEnd"),bt.init=0}function M(t){return~Ot.inArray(t.nodeName,Gt)||Ot(t).is(j.interactive)}function O(){B.stop(),Nt.off("mouseup",O)}function T(t){switch(At(t),this){case dt[0]:case ht[0]:B.moveBy(dt.is(this)?j.moveBy:-j.moveBy),Nt.on("mouseup",O);break;case pt[0]:B.prev();break;case ft[0]:B.next();break;case gt[0]:B.prevPage();break;case _t[0]:B.nextPage()}}function P(t){return xt.curDelta=t.wheelDelta?-t.wheelDelta/120:(t.detail||t.deltaY)/3,lt?(qt=+new Date,xt.last<qt-xt.resetTime&&(xt.delta=0),xt.last=qt,xt.delta+=xt.curDelta,Math.abs(xt.delta)<1?xt.finalDelta=0:(xt.finalDelta=Math.round(xt.delta/1),xt.delta%=1),xt.finalDelta):xt.curDelta}function I(t){j.scrollBy&&J.start!==J.end&&(At(t,1),B.slideBy(j.scrollBy*P(t.originalEvent)))}function A(t){j.clickBar&&t.target===$[0]&&(At(t),g(w((j.horizontal?t.pageX-$.offset().left:t.pageY-$.offset().top)-Q/2)))}function E(t){if(j.keyboardNavBy)switch(t.which){case j.horizontal?37:38:At(t),B["pages"===j.keyboardNavBy?"prevPage":"prev"]();break;case j.horizontal?39:40:At(t),B["pages"===j.keyboardNavBy?"nextPage":"next"]()}}function F(t){M(this)?t.stopPropagation():this.parentNode===H[0]&&B.activate(this)}function R(){this.parentNode===X[0]&&B.activatePage(tt.index(this))}function L(t){j.pauseOnHover&&B["mouseenter"===t.type?"pause":"resume"](2)}function V(t,e){if(mt[t]){for(q=mt[t].length,Kt.length=0,U=0;U<q;U++)Kt.push(mt[t][U]);for(U=0;U<q;U++)Kt[U].call(B,t,e)}}function D(t){try{"pixlee:resize:widget"===JSON.parse(t.data).name&&B.reload()}catch(e){return}}var U,q,j=Ot.extend({},Pt.defaults,t),B=this,z=Rt(l),N=Ot(l),H=N.children().eq(0),Y=0,W=0,J={start:0,center:0,end:0,cur:0,dest:0},$=Ot(j.scrollBar).eq(0),G=$.children().eq(0),K=0,Q=0,Z={start:0,end:0,cur:0},X=Ot(j.pagesBar),tt=0,et=[],it=0,nt=[],ot={firstItem:0,lastItem:0,centerItem:0,activeItem:-1,activePage:0},rt="basic"===j.itemNav,st="forceCentered"===j.itemNav,at="centered"===j.itemNav||st,lt=!z&&(rt||at||st),ut=j.scrollSource?Ot(j.scrollSource):N,ct=j.dragSource?Ot(j.dragSource):N,dt=Ot(j.forward),ht=Ot(j.backward),pt=Ot(j.prev),ft=Ot(j.next),gt=Ot(j.prevPage),_t=Ot(j.nextPage),mt={},vt={},yt={},wt={},bt={released:1},xt={last:0,delta:0,resetTime:200},kt=0,Ct=0,St=0,Mt=0;z||(l=N[0]),B.initialized=0,B.frame=l,B.slidee=H[0],B.pos=J,B.rel=ot,B.items=nt,B.pages=et,B.isPaused=0,B.options=j,B.dragging=bt,B.firstLoad=!0,B.reload=s,B.getPos=function(t){if(lt){var e=r(t);return-1!==e&&nt[e]}var i=H.find(t).eq(0);if(i[0]){var n=j.horizontal?i.offset().left-H.offset().left:i.offset().top-H.offset().top,o=i[j.horizontal?"outerWidth":"outerHeight"]();return{start:n,center:n-Y/2+o/2,end:n-Y+o,size:o}}return!1},B.moveBy=function(t){wt.speed=t,!bt.init&&wt.speed&&J.cur!==(0<wt.speed?J.end:J.start)&&(wt.lastTime=+new Date,wt.startPos=J.cur,x("button"),bt.init=1,V("moveStart"),Bt(Mt),i())},B.stop=function(){"button"===bt.source&&(bt.init=0,bt.released=1)},B.prev=function(){B.activate(ot.activeItem-1)},B.next=function(){B.activate(ot.activeItem+1)},B.prevPage=function(){B.firstLoad=!1,B.activatePage(ot.activePage-1)},B.nextPage=function(){B.firstLoad=!1,B.activatePage(ot.activePage+1)},B.slideBy=function(t,e){t&&(lt?B[at?"toCenter":"toStart"](Vt((at?ot.centerItem:ot.firstItem)+j.scrollBy*t,0,nt.length)):g(J.dest+t,e))},B.slideTo=function(t,e){g(t,e)},B.toStart=function(t,e){o("start",t,e)},B.toEnd=function(t,e){o("end",t,e)},B.toCenter=function(t,e){o("center",t,e)},B.getIndex=r,B.activate=function(t,e){var i=m(t);j.smart&&!1!==i&&(at?B.toCenter(i,e):i>=ot.lastItem?B.toStart(i,e):i<=ot.firstItem?B.toEnd(i,e):y())},B.activatePage=function(t,e){Rt(t)&&g(et[Vt(t,0,et.length-1)],e)},B.resume=function(t){!j.cycleBy||!j.cycleInterval||"items"===j.cycleBy&&!nt[0]||t<B.isPaused||(B.isPaused=0,St?St=clearTimeout(St):V("resume"),St=setTimeout(function(){switch(V("cycle"),j.cycleBy){case"items":B.activate(ot.activeItem>=nt.length-1?0:ot.activeItem+1);break;case"pages":B.activatePage(ot.activePage>=et.length-1?0:ot.activePage+1)}},j.cycleInterval))},B.pause=function(t){t<B.isPaused||(B.isPaused=t||100,St&&(St=clearTimeout(St),V("pause")))},B.toggle=function(){B[St?"pause":"resume"]()},B.set=function(t,e){Ot.isPlainObject(t)?Ot.extend(j,t):j.hasOwnProperty(t)&&(j[t]=e)},B.add=function(t,e,i){var n=Ot(t);i=i||{silent:!1},lt?(null!=e&&nt[0]?nt.length&&n.insertBefore(nt[e].el):n.appendTo(H),e<=ot.activeItem&&!i.silent&&(vt.active=ot.activeItem+=n.length)):H.append(n),i.silent||s()},B.remove=function(t){if(lt){var e=a(t);if(-1<e){it.eq(e).remove();var i=e===ot.activeItem;e<ot.activeItem&&(vt.active=--ot.activeItem),s(),i&&(vt.active=null,B.activate(ot.activeItem))}}else Ot(t).remove(),s()},B.moveAfter=function(t,e){p(t,e,1)},B.moveBefore=function(t,e){p(t,e)},B.on=function(t,e){if("object"===It(t))for(var i in t)t.hasOwnProperty(i)&&B.on(i,t[i]);else if("function"===It(e))for(var n=t.split(" "),o=0,r=n.length;o<r;o++)mt[n[o]]=mt[n[o]]||[],-1===f(n[o],e)&&mt[n[o]].push(e);else if("array"===It(e))for(var s=0,a=e.length;s<a;s++)B.on(t,e[s])},B.one=function(t,e){function i(){e.apply(B,arguments),B.off(t,i)}B.on(t,i)},B.off=function(t,e){if(e instanceof Array)for(var i=0,n=e.length;i<n;i++)B.off(t,e[i]);else for(var o=t.split(" "),r=0,s=o.length;r<s;r++)if(mt[o[r]]=mt[o[r]]||[],null==e)mt[o[r]].length=0;else{var a=f(o[r],e);-1!==a&&mt[o[r]].splice(a,1)}},B.destroy=function(){return Nt.add(ut).add(G).add($).add(X).add(dt).add(ht).add(pt).add(ft).add(gt).add(_t).unbind("."+jt),pt.add(ft).add(gt).add(_t).removeClass(j.disabledClass),it&&it.eq(ot.activeItem).removeClass(j.activeClass),X.empty(),z||(N.unbind("."+jt),H.add(G).css(Dt||(j.horizontal?"left":"top"),Dt?"none":0),Ot.removeData(l,jt)),nt.length=et.length=0,vt={},B.initialized=0,B},B.init=function(){if(!B.initialized){B.on(e);var t=G;return z||(t=t.add(H),N.css("overflow","hidden"),Dt||"static"!==N.css("position")||N.css("position","relative")),Dt?Ut&&t.css(Dt,Ut):("static"===$.css("position")&&$.css("position","relative"),t.css({position:"absolute"})),j.forward&&dt.on($t,T),j.backward&&ht.on($t,T),j.prev&&pt.on(Jt,T),j.next&&ft.on(Jt,T),j.prevPage&&gt.on(Jt,T),j.nextPage&&_t.on(Jt,T),ut.on("DOMMouseScroll."+jt+" mousewheel."+jt,I),$[0]&&$.on(Jt,A),lt&&j.activateOn&&N.on(j.activateOn+"."+jt,"*",F),X[0]&&j.activatePageOn&&X.on(j.activatePageOn+"."+jt,"*",R),ct.on(Ht,{source:"slidee"},k),G&&G.on(Ht,{source:"handle"},k),Nt.bind("keydown."+jt,E),z||(N.on("mouseenter."+jt+" mouseleave."+jt,L),N.on("scroll."+jt,Ft)),s(),j.cycleBy&&!z&&B[j.startPaused?"pause":"resume"](),B.initialized=1,B}},window.addEventListener("message",D,!1)}function It(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function At(t,e){t.preventDefault(),e&&t.stopPropagation()}function Et(t){At(t,1),Ot(this).off(t.type,Et)}function Ft(){this.scrollLeft=0,this.scrollTop=0}function Rt(t){return!isNaN(parseFloat(t))&&isFinite(t)}function Lt(t,e){return 0|Math.round(String(t.css(e)).replace(/[^\-0-9.]/g,""))}function Vt(t,e,i){return t<e?e:i<t?i:t}var Dt,Ut,qt,e="sly",i="Sly",jt=e,Bt=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,zt=t.requestAnimationFrame,Nt=Ot(document),Ht="touchstart."+jt+" mousedown."+jt,Yt="mousemove."+jt+" mouseup."+jt,Wt="touchmove."+jt+" touchend."+jt,Jt="click."+jt,$t="mousedown."+jt,Gt=["INPUT","SELECT","BUTTON","TEXTAREA"],Kt=[],Qt=function(){return(/MSIE\s/.test(navigator.userAgent)&&parseFloat(navigator.appVersion.split("MSIE")[1]))<11};!function(n){for(var t=["moz","webkit","o"],o=0,e=0,i=t.length;e<i&&!Bt;++e)Bt=n[t[e]+"CancelAnimationFrame"]||n[t[e]+"CancelRequestAnimationFrame"],zt=Bt&&n[t[e]+"RequestAnimationFrame"];Bt||(zt=function(t){var e=+new Date,i=Math.max(0,16-(e-o));return o=e+i,n.setTimeout(function(){t(e+i)},i)},Bt=function(t){clearTimeout(t)})}(window),function(){function t(t){for(var e=0,i=o.length;e<i;e++){var n=o[e]?o[e]+t.charAt(0).toUpperCase()+t.slice(1):t;if(null!=r.style[n])return n}}var o=["","webkit","moz","ms","o"],r=document.createElement("div");Dt=t("transform"),Ut=t("perspective")?"translateZ(0) ":""}(),t[i]=Pt,Ot.fn[e]=function(n,o){var r,s;return Ot.isPlainObject(n)||("string"!==It(n)&&!1!==n||(r=!1===n?"destroy":n,s=Array.prototype.slice.call(arguments,1)),n={}),this.each(function(t,e){var i=Ot.data(e,jt);i||r?i&&r&&i[r]&&i[r].apply(i,s):i=Ot.data(e,jt,new Pt(e,n,o).init())})},Pt.defaults={horizontal:0,itemNav:null,itemSelector:null,smart:0,activateOn:null,activateMiddle:0,scrollSource:null,scrollBy:0,dragSource:null,mouseDragging:0,touchDragging:0,releaseSwing:0,swingSpeed:.2,elasticBounds:0,interactive:null,scrollBar:null,dragHandle:0,dynamicHandle:0,minHandleSize:50,clickBar:0,syncSpeed:.5,pagesBar:null,activatePageOn:null,pageBuilder:function(t){return"<li>"+(t+1)+"</li>"},forward:null,backward:null,prev:null,next:null,prevPage:null,nextPage:null,cycleBy:null,cycleInterval:5e3,pauseOnHover:0,startPaused:0,moveBy:300,speed:0,easing:"swing",startAt:0,keyboardNavBy:null,draggedClass:"dragged",activeClass:"active",disabledClass:"disabled"}}(jQuery,window),Pixlee.module("HorizontalApp",function(e){e.on("start",function(t){new e.Show.Controller(t)})}),Pixlee.module("HorizontalApp.Show",function(e,u,t,i,n,c){e.Controller=u.Controllers.Application.extend({initialize:function(r){var s,i,n,a=this,l=this.getLayout();(this.listenTo(l,"show",function(){var o=u.request("get:photos:widget:photowall");if(s=this.getCollectionView({collection:o,displayOptions:r.display_options}),(l.collection=o).on("sync",function(t,e){if(a.widgetloaded)return!1;a.widgetloaded=!0,gon.sortType=e.sortType;var i=r.display_options.headerOptions.end_tile_upload_button_background_showHide;if(s.sly||i){var n=s.sly?s.sly.rel:{};u.commands.execute("opened:horizontal",n,o)}}),i=this.getHeaderView({model:u.request("get:current:album")}),this.show(s,{region:l.frame}),this.show(i,{region:l.widget_header_region}),!c.isFalsy(r.display_options.is_interactive)){var t=this.getNavbarView(r,o);this.show(t,{region:l.interactive_region})}}),c.isFalsy(gon.previewMode))||u.commands.setHandler("stylesheet:generated",function(t,e){n=n||e.header_sponserImage_input,c.isFalsy(e.header_sponserImage_input)||(n=e.header_sponserImage_input,u.displayOptions.set("header_sponserImage_input",n),i=a.getHeaderView({model:u.request("get:current:album")}),a.show(i,{region:l.widget_header_region})),"250"!=e.widget_photoSize&&s.triggerMethod("reload:sly"),s.triggerMethod("stylesheet:generated")});this.show(l,{loading:!0})},getLayout:function(t){return new e.Layout(t)},getCollectionView:function(t){return new e.HorizontalCollection(t)},getHeaderView:function(t){return new e.HeaderView(t)},getNavbarView:function(t,e){return u.request("get:navbar:view",t,e)}})}),Pixlee.module("HorizontalApp.Show",function(t,o,e,i,r,s){t.Layout=o.Views.Layout.extend({template:"javascripts/backbone/apps/horizontal/show/templates/layout",regions:{widget_header_region:"#widget_header_region",interactive_region:"#interactive_region",frame:".horizontal_frame"}}),t.Layout.include(["LayoutHelpers"]),t.PhotoView=o.Views.ItemView.extend({template:"javascripts/backbone/apps/common/templates/v2/_photo_item",className:"photo_block",tagName:"li",behaviors:{Reviews:{},Share:{},Vote:{},Lightbox:{}},initialize:function(){this.model.get("is_starred")&&this.$el.addClass("starred")},templateHelpers:{decodeUtf8:function(t){return o.request("decode:utf8",t)}}}),t.PhotoView.include(["PhotoViewHelpers","ReviewHelpers"]),t.HorizontalCollection=o.Views.CollectionView.extend({childView:t.PhotoView,className:"clearfix",tagName:"ul",behaviors:function(){var t={CollectionVote:{},RefreshOnCssGenerated:{}};s.isFalsy(this.options.displayOptions.headerOptions)||(t.AppendUploaderTiles={});var e=s.isFalsy(this.options.displayOptions.headerOptions.end_tile_upload_button_background_showHide),i=!s.isFalsy(o.displayOptions.get("hideIfLessThan"))||!s.isFalsy(gon.current_account.extra_fields.hideIfLessThan);return(e||i)&&(t.HideEmptyAlbumWidget={}),t},initialize:function(){this.collection.reviewSelectionOptions={currentModelIndex:0}},onShow:function(){r("#widget").attr("alt",o.altText),this.setNextPageListener()},fetchNextPage:function(e){var i=this;this.isFetching=!0,this.collection.nextPage({success:function(t){t.next&&r(".next").removeClass("disabled"),i.isFetching=!1,i.sly.reload({silentScroll:!0}),e&&e.call(i,i.sly.items[1].center,!0)}})},setNextPageListener:function(){var t=this;r(".next, .prev").click(function(){t.initialLoad=!1,1===t.collection.length&&(t.initialLoad=!0,t.fetchNextPage(t.sly.slideTo))})},forceCenterSly:function(t){var e=this,i=r(".horizontal_frame");this.isFetching=!1,this.initialLoad=!0,this.sly=new Sly(i,{horizontal:1,smart:1,itemNav:"forceCentered",activateMiddle:1,activateOn:"click",mouseDragging:0,touchDragging:1,releaseSwing:1,startAt:t,scrollBy:0,speed:300,elasticBounds:1,easing:"easeOutExpo",prevPage:r(".prev"),nextPage:r(".next")},{change:function(){var t=r(this)[0].pos;e.initialLoad||(t.dest>t.cur?o.commands.execute("nav:right",this.rel,e.collection):o.commands.execute("nav:left",this.rel,e.collection)),!e.initialLoad&&.6<t.dest/t.end&&!e.isFetching&&(e.fetchNextPage(),e.initialLoad=!0)}}).init()},onRender:function(){var e=this;if(this.isFetching=!1,this.initialLoad=!0,s.isFalsy(this.sly)||this.sly.destroy(),0<this.collection.length){var t=r(".horizontal_frame");if(this.sly=new Sly(t,{horizontal:1,smart:1,itemNav:"centered",activateOn:"click",mouseDragging:0,touchDragging:1,releaseSwing:1,startAt:0,scrollBy:0,speed:300,elasticBounds:1,easing:"easeOutExpo",prevPage:r(".prev"),nextPage:r(".next")},{change:function(){var t=r(this)[0].pos;e.initialLoad||(t.dest>t.cur?o.commands.execute("nav:right",this.rel,e.collection):o.commands.execute("nav:left",this.rel,e.collection)),!e.initialLoad&&.6<t.dest/t.end&&!e.isFetching&&(e.isFetching=!0,e.collection.nextPage({success:function(t){t.next&&r(".next").removeClass("disabled"),e.isFetching=!1,e.sly.reload({silentScroll:!0})}}))}}).init(),!gon.display_options.is_interactive&&s.isFalsy(this.options.displayOptions.headerOptions.end_tile_upload_button_background_showHide))try{if(this.sly.items[this.sly.items.length-1].end<0){var i=Math.ceil(this.sly.items.length/2)-1;this.sly.destroy(),this.forceCenterSly(i)}}catch(n){console.log(n)}}}}),t.HorizontalCollection.include(["tabindexHelpers","designEditorCollectionHelpers"]),t.HeaderView=o.Views.ItemView.extend({template:"javascripts/backbone/apps/common/templates/v2/_header",id:"widget_header",behaviors:{Upload:{},ShowPdpCaption:{}}}),t.HeaderView.include(["StandaloneHeaderHelpers"])}),function(){this.JST||(this.JST={}),this.JST["javascripts/backbone/apps/horizontal/show/templates/layout"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push(""),"side_left"===getLayoutClass()||"side_right"===getLayoutClass()?__p.push('\n\t<div id="interactive_region"></div>\n\t<div id="widget_header_wrapper" class="',getLayoutClass(),'">\n\t\t<div id="widget_header_region"></div>\n\t\t<div id="horizontal_widget" class="wrap">\n\t\t\t<div class="controls">\n\t\t\t\t<div class="btn prev"></div>\n\t\t\t\t<div class="btn next"></div>\n\t\t\t</div>\n\t\t\t<div id="frame" class="horizontal_frame">\n\t\t\t</div>\n\t\t</div>\n\t</div>\n'):__p.push('\n\t<div id="widget_header_region"></div>\n\t<div id="interactive_region"></div>\n\t<div id="horizontal_widget" class="wrap">\n\t\t<div class="controls">\n\t\t\t<div class="btn prev"></div>\n\t\t\t<div class="btn next"></div>\n\t\t</div>\n\t\t<div id="frame" class="horizontal_frame">\n\t\t</div>\n\t</div>\n'),__p.push("\n");return __p.join("")}}.call(this);